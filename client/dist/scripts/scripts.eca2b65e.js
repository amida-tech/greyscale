"use strict";var _app=angular.module("greyscaleApp",["ngCookies","ngResource","ngTouch","ngTable","ngMessages","ui.bootstrap","ui.router","RDash","greyscale.mock","greyscale.core","greyscale.rest","greyscale.tables","inform","lodashAngularWrapper","isteven-multi-select","pascalprecht.translate","angularFileUpload","ui.sortable"]);_app.config(["$stateProvider","$logProvider","$locationProvider","$urlMatcherFactoryProvider","$urlRouterProvider","greyscaleEnv","greyscaleGlobalsProvider","i18nProvider","$translateProvider",function(a,b,c,d,e,f,g,h,i){var j=g.$get();b.debugEnabled(f.enableDebugLog),d.strictMode(!1),c.html5Mode(!1);var k=j.userRoles;h.init(i),_app.useNgLocale=h.useNgLocale,a.state("main",{templateUrl:"views/abstract/main.html","abstract":!0}).state("activate",{parent:"main",url:"/activate/:realm/:token",views:{"body@main":{templateUrl:"views/controllers/activation.html",controller:"ActivateCtrl"}},data:{name:"NAV.ACTIVATE",accessLevel:k.nobody.mask}}).state("login",{parent:"main",url:"/login?returnTo",views:{"body@main":{templateUrl:"views/controllers/login.html",controller:"LoginCtrl"}},data:{name:"NAV.LOGIN",accessLevel:k.nobody.mask}}).state("forgot",{parent:"main",url:"/forgot",views:{"body@main":{templateUrl:"views/controllers/login.html",controller:"LoginCtrl"},data:{name:"NAV.FORGOT",accessLevel:k.nobody.mask}}}).state("reset",{parent:"main",url:"/reset/:realm/:token",views:{"body@main":{templateUrl:"views/controllers/login.html",controller:"LoginCtrl"}},data:{name:"NAV.RESET",accessLevel:k.nobody.mask}}).state("dashboard",{url:"/?returnTo",parent:"main","abstract":!0,views:{"body@main":{templateUrl:"views/abstract/dashboard.html",controller:"DashboardCtrl"}}}).state("home",{parent:"dashboard",url:"",data:{name:"NAV.HOME",accessLevel:k.any.mask},views:{"body@dashboard":{templateUrl:"views/controllers/home.html",controller:"HomeCtrl"}}}).state("organizations",{parent:"home",url:"organizations",data:{name:"NAV.ORGANIZATIONS",icon:"fa-university",accessLevel:k.superAdmin.mask,realm:"public"},views:{"body@dashboard":{templateUrl:"views/controllers/organizations.html",controller:"OrganizationsCtrl"}}}).state("superusers",{parent:"home",url:"superusers",data:{name:"NAV.SUPERUSERS",icon:"fa-user-secret",accessLevel:k.superAdmin.mask,realm:"public"},views:{"body@dashboard":{templateUrl:"views/controllers/superusers.html",controller:"SuperusersCtrl"}}}).state("access",{parent:"home",url:"access",data:{name:"NAV.ACCESS_MANAGEMENT",icon:"fa-compass",accessLevel:k.superAdmin.mask},views:{"body@dashboard":{templateUrl:"views/controllers/access.html",controller:"AccessCtrl"}}}).state("users",{parent:"home",url:"users",data:{name:"NAV.USERS.TITLE",icon:"fa-users",accessLevel:k.superAdmin.mask|k.admin.mask},views:{"body@dashboard":{templateUrl:"views/controllers/users.html",controller:"UsersCtrl"}}}).state("usersList",{parent:"users",url:"/list",templateUrl:"views/controllers/users-list.html",controller:"UsersListCtrl",data:{name:"NAV.USERS.LIST",icon:"fa-users",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("usersGroups",{parent:"users",url:"/groups",templateUrl:"views/controllers/users-groups.html",controller:"UsersGroupsCtrl",data:{name:"NAV.USERS.GROUPS"}}).state("usersImport",{parent:"users",url:"/import",templateUrl:"views/controllers/users-import.html",controller:"UsersImportCtrl",data:{name:"NAV.IMPORT",icon:"fa-upload",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("uoas",{parent:"home",url:"uoas",views:{"body@dashboard":{templateUrl:"views/controllers/uoas.html",controller:"UoasCtrl"}},data:{name:"NAV.UOAS.TITLE",icon:"fa-table",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("uoasList",{parent:"uoas",url:"/list",templateUrl:"views/controllers/uoas-list.html",controller:"UoasListCtrl",data:{name:"NAV.UOAS.LIST",icon:"fa-table",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("uoasImport",{parent:"uoas",url:"/import",templateUrl:"views/controllers/uoas-import.html",controller:"UoasImportCtrl",data:{name:"NAV.IMPORT",icon:"fa-upload",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("projects",{parent:"home",data:{name:null,accessLevel:k.superAdmin.mask|k.admin.mask}}).state("projects.setup",{views:{"body@dashboard":{templateUrl:"views/controllers/project-setup.html",controller:"ProjectSetupCtrl"}},data:{}}).state("projects.setup.surveys",{url:"surveys",templateUrl:"views/controllers/project-setup-surveys.html",controller:"ProjectSetupSurveysCtrl",data:{name:"NAV.PROJECTS.SURVEYS"}}).state("projects.setup.surveys.edit",{url:"/:surveyId",views:{"body@dashboard":{templateUrl:"views/controllers/survey-edit.html",controller:"SurveyEditCtrl"}},data:{name:"{{ext.surveyName}}"}}).state("projects.setup.products",{url:"projects",templateUrl:"views/controllers/project-setup-products.html",controller:"ProjectSetupProductsCtrl",data:{name:"NAV.PROJECT_MANAGEMENT",icon:"fa-paper-plane"}}).state("projects.setup.tasks",{parent:"projects.setup.products",url:"/:productId/tasks",views:{"body@dashboard":{templateUrl:"views/controllers/product-tasks.html",controller:"ProductTasksCtrl"}},data:{name:"NAV.PRODUCT_TASKS",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("projects.setup.indexes",{parent:"projects.setup.products",url:"/:productId/indexes",views:{"body@dashboard":{templateUrl:"views/controllers/product-indexes.html",controller:"ProductIndexesCtrl"}},data:{name:"NAV.PRODUCT_INDEXES",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("pmProductDashboard",{parent:"home",url:"pm/:productId",views:{"body@dashboard":{templateUrl:"views/controllers/pm-dashboard-product.html",controller:"PmDashboardProductCtrl"}},data:{name:"NAV.PM_PRODUCT_DASHBOARD",accessLevel:k.superAdmin.mask|k.admin.mask|k.user.mask}}).state("profile",{parent:"home",url:"profile",views:{"body@dashboard":{templateUrl:"views/controllers/profile.html",controller:"ProfileCtrl"}},data:{name:"NAV.PROFILE",icon:"fa-user",accessLevel:k.superAdmin.mask|k.admin.mask|k.user.mask}}).state("tasks",{parent:"home",url:"tasks",views:{"body@dashboard":{templateUrl:"views/controllers/my-tasks.html",controller:"MyTasksCtrl"}},data:{name:"NAV.TASKS",icon:"fa-tasks",accessLevel:k.admin.mask|k.user.mask}}).state("graph",{parent:"home",url:"graph",views:{"body@dashboard":{templateUrl:"views/controllers/graph.html",controller:"GraphCtrl"}},data:{name:"NAV.GRAPH",icon:"fa-bar-chart",accessLevel:k.superAdmin.mask}}).state("table",{parent:"home",url:"table",views:{"body@dashboard":{templateUrl:"views/controllers/table.html",controller:"TableCtrl"}},data:{name:"NAV.TABLE",icon:"fa-table",accessLevel:k.superAdmin.mask}}).state("visualizations",{parent:"home",url:"visualizations",views:{"body@dashboard":{templateUrl:"views/controllers/visualizations.html",controller:"VisualizationsCtrl"}},data:{name:"NAV.VISUALIZATIONS",icon:"fa-globe",accessLevel:k.superAdmin.mask|k.admin.mask}}).state("visualization",{parent:"visualizations",url:"/:visualizationId",views:{"body@dashboard":{templateUrl:"views/controllers/index-visualization.html",controller:"IndexVisualizationCtrl"}},data:{name:"Visualization"}}).state("comparative-visualization",{parent:"visualizations",url:"/comparative/:visualizationId",views:{"body@dashboard":{templateUrl:"views/controllers/comparative-visualization.html",controller:"ComparativeVisualizationCtrl"}},data:{name:"Comparative Visualization"}}).state("survey",{parent:"home",url:"survey/:surveyId/task/:taskId?",views:{"body@dashboard":{templateUrl:"views/controllers/survey.html",controller:"SurveyCtrl"}},data:{name:"NAV.SURVEY",icon:"fa-question",accessLevel:k.any.mask}}).state("notifications",{parent:"home",url:"notifications",views:{"body@dashboard":{templateUrl:"views/controllers/notifications.html",controller:"NotificationsCtrl"}},data:{name:"NAV.NOTIFICATIONS",icon:"fa-envelope",accessLevel:k.any.mask}}),e.otherwise("/")}]),_app.run(["$state","$stateParams","$rootScope","greyscaleProfileSrv","inform","greyscaleUtilsSrv","greyscaleGlobals","_",function(a,b,c,d,e,f,g,h){c.$on("$stateChangeStart",function(c,e,h,i,j){if(e.data&&e.data.accessLevel!==g.userRoles.all.mask){var k={reload:!0,inherit:!1};d.getAccessLevel().then(function(d){if(h.returnTo){var i=a.get(h.returnTo);0!==(d&i.data.accessLevel)&&(c.preventDefault(),a.go(i.name,{},k))}0===(d&e.data.accessLevel)?(c.preventDefault(),0!==(d&g.userRoles.any.mask)?("login"!==e.name&&f.errorMsg(e.data.name,"ERROR.ACCESS_RESTRICTED"),a.go("home",{},k)):("home"!==e.name&&(b.returnTo=e.name),a.go("login"))):j.returnTo&&j.returnTo!==e.name&&(c.preventDefault(),a.go(j.returnTo,{},k))})}}),c.$on(g.events.common.logout,function(){d.logout()["finally"](function(){a.go("login")})}),c.$on(g.events.common.login,function(){d.getProfile().then(function(b){var c=b.roleID,d=g.userRoles,e=h.find(d,{id:c});a.go(e&&e.homeState?e.homeState:"home")})}),a.ext={}}]),angular.module("greyscaleApp").factory("greyscaleModalsSrv",["$uibModal","$q",function(a,b){function c(a){return b.reject("")}function d(b,d,e,f){return a.open({templateUrl:b,controller:"SimpleFormCtrl",size:f,windowClass:"modal fade in",resolve:{formData:d,extData:e}}).result["catch"](c)}function e(a,b,c){return d(a,b,c,"md")}function f(a,b,c){return d(a,b,c,"lg")}function g(b,d){return a.open({templateUrl:"views/modals/modal-form.html",controller:"ModalFormCtrl",size:"md",windowClass:"modal fade in",resolve:{recordData:b,recordForm:d}}).result["catch"](c)}function h(b,d){return a.open({templateUrl:"views/modals/modal-rec-info.html",controller:"ModalRecInfoCtrl",size:"md",windowClass:"modal fade in",resolve:{recordData:b,recordForm:d}}).result["catch"](c)}function i(b){return a.open({templateUrl:"views/modals/product-uoas.html",controller:"ModalProductUoasCtrl",size:"lg",windowClass:"modal fade in",resolve:{product:b}}).result}function j(){return a.open({templateUrl:"views/modals/uoas-filter.html",controller:"ModalUoasFilterCtrl",size:"xxl",windowClass:"modal fade in"}).result}function k(b){return a.open({templateUrl:"views/modals/product-workflow.html",controller:"ModalProductWorkflowCtrl",controllerAs:"ctrl",size:"xxl",windowClass:"modal fade in",resolve:{product:b}}).result}function l(b,c){return a.open({templateUrl:"views/modals/product-task.html",controller:"ModalProductTaskCtrl",controllerAs:"ctrl",size:"xxl",windowClass:"modal fade in",resolve:{task:b,activeBlock:c}}).result}function m(b){return a.open({templateUrl:"views/modals/translation-form.html",controller:"ModalTranslationCtrl",size:"md",windowClass:"modal fade in",resolve:{translation:b}}).result}function n(b){return a.open({templateUrl:"views/modals/confirm.html",controller:"ModalConfirmCtrl",size:"md",windowClass:"modal fade in",resolve:{params:b}}).result}function o(b){return a.open({templateUrl:"views/modals/user-groups.html",controller:"ModalUserGroupsCtrl",size:"md",windowClass:"modal fade in",resolve:{user:b}}).result}function p(b){return a.open({templateUrl:"views/modals/answer-version.html",controller:"ModalAnswerVersionCtrl",size:"md",windowClass:"modal fade in",resolve:{params:b}}).result}function q(b,c){return a.open({templateUrl:"views/modals/send-notification.html",controller:"ModalSendNotificationCtrl",size:"md",windowClass:"modal fade in",resolve:{user:b,data:c}}).result}function r(b,c){return a.open({templateUrl:"views/modals/change-password.html",controller:"ModalChangePasswordCtrl",size:"md",windowClass:"modal fade in",resolve:{user:b,data:{realm:c}}}).result}function s(c,d,e){return a.open({templateUrl:"views/modals/edit-index.html",controller:"ModalEditIndexCtrl",size:"xxl",windowClass:"modal fade in",resolve:{index:c,type:b.when(d),product:e}}).result}function t(b){return a.open({templateUrl:"views/modals/edit-visualization.html",controller:"ModalEditVisualizationCtrl",size:"md",windowClass:"modal fade in",resolve:{visualization:b}}).result}function u(b,c){return a.open({templateUrl:"views/modals/add-product.html",controller:"ModalAddProductCtrl",size:"md",windowClass:"modal fade in",resolve:{productIndex:b,products:c}}).result}function v(c,d){return a.open({templateUrl:"views/modals/import-dataset.html",controller:"ModalImportDatasetCtrl",size:"md",windowClass:"modal fade in",resolve:{dataset:c,visualizationId:b.when(d)}}).result}return{editRec:g,showRec:h,editCountry:function(a){return e("views/modals/country-form.html",a,null)},editUserOrganization:function(a){return e("views/modals/user-organization-form.html",a,null)},addRoleRight:function(a,b){return e("views/modals/role-right-form.html",a,b)},editSurvey:function(a,b){return f("views/modals/survey-form.html",a,b)},editTranslations:m,uoasFilter:j,productUoas:i,productWorkflow:k,productTask:l,userGroups:o,confirm:n,showVersion:p,sendNotification:q,changePassword:r,editIndex:s,editVisualization:t,addProduct:u,importDataset:v}}]),angular.module("greyscaleApp").controller("LoginCtrl",["$scope","$state","$stateParams","greyscaleProfileSrv","greyscaleRealmSrv",function(a,b,c,d,e){var f=c.realm;f&&e.init(f),a.model={state:b.current.name,token:c.token},d.getAccessLevel().then(function(a){a>1&&b.go("home",{})})}]),angular.module("greyscaleApp").controller("ActivateCtrl",["$scope","greyscaleUserApi","$state","$stateParams","inform","greyscaleRealmSrv",function(a,b,c,d,e,f){var g=d.realm;f.init(g),b.checkActivationToken(d.token).then(function(b){a.user={activationToken:b.activationToken,email:b.email,firstName:b.firstName,lastName:b.lastName}},function(a){e.add(a.data.message,{type:"danger"}),c.go("login")})}]),angular.module("greyscaleApp").controller("ProfileCtrl",["$q","$scope","greyscaleProfileSrv","greyscaleUserApi","greyscaleModalsSrv","greyscaleGlobals","greyscaleUtilsSrv","inform","i18n",function(a,b,c,d,e,f,g,h,i){function j(){return f.notifyLevels}function k(a){if(a.password){if(a.password.length<8)return m+"PASSWORD_ERROR";if(a.repeatPassword&&a.password!==a.repeatPassword)return m+"REPEAT_PASSWORD_ERROR"}}function l(b){var c={id:b.id,currentPassword:b.currentPassword,password:b.password};return d.save(c)["catch"](function(b){return a.reject(b.data.message)})}var m="PROFILE.";b.model={org:{loaded:!1,name:"",address:"",url:""},orgReadonly:!0,user:{}},b.view={user:[{field:"email",title:m+"EMAIL",dataReadOnly:"both",show:!0},{field:"created",title:m+"CREATED",dataReadOnly:"both",dataFormat:"date"},{field:"isActive",title:m+"ACTIVATED",dataReadOnly:"both",dataFormat:"boolean"},{field:"lastActive",title:m+"LAST_ACTIVE",dataReadOnly:"both",dataFormat:"date"},{field:"firstName",title:m+"FIRST_NAME",show:!1},{field:"lastName",title:m+"LAST_NAME",show:!1},{field:"lang",title:m+"LANGUAGE",show:!0},{field:"organization",title:m+"ORGANIZATION",dataHide:function(){return!b.user||""===b.user.organization},dataReadOnly:"both"},{field:"affiliation",title:m+"AFFILATION"},{field:"location",title:m+"LOCATION",show:!0},{field:"timezone",title:m+"TIMEZONE",show:!1},{field:"cell",title:m+"MOBILE",show:!0},{field:"phone",title:m+"PHONE",show:!1},{field:"address",title:m+"ADDRESS"},{field:"bio",title:m+"BIO",dataFormat:"textarea"},{field:"notifyLevel",title:m+"NOTIFY_LEVEL",dataFormat:"option",dataNoEmptyOption:!0,dataSet:{getData:j,keyField:"value",valField:"name"}}]};var n={formTitle:m+"PROFILE",cols:b.view.user},o={formTitle:m+"PASSWORD",cols:[{title:m+"CURRENT_PASSWORD",field:"currentPassword",dataRequired:!0,dataFormat:"password"},{title:m+"NEW_PASSWORD",field:"password",dataRequired:!0,dataFormat:"password"},{title:m+"REPEAT_PASSWORD",field:"repeatPassword",dataRequired:!0,dataFormat:"password"}],validationError:k,savePromise:l};c.getProfile().then(function(a){if(b.model.user=a,b.model.orgReadonly=!c.isAdmin(),!c.isSuperAdmin())return d.getOrganization().then(function(a){b.model.org=a,b.model.org.loaded=!0})})["catch"](g.errorMsg),b.editProfile=function(){var a=angular.copy(b.model.user);e.editRec(a,n).then(function(a){return delete a.organization,delete a.password,d.save(a).then(function(c){return b.model.user=a,b.model.user.organization=b.model.org.name,c})})["catch"](g.errorMsg)},b.editOrg=function(){e.editUserOrganization(b.model.org).then(function(a){return"undefined"==typeof a.isActive&&(a.isActive=!0),d.saveOrganization(a).then(function(c){return b.model.org=a,b.model.user.organization=a.name,c})})["catch"](g.errorMsg)},b.changePassword=function(){var a={id:b.model.user.id};e.editRec(a,o).then(function(){h.add(i.translate("USERS.CHANGE_PASSWORD_SUCCESS"),{type:"success"})})}}]),angular.module("greyscaleApp").controller("MyTasksCtrl",["$scope","greyscaleMyTasksTbl","greyscaleMyTasksFutureTbl","greyscaleMyTasksFineshedTbl",function(a,b,c,d){a.model={activeTasks:b,futureTasks:c,finishedTasks:d}}]),angular.module("greyscaleApp").controller("UoasCtrl",["$scope","$state",function(a,b){function c(b){var c=b.name.replace(e+".","");angular.forEach(a.tabs,function(b,d){b.state===c&&(a.activeTab=d)})}function d(b){var c=a.$on("$stateChangeSuccess",function(a,c){b(c)});a.$on("$destroy",c)}var e="uoas";a.tabs=[{state:"uoasList",active:!0,title:"NAV.UOAS.LIST",icon:"fa-table"},{state:"uoasImport",title:"NAV.IMPORT",icon:"fa-upload"}],a.activeTab=0,a.go=function(a){b.go(a)},d(function(b){b.name===e?a.tabs.length>0&&a.go(a.tabs[0].state):c(b)})}]),angular.module("greyscaleApp").controller("UoasListCtrl",["$scope","greyscaleUoaTypesTbl","greyscaleUoasTbl","greyscaleUoaClassTypesTbl","greyscaleUoaTagsTbl","greyscaleUoaTagLinksTbl","Organization",function(a,b,c,d,e,f,g){function h(){i(a.model.uoas),i(a.model.uoaTypes),i(a.model.uoaTags),i(a.model.uoaTagLinks),i(a.model.uoaClassTypes)}function i(a){a&&a.tableParams&&a.tableParams.reload()}g.$watch(a,h),a.model={uoas:c,uoaTypes:b,uoaTags:e,uoaTagLinks:f,uoaClassTypes:d};var j=a.$on("update-uoaTypes",function(b,c){a.model.uoas.update.uoaTypes(c.uoaTypes)}),k=a.$on("update-uoaClassTypes",function(b,c){a.model.uoaTags.update.uoaClassTypes(c.uoaClassTypes)}),l=a.$on("update-uoaTags",function(b,c){a.model.uoaTagLinks.update.uoaTags(c.uoaTags)}),m=a.$on("update-uoas",function(b,c){a.model.uoaTagLinks.update.uoas(c.uoas)});a.$on("$destroy",function(){j(),k(),l(),m()}),a.selectUoa=function(b){return"undefined"!=typeof b&&(a.model.uoaTagLinks.query={uoaId:b.id},a.model.uoaTagLinks.tableParams.reload()),a.model.uoas.current}}]),angular.module("greyscaleApp").controller("UoasImportCtrl",["$q","$scope","greyscaleUoasImportTbl",function(a,b,c){var d=c;b.model={importUoas:d},b.afterUpload=function(c,e){d.dataPromise=function(){return a.when(e)},b.model.results?d.tableParams.reload():b.model.results=!0}}]),angular.module("greyscaleApp").controller("AccessCtrl",["$scope","greyscaleRolesTbl","greyscaleRightsTbl","greyscaleRoleRightsTbl","Organization",function(a,b,c,d,e){function f(){a.model.roleRights.dataFilter.role=null,g(a.model.rights),g(a.model.roleRights),g(a.model.roles)}function g(a){a&&a.tableParams&&a.tableParams.reload()}a.model={rights:c,roleRights:d,roles:b},e.$watch(a,f),a.selectRole=function(a){return"undefined"!=typeof a&&(d.dataFilter.role=a,d.tableParams.reload()),a}}]),angular.module("greyscaleApp").controller("UsersCtrl",["$scope","$state","greyscaleProfileSrv",function(a,b,c){function d(b){b.name===h?a.tabs.length>0&&a.go(a.tabs[0].state):e(b)}function e(b){var c=b.name.replace(h,"");angular.forEach(a.tabs,function(b,d){b.state===c&&(a.activeTab=d)})}function f(b){var c=a.$on("$stateChangeSuccess",function(a,c){b(c)});a.$on("$destroy",c)}var g,h="users",i=["List","Groups","Import"];a.tabs=[],a.activeTab=0,a.tabsModel={},c.getProfile().then(function(e){g=c.getAccessLevelMask();for(var f=0;f<i.length;f++){var j=b.get(h+i[f]),k=j.data.accessLevel&g;j.data&&j.data.accessLevel&&0!==k&&a.tabs.push({state:i[f],title:j.data.name,icon:j.data.icon})}d(b.current)}),f(d),a.go=function(a){b.go(h+a)}}]),angular.module("greyscaleApp").controller("UsersImportCtrl",["$rootScope","$q","$scope","greyscaleUsersImportTbl","Organization",function(a,b,c,d,e){function f(){c.model.organization=e,c.model.importUsers&&c.model.importUsers.tableParams?c.model.importUsers.tableParams.reload():c.model.importUsers=g}var g=d;c.model={importResults:!1},e.$watch(c,f),c.afterUpload=function(a,d){g.dataPromise=function(){return b.when(d)},c.model.importResults?c.model.importUsers.tableParams.reload():c.model.importResults=!0}}]),angular.module("greyscaleApp").controller("UsersListCtrl",["$rootScope","$scope","greyscaleUsersTbl","greyscaleModalsSrv","Organization",function(a,b,c,d,e){function f(){g.dataFilter.organizationId=e.id,b.model.users.tableParams&&b.model.users.tableParams.reload()}var g=c;b.model={users:g},e.$watch(b,f),b.showUserInfo=function(a){d.showRec(a,g)}}]),angular.module("greyscaleApp").controller("UsersGroupsCtrl",["$scope","Organization","greyscaleGroupsTbl","greyscaleProjectApi","$stateParams",function(a,b,c,d,e){function f(){g.dataFilter.organizationId=b.id,a.model.groups.tableParams?a.model.groups.tableParams.reload():a.model.groups=g}var g=c;a.model={groups:g},b.$watch(a,f)}]),angular.module("greyscaleApp").controller("UsersUoaCtrl",["$scope","$q","greyscaleUoaApi","greyscaleUserApi","greyscaleProfileSrv","greyscaleUserUoaApi","greyscaleUtilsSrv",function(a,b,c,d,e,f,g){function h(){function b(a){var b,c=a.length;for(b=0;b<c;b+=1)a[b].checked=m.current.indexOf(a[b].id)>-1}b(a.model.pubUoa),b(a.model.privUoa)}function i(){var c={},d=a.model.selectedUsers.length,e=0;if(d>0){for(e=0;e<d;e++)c[a.model.selectedUsers[e]]=f.list(a.model.selectedUsers[e]);b.all(c).then(function(b){var c,f,g,i={},j=d;for(f=0;f<j;f+=1)for(g=a.model.selectedUsers[f],d=b[g].length,e=0;e<d;e+=1)c=b[g][e].id,i[c]?i[c]+=1:i[c]=1;m.current=[],m.add=[],m.del=[];for(c in i)i.hasOwnProperty(c)&&i[c]===j&&m.current.push(1*c);h()})}}function j(){a.model.hasChanges=m.add.length+m.del.length>0&&a.model.selectedUsers.length>0}function k(a){var b=m.current.indexOf(a.id)>-1;b?a.checked?m.del=m.del.splice(m.del.indexOf(a.id),1):m.del.push(a.id):a.checked?m.add.push(a.id):m.add=m.add.splice(m.add.indexOf(a.id),1),j()}function l(){var c,d=[],e=a.model.selectedUsers.length;if(e>0){for(c=0;c<e;c+=1)m.add.length>0&&d.push(f.add(a.model.selectedUsers[c],m.add)),m.del.length>0&&d.push(f.del(a.model.selectedUsers[c],m.del));b.all(d).then(function(){m.add=[],m.del=[],j()})["catch"](g.errorMsg)}}a.tns="USERS_UOA.";a.model={users:[],pubUoa:[],privUoa:[],selectedUsers:[],loading:!0,hasChanges:!1};var m={current:[],add:[],del:[]};a.onUserSelect=i,a.checkItem=k,a.applyChanges=l,e.getProfile().then(function(e){var f={_users:d.list(),_pubUoa:c.list({visibility:1,status:"1",fields:"id,name,description,status"}),_privUoa:c.list({visibility:1,status:"2",ownerId:e.id,fields:"id,name,description,status"})};return b.all(f).then(function(b){a.model.users=b._users,a.model.pubUoa=b._pubUoa,a.model.privUoa=b._privUoa,h()})})["finally"](function(){a.model.loading=!1})}]),angular.module("greyscaleApp").controller("DashboardCtrl",["$scope","$rootScope","$state","greyscaleSideMenu","greyscaleProfileSrv","greyscaleGlobals","i18n",function(a,b,c,d,e,f,g){function h(){return(j&f.userRoles.superAdmin.mask)===f.userRoles.superAdmin.mask}function i(){return(j&f.userRoles.admin.mask)===f.userRoles.admin.mask}var j;a.model={menu:{title:d.title,groups:[]},user:{firstName:"John",lastName:"Doe"},messages:[],toggle:!1},e.getProfile().then(function(b){j=e.getAccessLevelMask();var f=[];a.model.user=b;for(var k=0;k<d.groups.length;k++){for(var l=[],m=d.groups[k],n=0;n<m.states.length;n++){var o=c.get(m.states[n]),p=o.data.accessLevel&j;o.data&&o.data.accessLevel&&0!==p&&l.push({sref:o.name,title:o.data.name,icon:o.data.icon})}l.length>0&&f.push({title:m.title,items:l})}a.model.menu.groups=f;var q="ROLE_USER";i()?q="ROLE_ADMIN":h()&&(q="ROLE_SUPERADMIN"),a.model.user.roleName=g.translate("DASHBOARD."+q)}),a.logout=function(){b.$emit(f.events.common.logout)}}]),angular.module("greyscaleApp").controller("ProjectSetupCtrl",["$q","$scope","$state",function(a,b,c){function d(){return"products"}function e(a){var c=a.name.replace(g+".","");angular.forEach(b.tabs,function(a,d){a.state===c&&(b.activeTab=d)})}function f(a){var c=b.$on("$stateChangeSuccess",function(b,c){a(c)});b.$on("$destroy",c)}var g="projects.setup";b.tabs=[{state:"surveys",title:"NAV.PROJECTS.SURVEYS",icon:"fa-list"},{state:"products",title:"NAV.PROJECTS.PRODUCTS",icon:"fa-briefcase"}],b.activeTab=0,b.go=function(a,b,d){c.go(g+"."+a,b||{},d||{})},f(function(a){a.name===g?b.go(d(),{},{location:"replace"}):e(a)})}]),angular.module("greyscaleApp").controller("ProjectSetupSurveysCtrl",["$scope","$stateParams","greyscaleModalsSrv","greyscaleProjectApi","greyscaleProjectSurveysTbl","Organization",function(a,b,c,d,e,f){function g(){h.dataFilter.projectId=f.projectId,h.tableParams&&h.tableParams.reload()}var h=e;a.model={surveys:h},f.$watch(a,g)}]),angular.module("greyscaleApp").controller("ProjectSetupProductsCtrl",["$scope","$state","$stateParams","greyscaleModalsSrv","greyscaleProjectApi","greyscaleProjectProductsTbl","Organization",function(a,b,c,d,e,f,g){function h(){i.dataFilter.projectId=g.projectId,a.model.products?i.tableParams.reload():a.model.products=i}var i=f;a.model={},g.$watch(a,h)}]),angular.module("greyscaleApp").controller("ProductTasksCtrl",["_","$q","$scope","$state","$stateParams","$timeout","Organization","greyscaleProductWorkflowApi","greyscaleProductApi","greyscaleUserApi","greyscaleUtilsSrv","greyscaleUoaTypeApi","greyscaleGroupApi","greyscaleTaskApi","greyscaleModalsSrv",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){var b=c.model.selectedGroup?c.model.selectedGroup.id:null,d=c.model.searchText&&""!==c.model.searchText?c.model.searchText:null;c.model.usersSearchResult=a.filter(c.model.users,function(a){var c=b&&~a.usergroupId.indexOf(b),e=!1;return d&&((" "+a.firstName.toLowerCase()).match(d.toLowerCase())&&(e=!0),(" "+a.lastName.toLowerCase()).match(d.toLowerCase())&&(e=!0),(" "+a.email.toLowerCase()).match(d.toLowerCase())&&(e=!0)),c||e}),f(u)}function q(){function b(b,c,d){var e=angular.element(b.target),f=c+"-([0-9\\-]+)",g=e.attr("class").match(new RegExp(f));if(g){var h=g[1];return d?(h=h.split("-"),h=a.map(h,a.ary(parseInt,1))):h=parseInt(h),h}}function d(a,b){a.css("opacity",b?.5:1)}function e(a){a.addClass("bg-success")}function f(a){a.addClass("bg-danger")}function g(a){a.removeClass("bg-success"),a.removeClass("bg-danger")}function h(a){return a.draggable.scope().user}function i(a){return a=a.target||a,angular.element(a).scope().$$childHead.model}var j=$(".drop-user");t(),j.droppable({over:function(a,b){var c=$(a.target),d=h(b),g=i(a);r(g.step,d)?s(g,d)&&e(c):f(c)},out:function(a){var b=$(a.target);g(b)},drop:function(a,b){var c=$(a.target),e=h(b),f=i(a),j={stepId:f.stepId,uoaIds:[f.uoaId],userView:e};r(f.step,e)&&s(f,e)&&(b.helper.remove(),d(c,!0),w(j)["finally"](function(){d(c,!1)})),g(c)}}),$(".drop-user-bulk").droppable({over:function(a,c){var d=$(a.target),g=h(c),i={};i.usergroupId=b(a,"usergroup-id",!0),r(i,g)?s(i,g)&&e(d):f(d)},out:function(a){var b=$(a.target);g(b)},drop:function(a,e){var f=$(a.target),i=h(e),j={usergroupId:b(a,"usergroup-id",!0)},k={stepId:b(a,"step-id"),uoaIds:c.model.tasks.dataMap,userView:i};r(j,i)&&s(j,i)&&(e.helper.remove(),d(f,!0),w(k)["finally"](function(){d(f,!1)})),g(f)}}),j.on("click",".unassign-user",function(a){a.stopPropagation();var b=$(a.target).closest(".drop-user"),c=i(b);d(b,!0),o.confirm({message:N+"DELETE_CONFIRM",task:c,okType:"danger",okText:"COMMON.DELETE"}).then(function(){return z(c).then(function(){c.user=void 0,c.userIds=[],c.groupIds=[],delete c.id,delete c.startDate,delete c.endDate,delete c.endDate})})["finally"](function(){d(b,!1)})}),j.on("click",".edit-task",function(a){a.stopPropagation();var b=$(a.target).closest(".drop-user"),c=i(b),e=G(c.uoaId,c.stepId),f=angular.copy(e);d(b,!0),o.editRec(f,S).then(y).then(function(a){angular.extend(e,a),angular.extend(c,a)})["finally"](function(){d(b,!1)})})}function r(b,c){return a.intersection(b.usergroupId,c.usergroupId).length}function s(a,b){return!a.user||a.userIds&&!~a.userIds.indexOf(b.id)}function t(){$(".drop-user.ui-droppable").droppable("destroy"),$(".drop-user-bulk.ui-droppable").droppable("destroy")}function u(){v();var a;$(".drag-user").draggable({cursor:"move",revert:!0,start:function(b){a=$(b.target)},appendTo:"body",helper:function(a){var b=$(a.target).clone().detach(),c=$('<table class="table table-bordered"><tr></tr></table>');return c.find("tr").append(b),c},drag:function(){a.css("opacity",.5)},stop:function(){a.css("opacity",1)}})}function v(){$(".drag-user.ui-draggable").draggable("destroy")}function w(d){var e,f,g,h,j,k=d.stepId,l=d.uoaIds,m=d.userView,n=[],o=[],p=a.find(c.model.workflowSteps,{id:k}),q={userIds:[m.id],groupIds:[]},r={stepId:k,productId:O,startDate:p.startDate,endDate:p.endDate};for(f=l.length,e=0;e<f;e++)g=l[e],h=G(g,k),j=angular.copy(h?h:r),s(j,m)&&(angular.extend(j,q),j.uoaId=g,h||o.push(j),n.push(j));var t=function(){angular.forEach(n,function(a){var b=G(a.uoaId,k);b?angular.extend(b,a):Q.push(a)})};return i.product(O).tasksListUpdate(n).then(function(a){return a.inserted&&a.inserted.length===o.length&&angular.forEach(o,function(b,c){b.id=a.inserted[c].id}),t(),x(o,d)})["catch"](function(a){return A(a,"tasks_update"),b.reject(a)})}function x(a,b){var d,e,f=a.length,g=b.stepId,h=b.uoaIds,i=b.userView;return angular.forEach(c.model.tasks.tableParams.data,function(b){if(e=b.steps[g],~h.indexOf(e.uoaId))for(angular.extend(e,{userIds:[i.id],groupIds:[],user:i}),d=0;d<f;d++)b.id===a[d].uoaId&&g===a[d].stepId&&angular.extend(e,{id:a[d].id,userIds:a[d].userIds||[i.id],groupIds:[],user:i,startDate:a[d].startDate,endDate:a[d].endDate})}),!0}function y(a){var c=b.defer();return n.update(a.id,a).then(function(){c.resolve(a)})["catch"](function(a){A(a,"task_update"),c.reject()}),c.promise}function z(c){var d=b.defer(),e=G(c.uoaId,c.stepId),f=e.id,g=function(){a.remove(Q,{uoaId:c.uoaId,stepId:c.stepId})};return n.del(f).then(function(){g(),d.resolve()})["catch"](function(a){A(a,"task_remove"),d.reject()}),d.promise}function A(a,b){var c=N+b.toUpperCase()+"_ERROR";k.errorMsg(a,c)}function B(a){var b=[{title:N+"UOAS_HEADER",show:!0,field:"name",sortable:"name",cellTemplate:"<b>{{row.name}}</b><br/><small>{{row.type.name}}</small>"}],c={title:N+"TITLE",icon:"fa-tasks",cols:b,classes:"table-bordered table-col-sm",dataPromise:function(){return D(c)}};return C(c,a),c}function C(b,c){angular.forEach(c.workflowSteps||[],function(d){var e=d.usergroupId&&d.usergroupId.length?"usergroup-id-"+d.usergroupId.join("-"):"";b.cols.push({titleTemplate:'<b>{{ext.step.title}}</b><small class="weight-normal text-muted super-small">{{ext.groups}}</small><small>{{ext.step.startDate|date:"shortDate"}} - {{ext.step.endDate|date:"shortDate"}}</small>',titleTemplateExtData:{step:d,groups:a.map(d.groups,"title").join(", ")},show:!0,"class":"drop-zone drop-user-bulk "+e+" step-id-"+d.id,field:"steps."+d.id,cellClass:"drop-zone drop-user",cellTemplateUrl:"views/controllers/product-tasks-table-cell.html",cellTemplateExtData:{product:c.product}})})}function D(a){return M(O).then(L).then(H).then(function(b){return c.model.workflowSteps=b.workflowSteps,c.model.uoas=b.uoas,a?E(b):(b.workflowSteps&&b.uoas&&b.workflowSteps.length&&b.uoas.length&&(c.model.tasks=B(b)),void(c.model.$loading=!1))}).then(function(a){return f(function(){q()}),a})}function E(b){return F(b.tasks),angular.forEach(b.uoas,function(c){c.steps={},angular.forEach(b.workflowSteps,function(b){var d=G(c.id,b.id),e=c.steps[b.id]={},f=d?a.find(P.users,{id:d.userIds[0]}):null;angular.extend(e,{id:d?d.id:void 0,uoaId:c.id,stepId:b.id,startDate:d&&d.startDate||b.startDate,endDate:d&&d.endDate||b.endDate,userIds:d?d.userIds||[]:[],groupIds:d?d.groupIds||[]:[],user:f,step:b})})}),b.uoas}function F(b){Q=[],angular.forEach(b,function(b){Q.push(a.pick(b,["id","productId","stepId","uoaId","userIds","groupIds","startDate","endDate"]))})}function G(b,c){return a.find(Q,{uoaId:b,stepId:c})}function H(a){var d,e,f=a.product,g=a.tasks;if(!f.workflow)return b.when({});var j=f.workflow.id,k=f.id,m={product:b.when(f),tasks:b.when(g),
workflowSteps:h.workflow(j).stepsList(),uoas:i.product(k).uoasList(),uoaTypes:l.list()};for(e=g.length,d=0;d<e;d++)!g[d].userIds&&g[d].userId&&(g[d].userIds=[g[d].userId]);return b.all(m).then(function(a){return P.uoaTypes=a.uoaTypes,c.model.uoas=J(a.uoas),c.model.workflowSteps=K(a.workflowSteps),a})}function I(){var a={users:j.list(),groups:m.list(g.id)};return b.all(a).then(function(a){return P.users=a.users,P.groups=a.groups,!0})}function J(b){return angular.forEach(b,function(b){b.type=a.find(P.uoaTypes,{id:b.unitOfAnalysisType})}),b}function K(b){return angular.forEach(b,function(b){b.groups=[],angular.forEach(b.usergroupId,function(c){b.groups.push(a.find(P.groups,{id:c}))})}),b}function L(a){var c=a.id,d={product:b.when(a),tasks:i.product(c).tasksList()};return b.all(d)}function M(a){return T?b.when(T):T=i.get(a).then(function(a){return d.ext.productName=a.title,a})["catch"](function(a){k.errorMsg(a,N+"PRODUCT_NOT_FOUND"),d.go("home")})}var N="PRODUCTS.TASKS.TABLE.",O=parseInt(e.productId);c.model={$loading:!0,selectedUser:{},selectedRole:{}},c.global={};var P={},Q=[],R="PRODUCTS.WORKFLOW.STEPS.",S={formTitle:N+"TASK_PARAMS",cols:[{field:"startDate",title:R+"START_DATE",dataFormat:"date",dataRequired:!0},{field:"endDate",title:R+"END_DATE",dataFormat:"date",dataRequired:!0}]};g.$lock=!0,M(O).then(function(a){g.projectId!==a.projectId&&g.$setBy("projectId",a.projectId)}).then(function(){D()}),g.$watch("realm",c,function(){g.projectId&&(c.model.projectId=g.projectId,I().then(function(){c.model.users=P.users,c.model.groups=P.groups}))}),c.searchUsers=p,c.$on("$destroy",function(){v(),t(),g.$lock=!1});var T}]),angular.module("greyscaleApp").controller("ProductIndexesCtrl",["_","$q","$scope","$state","$stateParams","greyscaleProductApi","greyscaleUtilsSrv","greyscaleModalsSrv",function(a,b,c,d,e,f,g,h){function i(){c.model.indexesTable=j("index",q+"INDEXES_TABLE."),c.model.subindexesTable=j("subindex",q+"SUBINDEXES_TABLE.")}function j(a,d){return{title:d+"TABLE_TITLE",cols:[{field:"title",title:d+"TITLE",cellClass:"text-center"},{dataFormat:"action",actions:[{icon:"fa-pencil",handler:function(b){k(b,a)}},{icon:"fa-trash",handler:function(b){l(b,a)}}]}],dataPromise:function(){var d=b.defer();return"index"===a?d.resolve(c.model.indexes):"subindex"===a&&d.resolve(c.model.subindexes),d.promise},add:{handler:function(){k({},a)}}}}function k(a,b){h.editIndex(a,b,c.model.product).then(function(a){var d=[],e=!1;"index"===b?d=c.model.indexes:"subindex"===b&&(d=c.model.subindexes);for(var g=0;g<d.length;g++)if(d[g].id===a.id){d[g]=a,e=!0;break}e||d.push(a);var h;"index"===b?(c.model.indexesTable.tableParams.reload(),h=f.product(r).indexesListUpdate(c.model.indexes)):"subindex"===b&&(c.model.subindexesTable.tableParams.reload(),h=f.product(r).subindexesListUpdate(c.model.subindexes)),h.then(function(){o(c.model.product).then(p)})})}function l(a,b){var d=[];"index"===b?d=c.model.indexes:"subindex"===b&&(d=c.model.subindexes);for(var e=0;e<d.length;e++)if(d[e].id===a.id){d.splice(e,1);break}"index"===b?(c.model.indexesTable.tableParams.reload(),f.product(r).indexesListUpdate(c.model.indexes)):"subindex"===b&&(c.model.subindexesTable.tableParams.reload(),f.product(r).subindexesListUpdate(c.model.subindexes))}function m(){return n(r).then(o).then(p)}function n(a){return f.get(a).then(function(a){return d.ext.productName=a.title,a})["catch"](function(a){g.errorMsg(a,q+"PRODUCT_NOT_FOUND"),d.go("home")})}function o(a){var c=a.id,d={product:b.when(a),indexes:f.product(c).indexesList(),subindexes:f.product(c).subindexesList()};return b.all(d)}function p(a){c.model.product=a.product,c.model.indexes=a.indexes,c.model.subindexes=a.subindexes}var q="PRODUCTS.INDEXES.",r=parseInt(e.productId);c.model={indexes:[],subindexes:[]},i(),m().then(function(){c.model.indexesTable.tableParams.reload(),c.model.subindexesTable.tableParams.reload()})}]),angular.module("greyscaleApp").controller("PmDashboardProductCtrl",["_","$q","$scope","$state","$stateParams","greyscaleProductApi","greyscaleProductTasksTbl","$timeout","greyscaleUtilsSrv","greyscaleTokenSrv","greyscaleTaskApi","Organization","greyscaleModalsSrv",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){var b={force:!0};f.product(a.productId).taskMove(a.uoaId,b).then(function(){s.tableParams.reload()})["catch"](function(a){i.errorMsg(a,"Step moving")})}function o(a){m.sendNotification(a.user,{})}function p(a){var c={tasks:f.product(a).tasksList()};return b.all(c)}function q(a){var b=[];return angular.forEach(a,function(a){"completed"!==a.status&&a.flagged&&(~b.indexOf(a.uoaId)||b.push(a.uoaId))}),b.length}var r=e.productId,s=g;s.dataFilter.productId=r,s.expandedRowTemplateUrl="views/controllers/pm-dashboard-product-tasks-extended-row.html",s.expandedRowExtData={notifyUser:o,moveNextStep:n,$state:d};var t="/products/"+r+"/export.csv?token="+j();c.model={tasksTable:s,exportHref:i.getApiBase()+t,count:{}},f.get(r).then(function(a){return d.ext.productName=a.title,c.model.product=a,a}),l.$lock=!0,s.onReload=function(){var b=s.dataShare.tasks||[];c.model.count.uoas=a.size(a.groupBy(b,"uoaId")),c.model.count.flagged=q(b),c.model.count.started=a.filter(b,"started").length,c.model.count.onTime=a.filter(b,function(a){return a.onTime&&"current"===a.status}).length,c.model.count.late=a.filter(b,function(a){return!a.onTime&&"current"===a.status}).length,c.model.count.complete=a.filter(b,function(a){return a.subjectCompleted}).length,c.model.count.delayed=c.model.count.uoas-c.model.count.onTime},p(r).then(function(a){c.model.tasks=a.tasks}),c.$on("$destroy",function(){l.$lock=!1}),c.download=function(a){c.model.downloadHref||(a.preventDefault(),a.stopPropagation(),f.product(r).getTicket().then(function(b){c.model.downloadHref=f.getDownloadDataLink(b),h(function(){a.currentTarget.click()})}))}}]),angular.module("greyscaleApp").controller("OrganizationsCtrl",["$scope","greyscaleOrganizationsTbl",function(a,b){a.model={orgs:b}}]),angular.module("greyscaleApp").controller("SurveyEditCtrl",["$scope","$state","$stateParams","$timeout","greyscaleSurveyApi","Organization","greyscaleUtilsSrv","greyscaleGlobals",function(a,b,c,d,e,f,g,h){function i(){e.get(l).then(function(c){a.model={survey:c},b.ext.surveyName=c?c.title:"New survey",k!==c.projectId&&f.$setBy("projectId",c.projectId)})}function j(){var c;c=a.model.survey,c.projectId=k,(c.id?e.update(c):e.add(c)).then(function(){b.go("projects.setup.surveys",{projectId:k})})["catch"](function(a){if(a){var b="Survey update error";a.data&&a.data.message&&(b+=": "+a.data.message),g.errorMsg(b)}})}var k,l="new"===c.surveyId?null:c.surveyId;a.model={survey:{}},b.ext.surveyName="New survey",f.$lock=!0,l&&f.$watch(a,function(){k=f.projectId,i()}),a.save=function(){var b=a.$on(h.events.survey.builderFormSaved,function(){j(),b()});a.saveFormbuilder()},a.cancel=function(){b.go("projects.setup.surveys",{projectId:k})};var m=a.$on(h.events.survey.builderFormSaved,function(){a.dataForm.$setDirty(),d(function(){a.$digest()}),m()})}]),angular.module("greyscaleApp").controller("SurveyCtrl",["$scope","$stateParams","$q","greyscaleSurveyApi","greyscaleTaskApi","greyscaleProfileSrv","greyscaleProductApi","greyscaleProductWorkflowApi","greyscaleLanguageApi","greyscaleEntityTypeApi","greyscaleUoaApi","greyscaleDiscussionApi","$location","$state",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){var b=a.resolveList;return b[0]}function p(a,b){angular.forEach(a.questions,function(a){angular.forEach(b,function(b){b.questionId===a.id&&b.isReturn&&!b.isResolve&&(a.flagResolve=a.flagResolve||{},angular.extend(a.flagResolve,b)),b.questionId!==a.id||!b.isResolve||b.isReturn||b.activated||(a.flagResolve=a.flagResolve||{},a.flagResolve.draft=b,a.flagResolve.lastEntry=b.entry)})})}a.loading=!0;var q=b.taskId,r=b.surveyId;a.model={title:"",surveyData:null,showDiscuss:q};var s={},t=[],u=["allowEdit","allowTranslate","blindReview","discussionParticipation","provideResponses","seeOthersResponses","writeToAnswers"],v={survey:d.get(b.surveyId),profile:f.getProfile(),languages:i.list(),essence:j.list({name:"Survey Answers"})};q&&(v.task=e.get(b.taskId),v.scopeList=l.scopeList({taskId:b.taskId})),c.all(v).then(function(a){return s={survey:a.survey,task:a.task?a.task.plain():null,resolveData:a.scopeList?o(a.scopeList):null,userId:a.profile.id,languages:a.languages.plain(),essenceId:a.essence[0]?a.essence[0].id:null,flags:{}},s.resolveData&&(s.discussions=l.list({surveyId:r,taskId:q,filter:"resolve"})),t=[s.survey.title],a.task?c.all({product:g.get(a.task.productId),uoa:k.get({id:s.task.uoaId}),survey:s.survey,discussions:s.discussions}):c.reject()}).then(function(a){return t=[],a.product&&(s.product=a.product.plain(),t.push(s.product.title)),a.uoa&&(s.uoa=a.uoa.plain(),t.push(s.uoa.name)),a.discussions&&p(a.survey,a.discussions),s.product?h.workflow(s.product.workflow.id).stepsList():c.reject()}).then(function(a){var b,c=a.length;for(b=0;b<c;b++)if(s.task.stepId===a[b].id){var d,e=u.length;for(d=0;d<e;d++)s.flags[u[d]]=a[b][u[d]];s.task.step=a[b],t.push(s.task.step.title)}})["finally"](function(){s.flags.essenceId=s.essenceId,a.model.title=t.join(" - "),a.model.surveyData=s,a.model.showDiscuss=a.model.showDiscuss&&s.flags.discussionParticipation,a.loading=!1}),a.disableOnMove=function(b){b.isReturn&&(a.model.surveyData.disabledFields=!0)}}]),angular.module("greyscaleApp").controller("VisualizationCtrl",["$http","$scope","greyscaleSurveyApi",function(a,b,c){b.model={}}]),angular.module("greyscaleApp").controller("IndexVisualizationCtrl",["$http","$scope","greyscaleSurveyApi",function(a,b,c){b.model={title:"Index Visualization"}}]),angular.module("greyscaleApp").controller("GraphCtrl",["$scope",function(a){a.model={}}]),angular.module("greyscaleApp").controller("TableCtrl",["$scope","$http",function(a,b){var c=$.extend($.pivotUtilities.renderers,$.pivotUtilities.c3_renderers,$.pivotUtilities.d3_renderers,$.pivotUtilities.export_renderers),d={rows:[],cols:[],renderers:c,rendererName:"Table"};b.get("fixtures/mps.json").success(function(a){$("#pivotTable").pivotUI(a,d)}).error(function(a){console.log(a)})}]),angular.module("greyscaleApp").controller("NotificationsCtrl",["$rootScope","$scope","greyscaleNotificationsTbl",function(a,b,c){var d=c;b.model={notifications:d}}]),angular.module("greyscaleApp").controller("HomeCtrl",["$scope","greyscaleNotificationApi","greyscaleProfileSrv","greyscaleGlobals","Organization",function(a,b,c,d,e){function f(c){var d={userTo:c.id,read:!1};b.list(d,g).then(function(b){a.model.unreadMesages=b.length})}a.model={};var g;c.getProfile().then(function(a){return g=c.isSuperAdmin()?d.adminSchema:e.realm,a}).then(f)}]),angular.module("greyscaleApp").controller("VisualizationsCtrl",["$http","$scope","$q","Organization","greyscaleVisualizationApi","greyscaleModalsSrv","greyscaleComparativeVisualizationApi",function(a,b,c,d,e,f,g){function h(){b.model.visualizationsTable={title:l+"VISUALIZATIONS",cols:[{field:"title",title:l+"TITLE",cellClass:"text-center",cellTemplate:'<span ng-switch on="row.type"><a ng-href="#/visualizations/{{row.id}}" ng-switch-when="single">{{row.title}}</a><a ng-href="#/visualizations/comparative/{{row.id}}" ng-switch-when="comparative">{{row.title}}</a></span>'},{field:"type",title:l+"TYPE",cellClass:"text-center",cellTemplate:'<span ng-switch on="row.type"><span ng-switch-when="single">Single Product</span><span ng-switch-when="comparative">Comparative</span></span>'},{dataFormat:"action",actions:[{icon:"fa-edit",handler:j},{icon:"fa-trash",handler:i}]}],dataPromise:function(){var a=c.defer();return a.resolve(b.model.visualizations),a.promise},add:{handler:j}}}function i(a){for(var c=0;c<b.model.visualizations.length;c++)if(b.model.visualizations[c].id===a.id&&b.model.visualizations[c].type===a.type){b.model.visualizations.splice(c,1);break}b.model.visualizationsTable.tableParams.reload(),"comparative"===a.type?g(d.id).del(a.id):e(d.id).del(a.id)}function j(a){a||(a={}),f.editVisualization(a).then(function(a){var b=e;return"comparative"===a.type&&(b=g),a.id?(b(d.id).update(a.id,a),a):b(d.id).add(a).then(function(b){return a.id=b.id,a})}).then(function(a){for(var c=!1,d=0;d<b.model.visualizations.length;d++)if(b.model.visualizations[d].id===a.id&&b.model.visualizations[d].type===a.type){b.model.visualizations.splice(d,1);break}c||b.model.visualizations.push(a),b.model.visualizationsTable.tableParams.reload()})}function k(){return e(d.id).list().then(function(a){return b.model.visualizations=a.map(function(a){return a.type="single",a}),g(d.id).list().then(function(a){b.model.visualizations=b.model.visualizations.concat(a.map(function(a){return a.type="comparative",a}))})})}var l="VISUALIZATIONS.";b.model={},h(),d.$watch(b,function(){k().then(function(){b.model.visualizationsTable.tableParams.reload()})})}]),angular.module("greyscaleApp").controller("SuperusersCtrl",["$scope","greyscaleSuperusersTbl","greyscaleModalsSrv",function(a,b,c){var d=b;a.model={superusers:d},a.showUserInfo=function(a){c.showRec(a,d)}}]),angular.module("greyscaleApp").controller("SimpleFormCtrl",["$scope","$uibModalInstance","formData","extData",function(a,b,c,d){a.model=angular.copy(c),d&&(a.view=angular.copy(d)),a.close=function(){b.dismiss()},a.save=function(){b.close(a.model)}}]),angular.module("greyscaleApp").controller("ModalFormCtrl",["$scope","$uibModalInstance","recordData","recordForm",function(a,b,c,d){if(c=c||{},a.model=angular.copy(c),a.view=d,a.error="",a.showItem=function(a,b){return"function"==typeof a.showFormField?a.showFormField(b):void 0===a.showFormField||a.showFormField},a.close=function(){b.dismiss()},a.view.validationError){var e=a.$watch(function(){return a.view.validationError(a.model)},function(b){a.view.error=b,b||(a.error=null)});a.$on("$destroy",function(){e()})}a.save=function(){return a.error="",a.view.error?void(a.error=a.view.error):void(a.view.savePromise?a.view.savePromise(a.model).then(function(){b.close(a.model)})["catch"](function(b){a.error=b}):b.close(a.model))}}]),angular.module("greyscaleApp").controller("ModalRecInfoCtrl",["$scope","$uibModalInstance","recordData","recordForm",function(a,b,c,d){c=c||{},a.model=angular.copy(c),a.view=angular.copy(d),angular.forEach(a.view.cols,function(a){a.dataReadOnly="both",a.viewMode=!0}),a.showItem=function(a,b){return"function"==typeof a.showFormField?a.showFormField(b):void 0===a.showFormField||a.showFormField},a.close=function(){b.dismiss()}}]),angular.module("greyscaleApp").controller("ModalProductUoasCtrl",["$scope","$uibModalInstance","product","greyscaleProductUoasTbl",function(a,b,c,d){a.product=angular.copy(c);var e=d;e.dataFilter.productId=a.product.id,a.model={productUoas:e},a.close=function(){b.dismiss()},a.save=function(){b.close(a.model)}}]),angular.module("greyscaleApp").controller("ModalProductWorkflowCtrl",["_","$scope","$uibModalInstance","product","Organization","greyscaleProductWorkflowTbl",function(a,b,c,d,e,f){function g(){var a=h(),b=0;return angular.forEach(a,function(a){a.title&&""!==a.title&&a.role&&a.startDate&&a.endDate&&a.usergroupId&&a.usergroupId.length&&b++}),0!==b&&b==a.length}function h(){var b=i.tableParams.data,c=[];return angular.forEach(b,function(b,d){var e=a.pick(b,["id","role","startDate","endDate","title","discussionParticipation","seeOthersResponses","blindReview"]);e.usergroupId=a.map(b.groups,"id"),e.position=d,"noWriteToAnswers"===b.surveyAccess?e.writeToAnswers=!1:"writeToAnswers"===b.surveyAccess?e.writeToAnswers=!0:e.writeToAnswers=null,angular.forEach(k,function(a){e[a]=b.surveyAccess===a}),c.push(e)}),c}var i=f,j=d.workflow?d.workflow.id:void 0;i.dataFilter.workflowId=j,i.dataFilter.organizationId=e.id,i.dataFilter.product=d,b.model={product:angular.copy(d),productWorkflow:i},b.close=function(){c.dismiss()},b.save=function(){var a=h(),e={workflow:b.model.product.workflow||{},steps:a};e.workflow.productId=d.id,c.close(e)},b.validWorkflowSteps=g;var k=["provideResponses","allowEdit","allowTranslate"]}]),angular.module("greyscaleApp").controller("ModalUoasFilterCtrl",["$scope","$uibModalInstance","greyscaleUoaTypesFilterTbl","greyscaleUoaClassTypesFilter","greyscaleUoaTagsFilter","greyscaleUoasFilterTbl",function(a,b,c,d,e,f){var g=c,h=d,i=e,j=f;a.model={uoaTypes:g,uoaClassTypes:h,uoaTags:i,uoas:j},a.filterResult=[],g.multiselect.onChange=function(a){j.dataFilter.typeId=a,j.tableParams.reload()},h.multiselect.onChange=function(a){i.dataFilter.classTypeId=a,i.tableParams.reload()},i.multiselect.onChange=function(a){j.dataFilter.tagId=a,j.tableParams.reload()},j.multiselect.onChange=function(b){a.filterResult=b},a.addSelectedUoas=function(){b.close(a.filterResult)},a.close=function(){b.dismiss()},a.save=function(){b.close(a.model)}}]),angular.module("greyscaleApp").controller("ModalTranslationCtrl",["$scope","$q","_","greyscaleUtilsSrv","$uibModalInstance","translation","greyscaleLanguageApi","greyscaleTranslationApi","$log",function(a,b,c,d,e,f,g,h,i){function j(){e.dismiss()}function k(){a.model.translations.push(c.pick(f,["essenceId","entityId","field"]))}function l(b){a.model.translations.splice(b,1)}function m(){var c,d,g=[];for(c=0;c<a.model.translations.length;c++){d=a.model.translations[c],"bullet_points"===f.type&&n(d);for(var i=0;i<a.model.originalTrn.length;i++){var j=a.model.originalTrn[i];j.langId===d.langId&&(j.value===d.value?(a.model.originalTrn[i].task="nop",a.model.translations[c].task="nop"):(a.model.translations[c].task="edt",a.model.originalTrn[i].task="edt"))}}for(c=0;c<a.model.translations.length;c++)d=a.model.translations[c],d.task?"edt"===d.task&&(delete d.task,g.push(h.edit(d))):g.push(h.add(d));for(c=0;c<a.model.originalTrn.length;c++)d=a.model.originalTrn[c],d.task||g.push(h["delete"](d));e.close(b.all(g))}function n(a){a.valueArr||(a.valueArr=[],a.valueArr.length=p,a.valueArr.fill("")),a.valueArr[o]=a.value,a.value=angular.toJson(a.valueArr),delete a.valueArr}a.model={translations:[],originalTrn:[],languages:[],original:{}},a.close=j,a.add=k,a.del=l,a.save=m;var o=0,p=1,q={lang:g.list(),trns:h.listByEntity(f.essenceId,f.entityId,{field:f.field})};"bullet_points"===f.type&&(o=f.index||0,p=f.value.length),b.all(q).then(function(b){var c,d=b.lang.length,e=angular.copy(f);for(a.model.languages=[],c=0;c<d;c++)b.lang[c].id===e.langId?e.langId=b.lang[c].code:a.model.languages.push(b.lang[c]);if("bullet_points"===f.type){var g,h,i=b.trns.length;for(e.value=f.value[f.index].data,h=0;h<i;h++)g=angular.fromJson(b.trns[h].value),b.trns[h].valueArr=g,b.trns[h].value=g[o];a.model.translations=b.trns}else a.model.translations=b.trns;a.model.originalTrn=angular.copy(b.trns),a.model.original=e})}]),angular.module("greyscaleApp").controller("ModalProductTaskCtrl",["$scope","$uibModalInstance","task","activeBlock",function(a,b,c,d){a.model={task:c,activeBlock:d},a.close=function(){b.dismiss()}}]),angular.module("greyscaleApp").controller("ModalUserGroupsCtrl",["$scope","user","$uibModalInstance","Organization","greyscaleUserGroupsTbl",function(a,b,c,d,e){var f=e;f.dataFilter.organizationId=d.id,f.dataFilter.selectedIds=b.usergroupId,a.model={userGroups:f,user:angular.copy(b)},a.close=function(){c.dismiss()},a.save=function(){c.close(f.multiselect.selectedMap)}}]),angular.module("greyscaleApp").controller("ModalConfirmCtrl",["$scope","$uibModalInstance","params","i18n","$sce",function(a,b,c,d,e){c=c||{},c.message=e.trustAsHtml(d.translate(c.message,c)),a.params=c,a.close=function(){b.dismiss()},a.confirm=function(){b.close(a.model)}}]),angular.module("greyscaleApp").controller("ModalAnswerVersionCtrl",["$scope","$uibModalInstance","params","greyscaleUserApi",function(a,b,c,d){c=c||{},a.field=c.field;for(var e=a.field.prevAnswers.length,f=[],g={};e--;)f.indexOf(a.field.prevAnswers[e].userId)===-1&&f.push(a.field.prevAnswers[e].userId);f.length>0&&d.list({id:f.join("|")}).then(function(a){var b,c=a.length;for(b=0;b<c;b++)g[a[b].id]=a[b]}),a.close=function(){b.close(a.model)},a.getOptionLabel=function(b){if(b)for(var c=0;c<a.field.options.length;c++)if(a.field.options[c]&&b===a.field.options[c].id)return a.field.options[c].label},a.getUserName=function(a){var b="";return g[a]&&(b=[g[a].firstName,g[a].lastName].join(" ")),b}}]),angular.module("greyscaleApp").controller("ModalSendNotificationCtrl",["$scope","user","data","greyscaleUtilsSrv","greyscaleProfileSrv","$uibModalInstance","greyscaleNotificationApi","inform","i18n",function(a,b,c,d,e,f,g,h,i){a.model={user:b,notification:{userTo:b.id,notifyLevel:2}},a.close=function(){f.dismiss()},a.send=function(){a.validForm()&&g.send(a.model.notification).then(function(){f.close(),h.add(i.translate("NOTIFICATIONS.SEND_SUCCESS"),{type:"success"})})["catch"](function(a){d.errorMsg(a,"Send Message Error")})},a.validForm=function(){return a.model.notification.body&&""!==a.model.notification.body}}]),angular.module("greyscaleApp").controller("ModalChangePasswordCtrl",["$scope","user","data","greyscaleUtilsSrv","greyscaleProfileSrv","$uibModalInstance","greyscaleUserApi","inform","i18n",function(a,b,c,d,e,f,g,h,i){a.model={user:b,form:{id:b.id}},a.close=function(){f.dismiss()},a.save=function(){g.update(a.model.form,c.realm).then(function(){f.close(),h.add(i.translate("USERS.CHANGE_PASSWORD_SUCCESS"),{type:"success"})})["catch"](function(a){d.errorMsg(a,"Change Password Error")})}}]),angular.module("greyscaleApp").controller("ModalEditIndexCtrl",["$scope","index","type","product","$uibModalInstance","$q","greyscaleQuestionApi","greyscaleProductApi",function(a,b,c,d,e,f,g,h){function i(){j().then(k)}function j(){return g.get(d.surveyId).get().then(function(b){a.model.questions=b})}function k(){return h.product(d.id).subindexesList().then(function(b){a.model.subindexes=b})}function l(){var b=p+"WEIGHTS.",d=[];"index"===c?(d.push({field:"type",title:b+"TYPE",cellTemplate:'<select class="form-control" ng-model="row.type"><option value="question">Question</option><option value="subindex">Subindex</option></select>'}),d.push({field:"field",title:b+"FIELD",cellTemplate:'<div ng-switch on="row.type"><select class="form-control" ng-model="row.field" ng-options="question.id as question.label for question in ext.questions()" ng-switch-when="question"></select><select class="form-control" ng-model="row.field" ng-options="subindex.id as subindex.title for subindex in ext.subindexes()" ng-switch-when="subindex"></select></div>',cellTemplateExtData:{questions:function(){return a.model.questions},subindexes:function(){return a.model.subindexes}}})):"subindex"===c&&d.push({field:"field",title:b+"QUESTION",cellTemplate:'<select class="form-control" ng-model="row.field" ng-options="question.id as question.label for question in ext.questions()"></select>',cellTemplateExtData:{questions:function(){return a.model.questions}}}),d.push({field:"weight",title:b+"WEIGHT",cellTemplate:'<input type="number" name="weight" ng-model="row.weight.weight" class="form-control input-sm" required/>'}),d.push({field:"weight",title:b+"TYPE",cellTemplate:'<select class="form-control" ng-model="row.weight.type"><option value="value">Value</option><option value="percentile">Percentile Rank</option></select>'}),"index"===c?d.push({field:"weight",title:b+"AGGREGATE_TYPE",cellTemplate:'<select ng-show="ext.needsAggregate(row.type, row.field)" class="form-control" ng-model="row.weight.aggregateType"><option value="sum">Sum</option><option value="average">Average</option></select><div class="aggregate-type" ng-hide="ext.needsAggregate(row.type, row.field)">N/A</div>',cellTemplateExtData:{needsAggregate:function(b,c){if("question"!==b)return!1;var d=_.findWhere(a.model.questions,{id:c});return d&&2===d.type}}}):"subindex"===c&&d.push({field:"weight",title:b+"AGGREGATE_TYPE",cellTemplate:'<select ng-show="ext.needsAggregate(row.field)" class="form-control" ng-model="row.weight.aggregateType"><option value="sum">Sum</option><option value="average">Average</option></select><div class="aggregate-type" ng-hide="ext.needsAggregate(row.field)">N/A</div>',cellTemplateExtData:{needsAggregate:function(b){var c=_.findWhere(a.model.questions,{id:b});return c&&2===c.type}}}),d.push({dataFormat:"action",actions:[{icon:"fa-trash",handler:m}]}),a.model.weightsTable={cols:d,dataPromise:function(){var b=f.defer();return b.resolve(a.model.weights),b.promise},add:{handler:function(){a.model.weights.push({}),a.model.weightsTable.tableParams.reload()}}}}function m(b){for(var c=0;c<a.model.weights.length;c++)if(a.model.weights[c].id===b.id&&a.model.weights[c].type===b.type){a.model.weights.splice(c,1);break}a.model.weightsTable.tableParams.reload()}function n(){var d=[];if("index"===c){for(var e in b.questionWeights)d.push({type:"question",field:parseInt(e),weight:b.questionWeights[e]});for(var f in b.subindexWeights)d.push({type:"subindex",field:parseInt(f),weight:b.subindexWeights[f]})}else if("subindex"===c)for(var e in b.weights)d.push({type:"question",field:parseInt(e),weight:b.weights[e]});a.model.weights=d}function o(){"index"===c?(a.model.index.questionWeights={},a.model.index.subindexWeights={},a.model.weights.forEach(function(b){"question"===b.type?a.model.index.questionWeights[b.field]=b.weight:"subindex"===b.type&&(a.model.index.subindexWeights[b.field]=b.weight)})):"subindex"===c&&(a.model.index.weights={},a.model.weights.forEach(function(b){a.model.index.weights[b.field]=b.weight}))}var p="PRODUCTS.INDEXES.FORM.";a.model={index:angular.copy(b),questions:[],subindexes:[],type:c,weights:[]},a.close=function(){e.dismiss()},a.save=function(){o(),e.close(a.model.index)},n(),l(),i()}]),angular.module("greyscaleApp").controller("ModalEditVisualizationCtrl",["$scope","visualization","$uibModalInstance","$q",function(a,b,c,d){a.model={visualization:angular.copy(b)},a.model.visualization.type||(a.model.visualization.type="single"),a.close=function(){c.dismiss()},a.save=function(){c.close(a.model.visualization)}}]),angular.module("greyscaleApp").controller("MyTasksWidget",["_","$scope","greyscaleTaskApi",function(a,b,c){b.model={},c.myList().then(function(c){b.model.tasks=a.filter(c,function(a){return"current"===a.status})})}]),angular.module("greyscaleApp").controller("PmProjectsWidgetCtrl",["_","$scope","greyscaleProjectApi","$q","Organization",function(a,b,c,d,e){function f(){var d=e.projectId;d&&c.productsList(d,{},e.realm).then(function(c){b.model.products=a.filter(c,function(a){return 0!==a.status})})}b.model={},e.$watch("realm",b,f)}]),angular.module("greyscaleApp").directive("sidebar",["$cookies",function(a){return{templateUrl:"views/directives/sidebar.html",scope:{toggle:"=",menu:"="},restrict:"AE",link:function(b){b.toggle=!!a.get("toggle"),b.toggleSidebar=function(){b.toggle=!b.toggle,a.put("toggle",b.toggle)}}}}]),angular.module("greyscaleApp").directive("headerbar",function(){return{template:'<div class="meta"><div class="page">{{model.title|translate:{ext:stateExt} }}</div><div class="breadcrumb-links"><ul class="breadcrumb"><li ng-repeat="parent in model.path"><a ui-sref="{{parent.route}}">{{parent.name|translate:{ext:stateExt} }}</a></li><li class="active">{{model.title|translate:{ext:stateExt} }}</li></ul></div></div>',scope:{},restrict:"E",replace:!0,controller:["$scope","$state",function(a,b){function c(a){for(var b=[];a;)a.data&&a.data.name&&b.unshift({route:a.name,name:a.data.name}),a=a.parent;return b}a.stateExt=b.ext,a.$on("$stateChangeSuccess",function(){a.model={title:b.current.data.name,path:c(b.$current.parent)}})}]}}),angular.module("greyscaleApp").directive("loginForm",["greyscaleUserApi","greyscaleEnv","greyscaleGlobals",function(a,b,c){return{templateUrl:"views/directives/login-form.html",restrict:"AE",scope:{},controller:["$scope","$rootScope",function(d,e){function f(){angular.extend(d.model,{realms:[],error:null})}d.model={login:b.defaultUser||"",password:b.defaultPassword||"",realms:[],error:null},d.loginChange=f,d.submitLogin=function(){d.loginForm.$valid?a.login(d.model.login,d.model.password).then(function(){e.$emit(c.events.common.login)})["catch"](function(a){a&&a.data&&300===a.data.e?d.model.realms=a.data.message:d.model.error="LOGIN.CHECK_EMAIL_PASSWORD"}):d.model.error="LOGIN.CHECK_LOGIN_PASSWORD"}}]}}]),angular.module("greyscaleApp").directive("remindForm",["greyscaleUserApi","greyscaleEnv",function(a,b){return{templateUrl:"views/directives/remind-form.html",restrict:"AE",scope:{},controller:["$scope",function(c){c.model={login:{label:"LOGIN.EMAIL",value:b.defaultUser||""},error:null,success:"",realms:[]},c.remind=function(){c.loginForm.$valid?(c.model.error="",a.remindPasswd(c.model.login.value).then(function(){c.model.success="LOGIN.TOKEN_SENT"})["catch"](function(a){a&&a.data&&300===a.data.e?c.model.realms=a.data.message:c.model.error="LOGIN.LOGIN_INCORRECT"})):c.model.error="LOGIN.CHECK_LOGIN_PASSWORD"}}]}}]),angular.module("greyscaleApp").directive("activateForm",["$state","greyscaleUserApi","greyscaleUtilsSrv",function(a,b,c){return{templateUrl:"views/directives/activation-form.html",restrict:"AE",scope:{model:"=activateForm"},link:function(d){d.activate=function(){d.model.err=null;var e={password:d.model.password,firstName:d.model.firstName,lastName:d.model.lastName};b.activate(d.model.activationToken,e).then(function(){return b.login(d.model.email,d.model.password)}).then(function(){a.go("profile")})["catch"](c.errorMsg)}}}}]),angular.module("greyscaleApp").directive("resetForm",["$state","$stateParams","greyscaleRealmSrv","greyscaleUserApi",function(a,b,c,d){return{templateUrl:"views/directives/reset-form.html",restrict:"AE",scope:{token:"=resetForm"},controller:["$scope",function(e){function f(a){a.data&&a.data.message&&(e.model.err=a.data.message)}if(e.model={login:"",err:"",success:""},"reset"===a.current.name){var g=b.realm;g&&c.init(g),d.resetToken(e.token).then(function(a){e.model={email:a.email}})["catch"](f)}e.reset=function(){d.resetPasswd({token:e.token,password:e.model.password}).then(function(){e.model.success="LOGIN.RESET_SUCCESS"})["catch"](f)}}]}}]),angular.module("greyscaleApp").directive("isEqual",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){if(d){var e=function(){var a=d.$viewValue,b=c.isEqual;d.$setValidity("equal",a===b)};a.$watch(c.ngModel,function(){e()}),c.$observe("isEqual",function(){e()})}}}}),angular.module("greyscaleApp").service("widgetTableSrv",["_","$q","NgTableParams","$filter","$compile","i18n","$timeout","$templateCache","$rootScope","ngTableEventsChannel","greyscaleGlobals",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=a.scope,e=a.model;e.el=a.el,e.current=null,b.sortableOptions={disabled:!0},o(e),e.tableParams&&e.tableParams instanceof c||(p(e),e.tableParams=new c({page:1,count:void 0!==e.pageLength?e.pageLength:s.pageLength||999999999,sorting:e.sorting||null},{counts:e.pageLengths||[],getData:function(a,b){if("function"==typeof e.dataPromise){var c;void 0===e.$loading?e.$loading=!0:c=setTimeout(function(){e.$loading=!0},150);var f=function(){clearTimeout(c),e.$loading=!1};e.dataPromise().then(function(c){if(e.dataMap=n(c),c){b.total(c.length);var g=b.sorting()?d("orderBy")(c,b.orderBy()):c;a.resolve(!!angular.isArray(g)&&g.slice((b.page()-1)*b.count(),b.page()*b.count()))}f()})["catch"](f)}}}),"function"==typeof e.onInit&&e.onInit(),e.tableParams.custom={showAllButton:void 0!==e.showAllButton?e.showAllButton:s.showAllButton},e.tableParams.pager=m(b)),e.dragSortable&&(b.sortableOptions={handle:".action-drag-sortable",start:function(a,b){b.placeholder.height(b.item.height())}}),b.isSelected=function(a){return"undefined"!=typeof b.rowSelector&&e.current===a},b.isDisabled=function(a){return!!e.multiselect&&(e.multiselect.disableOnUncheck&&!e.multiselect.selected[a.id])},b.select=function(a,c){e.selectable&&(e.current=a,"function"==typeof b.rowSelector?b.rowSelector(a):b.rowSelector=a)},b.$on("$destroy",function(){e.multiselect&&e.multiselect.reset&&e.multiselect.reset(),e.$loading=void 0}),j.onAfterReloadData(function(){e.tableParams.data&&0===e.tableParams.data.length&&e.dataMap&&e.dataMap.length>0&&e.tableParams.pager.prev(),"function"==typeof a.onReload&&a.onReload();
},b),b.$getRowClass=function(a){return"function"==typeof e.rowClass?e.rowClass(a):e.rowClass}}function m(a){var b=a.model.tableParams;return{from:function(){return 1+b.count()*(b.page()-1)},to:function(){var a=b.count()*b.page();return a>b.total()&&(a=b.total()),a},first:function(){return 1===b.page()},last:function(){return this.to()===b.total()},itemsName:function(){return a.model.title?a.model.title+" ":""},prev:function(){this.first()||b.page(b.page()-1)},next:function(){this.last()||b.page(b.page()+1)}}}function n(a){var b=[];return angular.forEach(a,function(a){b.push(a.id)}),b}function o(a){var b=["formTitle","title"];angular.forEach(b,function(b){a[b]=f.translate(a[b])})}function p(a){angular.forEach(a.cols,function(b,c){b["class"]=b["class"]||"",b.multiselect&&r(b,a),b.actions&&(b["class"]+=" header-actions"),b.textCenter&&(b["class"]+=" text-center"),b.title&&(b.title=f.translate(b.title)),b.titleTemplate&&q(b,b.titleTemplateExtData)})}function q(a,b){var c=a.titleTemplate,d="widget-table-"+Math.random(),f=i.$new();f.ext=b||{},c=e("<div>"+c+"</div>")(f),h.put(d,c),a.headerTemplateURL=function(){return d}}function r(b,c){function d(a){return function(){var b=this.selectAllState;angular.forEach(a.dataMap,function(c){a.multiselect.selected[c]=b})}}function e(a){return function(){return f(a)}}function f(a){var b=[];angular.forEach(a.dataMap,function(c){a.multiselect.selected[c]&&b.push(c)}),a.multiselect.selectedMap=b,"function"==typeof a.multiselect.onChange&&a.multiselect.onChange(b)}function g(){c.multiselect.selected={},c.multiselect.selectedMap=[],c.multiselect.selectAllState=!1}function h(b,d){g(),d?angular.forEach(a.filter(b,d),function(a){c.multiselect.selectedMap.push(a[d]),c.multiselect.selected[a[d]]=!0}):angular.forEach(b,function(a){c.multiselect.selectedMap.push(a),c.multiselect.selected[a]=!0})}c.multiselect&&c.multiselect.init||(b["class"]="header-multiselect",b.headerTemplateURL=function(){return"ng-table/headers/check-all.html"},c.multiselect=angular.extend({init:!0,selected:{},selectedMap:[],selectAllState:!1,disableOnUncheck:b.multiselectDisableOnUncheck,selectAll:d(c),fireChange:e(c),reset:g,onChange:function(){},setSelected:h},c.multiselect||{}))}var s=k.widgetTableDefaults;return{init:l,defaults:s}}]).directive("widgetTable",["_","$templateCache","$compile","$http","$timeout","ngTableEventsChannel",function(a,b,c,d,e,f){function g(a,b){$(b).on("mouseenter",".column-hover",function(){var a=$(this),b=a.context.cellIndex,c=a.closest("table"),d=c.find(".column-hover");d.each(function(a,c){c=$(c),c.context.cellIndex===b?c.addClass("column-hovered"):c.removeClass("column-hovered")})})}function h(a,b){var c=a.model.expandedRowTemplate,d=a.model.expandedRowTemplateUrl;(c||d)&&(d?i(d).then(function(c){k(b,c,a,a.model.expandedRowExtData)}):c&&k(b,c,a,a.model.expandedRowExtData),j(b))}function i(a){return d.get(a,{cache:b}).then(function(a){return a.data})}function j(a){a.on("mouseenter mouseleave",".expandable-row, .expand-row",function(a){var b=$(this),c=b.hasClass("expand-row"),d=c?b.prev():b,e="mouseenter"===a.type?"addClass":"removeClass";d[e]("is-hovered")})}function k(a,b,c,d){a.on("click",".action-expand-row",function(a){var e=$(a.target).closest(".expandable-row");e.hasClass("is-expanded")?m(e,c):l(e,b,c,d)}),a.on("click",".action.expand-all",function(){var b=$(this);b.hasClass("all-expanded")?(a.find(".action-expand-row.is-expanded").click(),b.removeClass("all-expanded")):(a.find(".action-expand-row:not(.is-expanded)").click(),b.addClass("all-expanded"))}),c.$openExpandedRow=function(a){l(a,b,c,d)},f.onAfterReloadData(function(){var b=a.find(".action.expand-all");b.length&&(c.model.expandedRowShow?b.addClass("all-expanded"):b.removeClass("all-expanded"))},c)}function l(a,b,d,f){var g=a.next();if(g.length&&g.hasClass("expand-row"))g.show();else{var h=d.model.cols.length,i=$('<tr class="expand-row"><td colspan="'+h+'">'+b+"</td></tr>"),j=a.scope();j.ext=f||{},c(i)(j),e(function(){a.after(i),j.$digest()})}a.addClass("is-expanded")}function m(a,b){var c=a.next();c.length&&c.hasClass("expand-row")&&c.hide(),a.removeClass("is-expanded")}function n(a,b){var c=a.model.delegateClick;c&&angular.isObject(c)&&angular.forEach(c,function(a,c){"function"==typeof a&&b.on("click",c,function(b){b.stopPropagation(),b.preventDefault();var c=angular.element(b.target);a(b,c.scope())})})}return{restrict:"E",templateUrl:"views/directives/widget-table.html",scope:{model:"=",rowSelector:"=",classes:"@class"},link:function(a,b){b.find("table").addClass(a.model.classes),b.removeAttr("class"),h(a,b),n(a,b),a.model.columnShowOnHover&&g(a,b)},controller:["$scope","$element","widgetTableSrv",function(a,b,c){c.init({el:b,scope:a,model:a.model,rowSelector:a.rowSelector,onReload:function(){"function"==typeof a.model.onReload&&a.model.onReload()}})}]}}]).directive("widgetTableExpandedRowOpen",function(){return{restrict:"A",scope:{open:"=widgetTableExpandedRowOpen"},link:function(a,b){a.open&&a.$parent.$openExpandedRow(b)}}}),angular.module("greyscaleApp").directive("widgetTableCell",["_","$sce","$timeout","$filter","$compile","$q","$http","$templateCache",function(a,b,c,d,e,f,g,h){return{restrict:"A",scope:{widgetCell:"=widgetTableCell",rowValue:"=",modelMultiselect:"="},link:function(b,f){function i(d,f){var g={};g[d.keyField]=b.rowValue[t];var h=a.find(f,g);if(b.model="",h)if(b.option=h,d.valField)b.model=h[d.valField];else if(d.template){var i=e("<span>"+d.template+"</span>")(b);c(function(){b.model=i.text()})}}function j(a,c){if(b.row=b.rowValue,b.cell=b.model,b.ext=c,f.hasClass("compiled")){var d=f.find(">a"),g=e("<div>"+a+"</div>")(b);d.length?d.append(g):f.append(g)}else f.append(a)}function k(){l(r.cellTemplateUrl).then(function(a){j(a,r.cellTemplateExtData)})}function l(a){return g.get(a,{cache:h}).then(function(a){return a.data})}function m(){f.addClass("text-center"),f.append('<div class="form-group"><div class="checkbox"><label><input type="checkbox" class="multiselect-checkbox disable-control" ng-model="modelMultiselect.selected[rowValue.id]" ng-change="modelMultiselect.fireChange()" /><div class="chk-box"></div></label></div></div>')}function n(){f.append(r.dataFormat?d(r.dataFormat)(b.rowValue[t]):b.rowValue[t])}function o(){var a=f.html(),c=angular.element("<a>"+a+"</a>");r.link.state?c.attr("ui-sref",r.link.state):r.link.href&&c.attr("ng-href",r.link.href),r.link.target&&c.attr("target",r.link.target),r.link.handler&&(c.attr("href",""),c.on("click",function(a){a.preventDefault(),a.stopPropagation();var c=b.$parent.$parent.row;r.link.handler(c)})),f.html(""),f.append(c),b.item=b.rowValue}function p(){if(r.field&&r.field.match(/\w+\.\w+/)){var a=r.field.split(".");b.rowValue=b.rowValue[a[0]]||{},r.field=a[1]}}function q(){switch(f.addClass("input-cell"),f.append('<div class="form-group" modal-form-rec="model" embedded="true" modal-form-field="widgetCell" modal-form-field-model="model.'+t+'" ></div>'),r.dataFormat){case"date":f.addClass("auto-width");break;case"boolean":f.addClass("text-center")}e(f.contents())(b)}var r=angular.copy(b.widgetCell);p();var s,t=r.field;if(s="function"==typeof r.showDataInput?r.showDataInput():r.showDataInput)b.model=b.rowValue,q();else if(r.show){switch(b.model=b.rowValue[t],r.dataFormat){case"action":f.addClass("text-right row-actions"),r.textLeft&&(f.removeClass("text-right"),f.addClass("text-left")),f.append('<a ng-repeat="act in widgetCell.actions" title="{{act.tooltip||act.getTooltip(rowValue)|translate}}" class="action action-{{act.class||act.getClass(rowValue)}}" ng-init="icon = act.icon||act.getIcon(rowValue)"ng-click="act.handler && act.handler(rowValue); act.handler && $event.stopPropagation();"><i class="fa {{icon}}" ng-show="icon"> </i>{{act.title|translate}}</a>'),e(f.contents())(b);break;case"option":var u=r.dataSet;u.getData?i(u,u.getData(b.rowValue)):u.dataPromise&&u.dataPromise(b.rowValue).then(function(a){i(u,a)}),r.cellTemplateUrl?l(r.cellTemplateUrl).then(function(a){j(a,r.cellTemplateExtData)}):r.cellTemplate?j(r.cellTemplate,r.cellTemplateExtData):f.append("{{model}}");break;case"boolean":b.rowValue[t]===!0?f.append('<span class="text-success"><i class="fa fa-check"></i></span>'):b.rowValue[t]===!1&&f.append('<span class="text-danger"><i class="fa fa-minus"></i></span>');break;case"text":case"textarea":f.append(b.rowValue[t]);break;default:r.multiselect?m():r.cellTemplate?j(r.cellTemplate,r.cellTemplateExtData):r.cellTemplateUrl?k():n()}r.link&&o(),r.textCenter&&f.addClass("text-center"),r.cellClass&&f.addClass(r.cellClass),e(f.contents())(b),f.addClass("compiled")}}}}]),angular.module("greyscaleApp").directive("formBuilder",["greyscaleGlobals","$compile","$timeout","i18nData",function(a,b,c,d){return{templateUrl:"views/directives/form-builder.html",restrict:"E",link:function(e,f,g){function h(b){var d,f,g=JSON.parse(b).fields,h=[];for(d=0;d<g.length;d++){var i=k.indexOf("yes_no"===g[d].field_type?"radio":g[d].field_type);if(i!==-1){var j=g[d].field_options,m={label:g[d].label,cid:g[d].cid,isRequired:g[d].required,attachment:g[d].attachment,hasComments:g[d].hasComments,withLinks:g[d].withLinks,type:i,surveyId:e.model.survey.id,position:d+1};if(h.push(m),j&&(m.description=j.description?j.description:"",m.qid=j.qid?j.qid:"",m.skip=j.skip&&!isNaN(j.skip)?parseInt(j.skip):0,m.size=j.size?l.indexOf(j.size):0,j.minlength&&!isNaN(j.minlength)?m.minLength=parseInt(j.minlength):j.min&&!isNaN(j.min)&&(m.minLength=parseInt(j.min)),j.maxlength&&!isNaN(j.maxlength)?m.maxLength=parseInt(j.maxlength):j.max&&!isNaN(j.max)&&(m.maxLength=parseInt(j.max)),m.isWordmml=j.min_max_length_units?"words"===j.min_max_length_units:void 0,m.incOtherOpt=j.include_other_option,m.units=j.units,m.intOnly=j.integer_only,m.value=j.value,m.links=j.links&&j.links.length>0?JSON.stringify(j.links):void 0,m.optionNumbering=j.option_numbering?j.option_numbering:void 0,j.options))for(m.options=[],f=0;f<j.options.length;f++){var n=j.options[f];m.options.push({id:n.id,label:n.label,value:n.value,isSelected:n.checked})}}}for(e.model.survey.questions||(e.model.survey.questions=[]),d=e.model.survey.questions.length-1;d>=0;d--)if(e.model.survey.questions[d]){if(!e.model.survey.questions[d].deleted){var o=!1;for(f=h.length-1;f>=0;f--)"c"+e.model.survey.questions[d].id===h[f].cid&&(o=!0,delete h[f].cid,h[f].id=e.model.survey.questions[d].id,e.model.survey.questions[d]=h[f],h.splice(f,1));o||(e.model.survey.questions[d].id?e.model.survey.questions[d].deleted=!0:e.model.survey.questions.splice(d,1))}}else e.model.survey.questions.splice(d,1);for(d=0;d<h.length;d++)delete h[d].cid,e.model.survey.questions.push(h[d]);e.model.survey.questions.sort(function(a,b){return a.position-b.position}),e.$emit(a.events.survey.builderFormSaved),c(function(){e.$apply()})}function i(){var c,g,i=[];if(e.model.survey&&e.model.survey.questions)for(c=0;c<e.model.survey.questions.length;c++){var m=e.model.survey.questions[c];if(m){var n=k[m.type];if(n){var o={cid:"c"+m.id,field_type:n,label:m.label,required:m.isRequired,attachment:m.attachment,hasComments:m.hasComments,withLinks:m.withLinks,field_options:{description:m.description,size:m.size&&m.size>-1?l[m.size]:"small",minlength:m.minLength?m.minLength:void 0,maxlength:m.maxLength?m.maxLength:void 0,min_max_length_units:m.isWordmml?"words":"charecters",min:m.minLength?m.minLength:void 0,max:m.maxLength?m.maxLength:void 0,include_other_option:m.incOtherOpt,include_blank_option:m.incOtherOpt,units:m.units,integer_only:m.intOnly,qid:m.qid,value:m.value,links:m.links?JSON.parse(m.links):[],option_numbering:m.optionNumbering}};if(i.push(o),m.options)for(o.field_options.options=[],g=0;g<m.options.length;g++)m.options[g]&&o.field_options.options.push({id:m.options[g].id,label:m.options[g].label,value:m.options[g].value,checked:m.options[g].isSelected})}}}j&&j.off("save"),window.Formbuilder&&(angular.extend(window.Formbuilder.options.dict,d.translations.FORMBUILDER||{}),j=new window.Formbuilder({selector:"#formbuilder",bootstrapData:i}),e.saveFormbuilder=function(){j.mainView.formSaved?e.$emit(a.events.survey.builderFormSaved):j.mainView.saveForm()},j.on("save",h));var p,q=$("[form-builder-control]");q.length&&(p=q.clone().html(),f.find(".fb-form").after(b(p)(e)))}var j,k=a.formBuilder.fieldTypes,l=["small","medium","large"];e.$watch(g.ngModel,i)}}}]),angular.module("greyscaleApp").directive("graphBuilder",["$window","greyscaleSurveyApi","_",function(a,b,c){return{templateUrl:"views/directives/graph-builder.html",restrict:"E",link:function(a,d,e){function f(a,b,d){var e=[],f=[],g=c.groupBy(a,b);return c.forEach(g,function(a,b){e.push(b);var g=0;c.forEach(a,function(a){g+=a[d]}),f.push(g/a.length)}),h(e,f)}function g(a,b){var d=[],e=[],f=c.groupBy(a,b);return c.forEach(f,function(a,b){d.push(b),e.push(a.length)}),h(d,e)}function h(a,b){var c=i(a,b);return j(c)}function i(a,b){var d=c.zip(a,b),e=c.sortBy(d,function(a){return a[0]}),f=c.unzip(e);return[f[0],f[1]]}function j(a){return[{x:a[0],y:a[1]}]}a.graphTypes=["Bar","Line","Scatter"],a.data=[{country:"United States",value:"B",score:20},{country:"Canada",value:"B",score:21},{country:"Australia",value:"B",score:22},{country:"United Kingdom",value:"A",score:23},{country:"Mexico",value:"C",score:24},{country:"Argentina",value:"C",score:25}],b.list().then(function(b){a.surveys=b});var k={autosize:!0,margin:{l:50,r:50,b:100,t:100,pad:4},xaxis:{title:"",titlefont:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}},yaxis:{title:"",titlefont:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}},width:$("#viz").width()-20};a.drawGraph=function(){var b;switch(a.graphY){case"Count":b=g(a.data,a.graphX);break;default:b=f(a.data,a.graphX,a.graphY)}switch(a.graphType){case"Scatter":b[0].type="scatter",b[0].mode="markers";break;case"Line":b[0].type="scatter";break;case"Bar":b[0].type="bar";break;default:b[0].type="bar"}k.xaxis.title=a.graphX,k.yaxis.title=a.graphY,Plotly.newPlot("viz",b,k)}}}}]),angular.module("greyscaleApp").directive("selectDate",["i18n","$locale",function(a,b){return{template:'<p class="input-group"><input type="text" class="form-control {{class}}" id="{{dataId}}" name="{{dataId}}" uib-datepicker-popup ng-model="result" gs-valid="validator" is-open="model.opened" min-date="minDate" max-date="maxDate" datepicker-options="model.dateOptions" ng-required="{{model.required}}" required="{{model.required}}" {{embedded}} ng-readonly="{{model.readonly}}"close-text="{{model.closeText}}" placeholder="{{model.placeholder}}"/><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event)" ng-disabled="{{model.disabled}}"><i class="glyphicon glyphicon-calendar"></i></button></span></p>',restrict:"E",required:"^ngModel",scope:{result:"=",minDate:"=",maxDate:"=",options:"=",validator:"=?"},controller:["$scope","$element",function(c,d){c.dataId=d.attr("data-id"),void 0!==d.attr("embedded")&&(c["class"]="embedded"),c.model={opened:!1,err:null},!c.result||c.result instanceof Date||(c.result=new Date(c.result)),angular.extend(c.model,c.options);var e=b.DATETIME_FORMATS.FIRSTDAYOFWEEK+1;e>6&&(e=0),c.model.dateOptions=c.model.dateOptions||{},c.model.dateOptions.startingDay=e,c.model.placeholder=c.model.placeholder||a.translate("DATEPICKER.PLACEHOLDER"),c.open=function(){c.model.opened=!0}}]}}]),angular.module("greyscaleApp").directive("modalFormHeader",function(){return{restrict:"E",replace:!0,transclude:!0,template:'<div class="modal-header"><button class="close" ng-click="close()" aria-label="{{\'COMMON.CLOSE\'|translate}}" data-dismiss="modal" type="button"><i class="fa fa-times"></i></button><h2 class="modal-title" ng-transclude></h2></div>'}}),angular.module("greyscaleApp").directive("modalFormField",["$compile","$timeout","greyscaleUtilsSrv","$templateCache","$http","gsModelValidators","$translate",function(a,b,c,d,e,f,g){return{restrict:"A",scope:{modalFormRec:"=",modalFormField:"=",modalFormFieldModel:"="},link:function(b,h,i){function j(c,d){b.row=b.modalFormRec,b.cell=b.modalFormFieldModel,b.ext=d;var e=a("<span>"+c+"</span>")(b);return e.html()}function k(a){return e.get(a,{cache:d}).then(function(a){return a.data})}var l=b.modalFormField;if(l.dataHide&&!l.viewMode)return void h.remove();var m=!!b.modalFormRec.id,n=!!i.embedded;if((!l.viewMode||!l.viewHide)&&(l.title||l.viewMode&&(l.cellTemplate||l.cellTemplateUrl))){var o="",p=l.title&&""!==l.title?":":"",q=g.instant(l.title);if(n||(h.append('<label for="'+l.field+'" class="col-sm-3 control-label" ng-class="{required:modalFormField.dataRequired}">'+q+p+"</label>"),o+='<div class="col-sm-9'),"both"===l.dataReadOnly||m&&"edit"===l.dataReadOnly){switch(n||(o+='"><p class="form-control-static">'),l.dataFormat){case"boolean":b.modalFormFieldModel===!0?o+='<span class="text-success"><i class="fa fa-check"></i></span>':b.modalFormFieldModel===!1&&(o+='<span class="text-danger"><i class="fa fa-minus"></i></span>');break;case"date":o+="{{modalFormFieldModel|date}}";break;case"option":o+=c.decode(b.model.options,"id",b.modalFormFieldModel,"title")||"";break;default:l.cellTemplate?o+=j(l.cellTemplate,l.cellTemplateExtData):l.cellTemplateUrl?k(l.cellTemplateUrl).then(function(a){o+=j(a,l.cellTemplateExtData)}):o+="{{modalFormFieldModel}}"}n||(o+="</p>")}else switch(n||(o+='">'),l.dataFormat){case"textarea":o+='<textarea class="form-control" type="text"  id="'+l.field+'" name="'+l.field+'" ng-model="modalFormFieldModel" ng-required="modalFormField.dataRequired" gs-model-validate="modalFormField.dataValidate"></textarea>';break;case"date":o+='<select-date data-id="'+l.field+'" result="modalFormFieldModel" form-field-value="$parent.dataForm.'+l.field+'" '+(n?" embedded ":"")+'ng-required="modalFormField.dataRequired"></select-date><input type="hidden" ng-model="modalFormFieldModel" gs-model-validate="modalFormField.dataValidate"/>',n||(o+='<div class="text-center" role="alert" ng-if="$parent.dataForm.'+l.field+".$dirty && $parent.dataForm."+l.field+'.$error.date"><span class="help-block" translate="FORMS.WRONG_DATE_FORMAT"></span></div>');break;case"option":o+='<select class="form-control" id="'+l.field+'" name="'+l.field+'" ng-options="item.id as item.title disable when model.getDisabled(item) for item in model.options" ng-model="modalFormFieldModel" ng-required="modalFormField.dataRequired" gs-model-validate="modalFormField.dataValidate">';var r=l.dataNoEmptyOption&&!l.dataPlaceholder?' style="display: none" ':"",s=l.dataNoEmptyOption||l.dataPlaceholder?" disabled ":"",t=l.dataPlaceholder?' translate="'+l.dataPlaceholder+'" ':"";o+='<option value="" '+r+s+t+"></option>",o+="</select>";break;case"boolean":var u=n?' <span translate="'+l.title+'"></span>':"";o+='<div class="checkbox"><label><input type="checkbox" id="'+l.field+'" name="'+l.field+'" ng-model="modalFormFieldModel" ng-required="modalFormField.dataRequired" gs-model-validate="modalFormField.dataValidate"/><i class="chk-box"></i>'+u+"</label></div>";break;case"password":o+='<input type="password" class="form-control" id="'+l.field+'" name="'+l.field+'" ng-model="modalFormFieldModel" ng-required="modalFormField.dataRequired" gs-model-validate="modalFormField.dataValidate"/>';break;default:o+='<input type="text" class="form-control" id="'+l.field+'" name="'+l.field+'" ng-model="modalFormFieldModel" ng-required="modalFormField.dataRequired" gs-model-validate="modalFormField.dataValidate"/>'}if(!n&&(l.dataRequired===!0||l.dataValidate)){if(o+='<div class="text-center" ng-messages="$parent.dataForm.'+l.field+'.$error" role="alert" >',l.dataRequired===!0&&(o+='<span ng-if="$parent.dataForm.'+l.field+'.$dirty" ng-message="required" class="help-block"><span translate="FORMS.FIELD_REQUIRED"></span></span>'),l.dataValidate){var v=f.parse(l.dataValidate);angular.forEach(v,function(a){var b="FORMS.INVALID_"+a.key.toUpperCase();o+='<span ng-message="'+a.key+'" class="help-block"><span translate="'+b+'" translate-values="{field: \''+q+"'}\"></span></span>"})}o+="</div>"}n||(o+="</div>"),h.append(o),a(h.contents())(b)}},controller:["$scope",function(c){function d(a,b){var d,f=b.length,g=[];for(d=0;d<f;d++)g.push(e(i.dataSet,b[d]));h(c.modalFormRec,i.field,b),c.model.options=g}function e(d,e){var f={id:e[d.keyField]};if(d.valField)f.title=e[d.valField];else if(d.template){var g=c.$new();g.option=e;var h=a("<span>"+d.template+"</span>")(g);b(function(){f.title=h.text()})}return f}function f(a){return!(!i.dataSet||"function"!=typeof i.dataSet.getDisabled)&&i.dataSet.getDisabled(a,c.modalFormRec)}function g(a){var b=angular.copy(a),c=["dataReadOnly","dataHide"];return angular.forEach(c,function(c){"function"==typeof a[c]&&(b[c]=a[c]())}),b}function h(a,b,c){i.dataNoEmptyOption&&c[0]&&void 0===a[b]&&(a[b]=c[0][i.dataSet.keyField])}var i=c.modalFormField=g(c.modalFormField);if(!i.dataHide){c.model={options:[],getDisabled:f};"option"===i.dataFormat&&(i.dataSet.getData?d(i.dataSet,i.dataSet.getData()||[]):i.dataSet.dataPromise&&i.dataSet.dataPromise(c.modalFormRec).then(function(a){d(i.dataSet,a)}))}}]}}]),angular.module("greyscaleApp").directive("modalFormFooter",function(){return{restrict:"C",template:'<button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button><button class="btn btn-primary" ng-click="save()" ng-disabled="dataForm.$invalid">{{view.formSaveButton||"COMMON.SAVE"|translate}}</button>',link:function(a,b){b.hasClass("modal-footer")||b.addClass("modal-footer")}}}),angular.module("greyscaleApp").directive("checkboxList",function(){return{restrict:"E",replace:!0,template:'<div class="checkbox-list"> <div ng-repeat="item in listItems" ng-show="listItems.length>0"><div class="checkbox"><label><input type="checkbox"  ng-model="item.checked" ng-change="onItemChange(item)"><div class="chk-box"></div>{{item.name}}</label></div></div><div class="row text-center" ng-hide="listItems.length>0"><h5 translate="COMMON.NO_DATA"></h5></div></div>',scope:{listItems:"=?",onItemChange:"=onItemChange"}}}),angular.module("greyscaleApp").directive("propagateDisabled",function(){function a(a,b){var c=a[0].querySelectorAll(b);return c}function b(a,b){angular.forEach(a,function(a){a.disabled=b?"disabled":void 0})}return{restrict:"A",scope:!1,link:function(c,d,e){var f="textarea,input:not(.disable-control),select,button",g=e.$observe("disabled",function(c){var e=a(d,f);b(e,c);var g=d.next();if(g.hasClass("expand-row")){var h=a(g,f);b(h,c)}});c.$on("$destroy",function(){g()})}}}),angular.module("greyscaleApp").directive("mapViz",["$window","$http","greyscaleSurveyApi",function(a,b,c){return{restrict:"E",templateUrl:"views/directives/visualization.html",link:function(a,c,d){function e(b,c){if(a.filterForm.$pristine&&0===a.filterForm.topicSelected.length)c(a.vizData);else if(null===a.filterForm.subtopicSelected&&0===a.filterForm.topicSelected.length)c(a.vizData);else{var d=[];a.vizData.forEach(function(b){if(a.filterForm.topicSelected&&a.filterForm.topicSelected.forEach(function(a){a.isoa2===b.isoa2&&d.push(b)}),a.filterForm.subtopicSelected){var c=a.filterForm.subtopicSelected;"Continent"===c.subtopic.name?b.continent===c.category.isoa2&&d.push(b):c.category.countries.indexOf(b.isoa2)>-1&&d.push(b)}}),console.log(d),c(d)}}function f(){var b={graphTitle:"Doing Business 2016",scaleTitle:"Rank",geoScope:"world",showcoastlines:!1};if(a.filterForm.$pristine&&0===a.filterForm.topicSelected.length)return b;a.filterForm.variableSelected&&(b.scaleTitle="rank"===a.variableSelected?"Rank":"DTF (frontier=100)",b.graphTitle+="- "+b.scaleTitle);var c=a.filterForm.topicSelected;if(0!==c.length){b.showcoastlines=!0;var d=c.map(function(a){return a.name});if(b.graphTitle+="\n"+d.join(),1===c.length)b.geoScope="US"===c[0].isoa2?"usa":a.topicSelected.continent;else{var e=String(c[0].continent),f=c.every(function(a){return String(a.continent)===e});if(f){var g=a.filterOptions.continents.filter(function(a){return a.isoa2===e});b.geoScope=g[0].name.toLowerCase()}}}return a.filterForm.subtopicSelected&&(b.showcoastlines=!0,b.graphTitle+="\n"+a.filterForm.subtopicSelected.subtopic.name+" - "+a.filterForm.subtopicSelected.category.name,"Continent"===a.filterForm.subtopicSelected.subtopic.name&&(b.geoScope=a.filterForm.subtopicSelected.category.name.toLowerCase())),b}function g(b){function c(a,b){return a.map(function(a){return a[b]})}var d=a.filterForm.variableSelected?a.filterForm.variableSelected:"rank",e=f(),g=[{type:"choropleth",locationmode:"country names",locations:c(b,"country"),z:c(b,d),text:c(b,"country"),autocolorscale:!0,colorbar:{title:e.scaleTitle,thickness:.75,len:.75,xpad:30}}],h={title:e.graphTitle,geo:{projection:{type:"mercator"},resolution:"50",showframe:!1,showcoastlines:e.showcoastlines,scope:e.geoScope},width:700,height:700};Plotly.newPlot("mapViz",g,h,{showLink:!1})}var h=b.get("fixtures/doingbiz_agg.json").success(function(b){a.vizData=b.agg;var c=new Set;return b.agg.forEach(function(a,b){c.add({name:a.country,isoa2:a.isoa2,continent:a.continent,id:b})}),a.topics=Array.from(c),b.agg}).error(function(a){console.log(a)});a.minDate=new Date(2015,1,1),a.maxDate=new Date(2016,1,1),a.open1=function(){a.popup1.opened=!0},a.popup1={opened:!1},a.open2=function(){a.popup2.opened=!0},a.popup2={opened:!1},a.users=["user1","user2","user3"],a.filterForm.topicSelected=[],a.surveys=[{qid:"1234",text:"question1"},{qid:"5678",text:"question2"}],a.filterOptions={subtopics:[{id:"3333",name:"Income"},{id:"424",name:"Region"},{id:"111",name:"Continent"}],continents:[{name:"Africa",isoa2:"AF"},{name:"Europe",isoa2:"EU"},{name:"North America",isoa2:"NA"},{name:"Asia",isoa2:"AS"},{name:"South America",isoa2:"SA"},{name:"Australia",isoa2:"AU"},{name:"Antartica",isoa2:"AQ"}],incomeLevels:[{name:"Low-income",countries:["AF","DZ"]},{name:"Middle-income",countries:["AZ","MX"]},{name:"High-income",countries:["US","FR","DE"]}],regions:[]},h.then(function(a){e(a,function(a){g(a)})}),a.drawMap=function(){a.filterForm.$valid&&e(a.vizData,function(a){g(a)})},a.resetFilters=function(){a.filterForm.userSelected="",a.filterForm.variableSelected="rank",a.filterForm.topicSelected=[],a.filterForm.subtopicSelected.subtopic="",a.filterForm.subtopicSelected.category="",a.filterForm.questionSelected="",a.filterForm.$setPristine(),a.drawMap()},a.$watch("vizData",function(b,c){b!==c&&e(a.vizData,function(a){g(a)})}),a.$watch("filterForm.topicSelected",function(a,b){a.length<=0?$(".topicSelectedState").removeClass("ng-dirty"):$(".topicSelectedState").addClass("ng-dirty")})}}}]),angular.module("greyscaleApp").directive("indexViz",["$window","$http","$stateParams","$q","Organization","greyscaleProductApi","greyscaleVisualizationApi","greyscaleOrganizationApi",function(a,b,c,d,e,f,g,h){return{restrict:"E",templateUrl:"views/directives/index-visualization.html",link:function(a,b,i){function j(){return h.products(e.id).then(function(b){console.log(b),a.products=b})}function k(b){return!b||_.isEmpty(b)?(a.vizData=null,d.when(null)):f.product(b.id).aggregate().then(function(b){a.vizData=b.agg,a.topics=b.agg.map(function(a){return{name:a.name,id:a.id}}),a.indexes=[],["questions","subindexes","indexes"].forEach(function(c){for(var d in b[c])a.indexes.push({collection:c,title:b[c][d].title,id:b[c][d].id})})})}function l(b,c){if(b||c(b),0===a.filterForm.topicSelected.length)c(b);else{var d=[];b.forEach(function(b){a.filterForm.topicSelected&&a.filterForm.topicSelected.forEach(function(a){a.id===b.id&&d.push(b)})}),c(d)}}function m(a,b){var c=[{type:"choropleth",locationmode:"country names",locations:_.pluck(a,"name"),z:_.pluck(_.pluck(a,b.collection),b.id),text:_.pluck(a,"name"),autocolorscale:!0,colorbar:{title:b.title,thickness:.75,len:.75,xpad:30}}],d={title:"'"+b.title+"' Choropleth Map",geo:{projection:{type:"mercator"},resolution:"50",showframe:!1,showcoastlines:!0,scope:"world"},width:$("#viz").width()-20,height:500};Plotly.newPlot("viz",c,d,{showLink:!1})}function n(a,b){a=_.sortBy(a,function(a){return a[b.collection][b.id]});var c=[{type:"bar",x:_.pluck(a,"name"),y:_.pluck(_.pluck(a,b.collection),b.id),marker:{color:"rgb(164, 194, 244)"}}],d={title:"'"+b.title+"' Ranked Bar Graph",annotations:a.map(function(c,d){return{x:c.name,y:c[b.collection][b.id],text:"#"+(a.length-d),xanchor:"center",yanchor:"bottom",showarrow:!1}}),xaxis:{title:"Target"},yaxis:{title:b.title},width:$("#viz").width()-20,height:500};Plotly.newPlot("viz",c,d,{showLink:!1})}function o(b,c){var d=_.pluck(b,"name"),e=_.pluck(_.pluck(b,c.collection),c.id),f=_.reduce(e,function(a,b){return a+b},0)/e.length,g="rgb(164, 194, 244)",h="rgb(255, 217, 102)",i="rgb(234, 153, 153)",j=[{type:"bar",x:d,y:e,marker:{color:_.map(b,function(b){return b.id===a.filterForm.comparativeTopic.id?h:g})},showlegend:!1,hoverinfo:"x+y"},{type:"scatter",x:d,y:_.times(d.length,function(){return f}),name:"Regional Average",showlegend:!0,marker:{color:i},mode:"lines",line:{dash:"dot",width:4},hoverinfo:"none"}],k={title:"'"+c.title+"' Comparative Bar Graph",height:500,width:$("#viz").width()-20,xaxis:{title:"Target"},yaxis:{title:c.title}};Plotly.newPlot("viz",j,k,{showLink:!1})}function p(b){var c=a.filterForm.indexSelected;return c&&!_.isEmpty(c)&&b?(b=b.filter(function(a){return"number"==typeof a[c.collection][c.id]}),void("graph"===a.filterForm.visualizationType?n(b,c):"map"===a.filterForm.visualizationType?m(b,c):"comparative"===a.filterForm.visualizationType&&o(b,c))):($("#viz").html(""),null)}function q(){console.log(a.filterForm);var b={productId:a.filterForm.productSelected.id,topicIds:a.filterForm.topicSelected.map(function(a){return a.id}),indexCollection:a.filterForm.indexSelected.collection,indexId:a.filterForm.indexSelected.id,visualizationType:a.filterForm.visualizationType,comparativeTopicId:a.filterForm.comparativeTopic.id,title:a.visualizationTitle};return b}function r(b){return a.loadingConfig=!0,a.visualizationTitle=b.title,a.filterForm.productSelected=_.findWhere(a.products,{id:b.productId})||{},k(a.filterForm.productSelected).then(function(){a.filterForm.topicSelected=a.topics.map(function(a){return a.selected=_.contains(b.topicIds,a.id),a}),a.filterForm.indexSelected=_.findWhere(a.indexes,{id:b.indexId,collection:b.indexCollection})||{},a.filterForm.visualizationType=b.visualizationType||"map",a.filterForm.comparativeTopic=_.findWhere(a.topics,{id:b.comparativeTopicId})||{},a.loadingConfig=!1,a.drawVisualization()})}function s(b){return a.visualizationId=c.visualizationId,g(e.id).get(b).then(function(b){return a.model.title=b.title,r(b)})}a.filterForm.topicSelected=[],a.filterForm.visualizationType="map",a.loadingConfig=!1,a.savedVisualization=!1,a.visualizationTitle=null,a.topics=[],e.$watch(a,function(){j().then(function(){c.visualizationId&&(a.savedVisualization=!0,s(c.visualizationId))})}),a.$watch("filterForm.productSelected",function(b){a.loadingConfig||k(b)}),a.drawVisualization=function(){a.filterForm.$valid&&l(a.vizData,function(a){p(a)})},a.resetFilters=function(){a.filterForm.productSelected={},a.topics=a.topics.map(function(a){return a.selected=!1,a}),a.filterForm.indexSelected={},a.filterForm.visualizationType="map",a.filterForm.comparativeTopic={},a.filterForm.$setPristine(),a.drawVisualization()},a.$watch("filterForm.topicSelected",function(a,b){a.length<=0?$(".topicSelectedState").removeClass("ng-dirty"):$(".topicSelectedState").addClass("ng-dirty")}),a.saveVisualization=function(){return g(e.id).update(a.visualizationId,q())}}}}]),angular.module("greyscaleApp").directive("languageSelector",["_","i18n","greyscaleLanguageApi",function(a,b,c){return{restrict:"A",replace:!0,templateUrl:"views/directives/language-selector.html",link:function(d,e){var f=b.getLocales();return 1===f.length?void e.remove():void c.list().then(function(c){var g=[];return angular.forEach(c,function(a){~f.indexOf(a.code)&&g.push({locale:a.code,label:a.nativeName,tooltip:a.name})}),g.length<=1?void e.remove():(d.languages=g,d.selected=a.find(d.languages,{locale:b.getLocale()}),void(d.changeLanguage=function(a){b.changeLocale(a)}))})}}}]),angular.module("greyscaleApp").directive("translation",["$compile","greyscaleModalsSrv","greyscaleUtilsSrv",function(a,b,c){
return{restrict:"A",controller:["$scope",function(a){a.toggleTranslation=function(d){var e=a.field,f=e.answer,g=a.resp,h=a.$index,i={essenceId:e.essenceId},j={},k="paragraph";if(g)j={entityId:g.id,langId:g.langId,type:k,field:"comments",value:g.comments};else if("comments"===d)j={entityId:e.answerId,langId:e.langId,type:k,field:"comments",value:e.comment};else switch(j={entityId:e.answerId,langId:e.langId,type:e.type,field:"value",value:f},e.type){case"bullet_points":j.index=h;break;case"radio":case"checkboxes":j.value=f.value}angular.extend(i,j),i.value?b.editTranslations(i)["catch"](c.errorMsg):c.errorMsg("TRANSLATION.NOTHING_TO_TRANSLATE")}}],link:function(b,c,d){var e=d.translation||"value",f=angular.element('<div class="translation clearfix"/></div>');c.after(f),f.prepend(c);var g=angular.element('<i class="fa fa-language translation-icon action action-primary" ng-click="toggleTranslation(\''+e+"')\"></i>");a(g)(b),f.append(g),b.$on("$destroy",function(){f.after(c),f.remove()})}}}]),angular.module("greyscaleApp").directive("translationInput",["$compile",function(a){return{restrict:"A",transclude:!0,link:function(b,c){var d=angular.element('<div class="translation-input"/></div>');c.after(d),d.prepend(c);var e=angular.element('<i class="fa fa-trash translation-icon action action-danger" ng-click="del($index)"></i>');a(e)(b),d.append(e),b.$on("$destroy",function(){d.after(c),d.remove()})}}}]),angular.module("greyscaleApp").directive("uploadForm",function(){return{templateUrl:"views/directives/upload-form.html",restrict:"E",replace:!0,scope:{uploadEndpoint:"@",uploadError:"=",uploadSuccess:"=",uploadBefore:"=",uploadDisable:"="},controller:["$scope","$element","$timeout","greyscaleUtilsSrv","FileUploader","greyscaleTokenSrv",function(a,b,c,d,e,f){function g(a){return d.getApiBase()+"/"+a}function h(a){if(a&&a.length)for(var b=0;b<a.length;b++)switch(a[b].severity){case"error":a[b].severity="danger";break;case"success":a[b].severity="success";break;default:a[b].severity="info"}return a}var i=f(),j=a.uploader=new e({url:g(a.uploadEndpoint),withCredentials:!1,method:"POST",removeAfterUpload:1,queueLimit:1,filters:[{name:"CSV",fn:function(a){var b="|csv|",c="|"+a.name.slice(a.name.lastIndexOf(".")+1)+"|";return b.indexOf(c)!==-1}}]});a.model={},a.uploader=j,j.onAfterAddingFile=function(){a.model.error=null},j.onWhenAddingFileFailed=function(b,c){a.model.error="ERROR_FILTER_"+c.name},j.onBeforeUploadItem=function(b){console.log(b),b.url=g(a.uploadEndpoint),b.headers.token=i,"function"==typeof a.uploadBefore&&a.uploadBefore(b)},j.onCompleteItem=function(d,e){j.clearQueue(),b[0].reset(),c(function(){a.$digest()}),d.isError||a.uploadSuccess&&a.uploadSuccess(d,e)},j.onErrorItem=function(b,c){"function"==typeof a.uploadError?a.uploadError(b,c):a.model={issues:h(c.issue)},d.errorMsg(c,"Upload file")},a.disableUploadButton=function(){var b=!j.getNotUploadedItems().length,c="function"==typeof a.uploadDisable&&a.uploadDisable();return b||c}}]}}),angular.module("greyscaleApp").directive("surveyForm",["_","$q","greyscaleGlobals","greyscaleSurveyAnswerApi","$interval","$timeout","$anchorScroll","greyscaleUtilsSrv","greyscaleProductApi","greyscaleDiscussionApi","$state","i18n","$window","$log",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){return!a.allowEdit&&!a.writeToAnswers&&!a.provideResponses}function p(a){var b,c=a.surveyData.languages,d=c.length,e=l.getLocale();for(b=0;b<d;b++)c[b].code===e&&(a.model.lang=c[b].id);a.languages=c}function q(a){a.fields=[],a.content=[],a.recentSaved=null,a.lock();var b,c,d,e,g,h,i,j,k=[],m=[],n=[{fields:m,content:k}],p=a.surveyData.survey,q=a.surveyData.task||{},r=0,s=0,t=p.questions||[],u=t.length;for(F={surveyId:p.id,productId:q.productId,UOAid:q.uoaId},q&&"current"===q.status||angular.extend(a.surveyData.flags,{allowEdit:!1,writeToAnswers:!1,provideResponses:!1}),I=a.surveyData.flags,y=a.surveyData.userId,z=q.stepId,G=I.provideResponses,E=o(I),a.model.formReadonly=E,a.model.translated=!I.allowTranslate,h=0;h<u;h++)if(i=t[h],j=B[i.type]){if(g=C+i.id,d={type:j,title:i.label,href:g,flagged:!!i.flagResolve},e={id:i.id,cid:g,type:j,label:i.label,description:i.description},"section_end"===j)r>0&&r--;else{if(D.indexOf(i.type)===-1){if(angular.extend(e,{qid:i.qid,required:i.isRequired,minLength:i.minLength,maxLength:i.maxLength,inWords:i.isWordmml,value:i.value,links:i.links,canAttach:i.attachment,hasComments:i.hasComments,ngModel:{},flags:I,answer:null,answerId:null,prevAnswers:[],responses:null,response:"",langId:a.model.lang,essenceId:a.surveyData.essenceId,withLinks:i.withLinks,flagResolve:i.flagResolve}),["radio","checkboxes","dropdown"].indexOf(j)!==-1)for(angular.extend(e,{listType:i.optionNumbering,withOther:i.incOtherOpt,options:[]}),i.options=i.options||[],c=i.options.length,b=0;b<c;b++)i.options[b]&&i.options[b].id&&i.options[b].id>=0&&e.options.push(i.options[b]);switch(e.canAttach&&(e.attachments=[]),e.withLinks&&(e.answerLinks=[]),e.hasComments&&(e.comment=""),j){case"checkboxes":for(c=e.options.length,b=0;b<c;b++)angular.extend(e.options[b]||{},{checked:e.options[b].isSelected,name:e.options[b].label});break;case"dropdown":case"radio":for("dropdown"===j&&(e.required||(e.options.unshift({id:null,label:"",value:null}),e.answer=e.options[0])),c=e.options.length,b=0;b<c;b++)e.options[b]&&e.options[b].isSelected&&(e.answer=e.options[b]);break;case"number":angular.extend(e,{units:i.units||"",intOnly:!!i.intOnly}),e.intOnly?e.answer=parseInt(e.value):e.answer=parseFloat(e.value);break;default:e.answer=e.value}s++,e.qid||(e.qid=l.translate("SURVEYS.QUESTION")+s)}n[r].content.push(d),n[r].fields.push(e)}"section_start"===j&&(d.sub=[],e.sub=[],n[++r]={fields:e.sub,content:d.sub})}a.fields=m,a.content=k,a.unlock(),f(function(){t.map(function(b){if(b.flagResolve){a.model.contentOpen=!0;var c=$("#fld"+b.id);if(c.length){var d=c.closest("uib-accordion");if(d.length){var e=d.scope();e.sectionOpen=!0}}}})})}function r(a){var b={},c={};a.lock(),d.list(F.productId,F.UOAid).then(function(d){var e,f,g,h,i=d.length;for(b={},c={},H={},e=0;e<i;e++)g=C+d[e].questionId,d[e].created=new Date(d[e].created),d[e].updated=new Date(d[e].updated),H[g]||(H[g]=[]),c[g]||(c[g]=[]),d[e].isResponse?c[g].push(d[e]):d[e].version&&H[g].push(d[e]),f=b[g],(!f||null===d[e].version&&d[e].userId===y&&d[e].wfStepId===z||f.version<d[e].version)&&(b[g]=d[e],b[g]&&(h=b[g].updated>b[g].created?b[g].updated:b[g].created,(!a.model.savedAt||a.model.savedAt<h)&&(a.model.savedAt=h)));s(a.fields,b,c)})["finally"](a.unlock)}function s(a,b,c){var d,e,f,g,h,i,j,k=a?a.length:0;if(b)for(d=0;d<k;d++){if(e=a[d],f=b[e.cid],c&&(i=c[e.cid],i&&(e.responses=i,j=i[i.length-1],j&&j.userId===y&&j.wfStepId===z&&(e.response=j.comments,e.isAgree=j.isAgree?"y":j.isAgree===!1?"n":null))),H[e.cid]&&(e.prevAnswers=H[e.cid],"bullet_points"===e.type))for(var l=0;l<e.prevAnswers.length;l++)e.prevAnswers[l].value=JSON.parse(e.prevAnswers[l].value);if(f)switch(e.answerId=f.id,e.langId=f.langId||e.langId,e.canAttach&&(e.attachments=f.attachments||[]),e.hasComments&&(e.comment=f.comments||""),e.withLinks&&(e.answerLinks=f.links||[]),e.type){case"checkboxes":for(h=e.options.length,g=0;g<h;g++)e.options[g]&&(e.options[g].isSelected=f.optionId.indexOf(e.options[g].id)!==-1,e.options[g].checked=e.options[g].isSelected);e.answer={},e.withOther&&(e.otherOption={id:-1,checked:!!f.value,value:f.value||e.value});break;case"dropdown":case"radio":for(h=e.options.length,g=0;g<h;g++)e.options[g]&&(e.options[g].isSelected=f.optionId[0]===e.options[g].id,e.options[g].isSelected&&(e.answer=e.options[g]));e.withOther&&(e.otherOption={id:-1,value:e.value},f.optionId.length||(e.answer=e.otherOption,e.answer.value=f.value));break;case"scale":case"number":e.intOnly?e.answer=parseInt(f.value):e.answer=parseFloat(f.value);break;case"bullet_points":var m=angular.fromJson(f.value);for(e.answer=[],g=0;g<m.length;g++)e.answer.push({data:m[g]});I.readonly||e.answer.push({data:""});break;case"date":f.value&&(e.answer=new Date(f.value));break;default:e.answer=f.value}e.sub&&s(e.sub,b)}}function t(a,c){c=!!c;var e=b.resolve(c),f=[],g=a.$$childTail.surveyForm&&a.$$childTail.surveyForm.$dirty||!1;return E||!g&&c||(a.lock(),f=u(a.fields),e=d.save(f,c).then(function(d){var e,f,g,h=!0,i=d.length;for(e=0;e<i&&h;e++)h=200===d[e].statusCode,h||(f=d[e].message);return h?(a.model.savedAt=new Date,g=h||c):g=b.reject(f),a.$$childTail.surveyForm&&a.$$childTail.surveyForm.$setPristine(),g})["catch"](function(a){return h.errorMsg(a,"ERROR.STEP_SUBMIT"),b.reject(a)})["finally"](a.unlock)),e}function u(b){var c,d,e,f=b?b.length:0,g=[];for(c=0;c<f;c++)if(d=b[c],d.sub)g=g.concat(u(d.sub));else if(v(d)){switch(e={questionId:d.id,langId:d.langId,wfStepId:z,userId:y},angular.extend(e,F),d.type){case"checkboxes":e.optionId=[];for(var h=0;h<d.options.length;h++)d.options[h]&&d.options[h].checked&&d.options[h].id>=0&&e.optionId.push(d.options[h].id);d.withOther&&d.otherOption&&(e.value=d.otherOption.checked?d.otherOption.value:"");break;case"dropdown":case"radio":e.optionId=[],e.value=null,d.answer&&"undefined"!=typeof d.answer.id&&(d.answer.id>-1&&(e.optionId=[d.answer.id]),e.value=d.answer.value);break;case"bullet_points":var i=[];if(d.answer)for(h=0;h<d.answer.length;h++)d.answer[h].data&&i.push(d.answer[h].data);e.value=angular.toJson(i);break;default:e.optionId=[],e.value=d.answer||null}G?(e.isResponse=!0,e.comments=d.response,e.isAgree="y"===d.isAgree||"n"!==d.isAgree&&null):e.comments=d.comment,d.canAttach&&(e.attachments=a.map(d.attachments,"id")),d.withLinks&&(e.links=d.answerLinks||[]),g.push(e)}return g}function v(a){return a.answer||"checkboxes"===a.type||a.isAgree||a.comment||a.canAttach&&a.attachments.length||a.withLinks&&a.answerLinks.length}function w(a){a.find(".survey-form-field-input").each(function(){var a=$(this),b=a.attr("survey-form-field-type");switch(b){case"text":case"date":case"email":a.replaceWith('<div class="handwrite-field"></div>');break;case"paragraph":a.replaceWith('<div class="handwrite-field small-line"></div>'.repeat(5));break;case"number":case"scale":var c=a.find(".input-group-addon");c=c.length?c.html():"",a.replaceWith('<div class="handwrite-field unit-line"><span class="pull-right">'+c+"</span></div>");break;case"bullet_points":a.replaceWith('<div class="handwrite-field bullet-line"><i class="fa fa-caret-right"></i><div></div></div>'.repeat(5));break;case"dropdown":var d=$('<div class="handwrite-field select-options"></div>'),e=a.find("select option");e.each(function(a,b){b=$(b),""!==b.val()&&""!==b.text()&&d.append('<span class="select-option"><i class="fa fa-circle-o"></i> '+b.text()+"</span>")}),a.replaceWith(d)}})}function x(a){a.find(".survey-form-field-input").each(function(){var a,b=$(this),c=b.attr("survey-form-field-type");switch(c){case"text":case"paragraph":case"email":b.replaceWith("<p>"+b.find("input, textarea").val()+"</p>");break;case"bullet_points":var d=b.find("bullet-item");a=[],d.each(function(b,c){var d=$(c).find("input").val();""!==d&&a.push('<div class="bullet-point"><i class="fa fa-caret-right"></i> '+d+"</div>")}),b.replaceWith("<p>"+a.join("")+"</p>");break;case"radio":var e=b.find('[type="radio"]'),f=b.next().hasClass("input-group")?b.next().find('[type="radio"]'):[];f.length&&(e=e.add(f)),a="",e.each(function(b,c){if(c.checked){c=$(c);var d="",e=c.parent().find("span");e.length?d=e.html():(e=c.closest(".input-group").find('input[type="text"]'),d=e.val()),a="<p>"+d+"</p>"}}),b.replaceWith(a);break;case"checkboxes":var g=b.find('[type="checkbox"]');a=[],g.each(function(b,c){if(c.checked){c=$(c);var d="",e=c.parent().find("span");e.length?d=e.html():(e=c.closest(".input-group").find('input[type="text"]'),d=e.val()),a.push("<p>"+d+"</p>")}}),b.replaceWith(a.join(""));break;case"dropdown":var h=b.find("select"),i=h.find("option:selected");b.replaceWith("<p>"+i.html()+"</p>");break;case"date":var j=b.find("[ng-model]");b.replaceWith("<p>"+j.val()+"</p>");break;case"number":case"scale":var k=b.find(".input-group-addon"),l=b.find("input");a="",k=k.length?k.html():"",""!==l.val()&&(a="<p>"+l.val()+" "+k+"</p>"),b.replaceWith(a)}})}var y,z,A,B=c.formBuilder.fieldTypes,C="fld",D=c.formBuilder.excludedIndexes,E=!1,F={},G=!1,H=[],I={};return{restrict:"E",templateUrl:"views/directives/survey-form.html",scope:{surveyData:"="},link:function(a){function d(){var c=b.resolve("nop"),d=a.$$childTail.surveyForm&&a.$$childTail.surveyForm.$dirty||!1;return d&&!E&&(c=t(a,!0).then(function(a){return h.successMsg("SURVEYS.AUTOSAVE_SUCCESS"),a})),c}function f(a){return a&&h.successMsg("SURVEYS.SAVE_DRAFT_SUCCESS"),a}function g(){a.model.locked=!0}function l(){a.model.locked=!1}function o(c,d){var e={};return c?a.surveyData.task?(d&&(e.resolve=!0),i.product(a.surveyData.task.productId).taskMove(a.surveyData.task.uoaId,e).then(function(){return h.successMsg("SURVEYS.SUBMIT_SUCCESS"),c})):b.reject("ERROR.TASK_UNDEFINED"):b.reject("ERROR.CHANGES_UNSAVED","ERROR.STEP_SUBMIT")}function s(){a.lock();var c=a.surveyData.task.id;t(a).then(function(){var d=a.surveyData.resolveData;return d?{taskId:c,questionId:d.questionId,isResolve:!0,entry:a.resolveFlagData.entry,stepId:d.stepId}:b.reject("on resolve data")}).then(j.add).then(function(){k.go("tasks")})["catch"](h.errorMsg)["finally"](a.unlock)}function u(b){b&&(b.languages&&p(a),b.survey&&(q(a),b.task&&b.userId&&r(a)))}function v(a){return a&&k.go("tasks"),a}function y(){var b=0,c=0;return a.surveyData.flagsResolve=a.surveyData.flagsResolve||{},angular.forEach(a.surveyData.survey.questions,function(d){d.flagResolve&&(d.flagResolve.draft=d.flagResolve.draft||{entry:"",isResolve:!0,activated:!1,isReturn:!1,questionId:d.id,taskId:a.surveyData.task.id,stepId:a.surveyData.resolveData.stepId},b++,""!==d.flagResolve.draft.entry&&c++)}),b>0&&c===b}function z(a){var b=a.draft;return b.id?j.update(b.id,b):j.add(b).then(function(a){b.id=a.id})}function B(){var c,d,e=a.surveyData.survey&&a.surveyData.survey.questions?a.surveyData.survey.questions.length:0,f=[];for(c=0;c<e;c++)d=a.surveyData.survey.questions[c].flagResolve,d&&d.draft.entry&&d.draft.entry!==d.lastEntry&&(d.lastEntry=d.draft.entry,n.debug("saving",d),f.push(z(d)));return b.all(f)}a.$watch("surveyData",u),a.resolveFlagData={},a.resolve=s,a.$on("$destroy",function(){e.cancel(a.autosave),e.cancel(A)}),a.printRenderBlank=w,a.printRenderAnswers=x,a.updateAnswers=function(){u(a.surveyData)},a.lock=g,a.unlock=l,a.allFlagsCommented=y,a.save=function(c){var d=b.reject("ERROR.STEP_SUBMIT");I.allowTranslate?a.model.translated&&(d=o(!0)):d=t(a).then(function(a){return c?B().then(function(){return a}):a}).then(function(a){return o(a,c)}),d.then(v)["catch"](h.errorMsg)},a.saveDraft=function(){return E?b.reject("ERROR.STEP_READONLY"):t(a,!0).then(f)},a.back=function(){a.surveyData.task?t(a,!0).then(f).then(v):m.history.back()},a.autosave=e(d,1e3*c.autosaveSec),A=e(B,1e3*c.autosaveSec),a.$on(c.events.survey.answerDirty,function(){a.$$childHead.surveyForm.$setDirty(),d()})},controller:["$scope",function(a){a.model={contentOpen:!1,lang:null,formReadonly:!0,translated:!0,locked:!1,savedAt:NaN},a.goField=function(b){a.model.contentOpen=!a.model.contentOpen,f(function(){g(b)},10)},a.isLocked=function(){var b;if(b=o(I)&&(!a.model.translated&&I.allowTranslate||a.model.translated&&!I.allowTranslate)&&I.discussionParticipation&&!I.draftFlag,a.surveyData&&a.surveyData.task&&a.surveyData.task.flagged){var c=0,d=0;angular.forEach(a.surveyData.survey.questions,function(a){a.flagResolve&&(c++,a.flagResolve.draft&&""!==a.flagResolve.draft.entry&&d++)}),b=d!==c}return b}}]}}]),angular.module("greyscaleApp").directive("surveyFormContentItem",["$compile",function(a){return{restrict:"E",replace:!0,scope:{contentItem:"=?",gotoField:"=?"},template:"",link:function(b,c){if(b.contentItem){var d='<li><a ng-click="gotoField(contentItem.href)"><i ng-if="contentItem.flagged" class="text-danger fa fa-flag"></i> {{contentItem.title}}</a>';b.contentItem.sub&&(b.model=b.contentItem.sub,d+='<ul class="survey-content"><survey-form-content-item content-item="item" ng-repeat="item in model" goto-field="gotoField"></survey-form-content-item></ul>'),d+="</li>",c.append(d),a(c.contents())(b)}}}}]),angular.module("greyscaleApp").directive("surveyFormField",["$compile","i18n","greyscaleModalsSrv","$log","$location","$timeout","$anchorScroll",function(a,b,c,d,e,f,g){function h(a){var c=[],d="",e=["number","paragraph","text","scale"],f=["number","scale"];return angular.isNumber(a.minLength)&&angular.isNumber(a.maxLength)&&a.maxLength<a.minLength&&(a.maxLength=null),a.lengthMeasure=b.translate("COMMON."+(a.inWords?"WORDS":"CHARS")),e.indexOf(a.type)!==-1&&(f.indexOf(a.type)===-1&&(d=" "+a.lengthMeasure),null!==a.minLength&&a.minLength>=0&&c.push('<span ng-class="{error: field.ngModel.$error.min}">'+b.translate("SURVEYS.MIN")+": "+a.minLength+d+"</span>"),null!==a.maxLength&&a.maxLength>=0&&c.push('<span ng-class="{error: field.ngModel.$error.max}">'+b.translate("SURVEYS.MAX")+": "+a.maxLength+d+"</span>")),c.join(", ")}function i(a,b){var c="flag-question-"+b;a.attr("id",c),f(function(){a.addClass("flag-question"),a.prepend('<i class="flag fa fa-flag text-danger pull-right"></i>');var b=a.closest(".panel-group");b.length&&b.find(".accordion-toggle").click(),f(function(){g(c)},10)})}return{restrict:"AE",scope:{field:"=surveyFormField",isDisabled:"=fieldDisabled"},template:"",link:function(f,g){if(f.showVersion=function(a){c.showVersion({field:a}).then(function(a){})},f.field){var j="",k="";if(f.field.sub)f.sectionOpen=!1,f.model=f.field.sub,j='<uib-accordion><uib-accordion-group is-open="sectionOpen"><uib-accordion-heading><span class="'+(f.field.required?"required":"")+'">{{field.label}}</span><i class="fa pull-right" ng-class="{\'fa-caret-up\': sectionOpen, \'fa-caret-down\': !sectionOpen}"></i></uib-accordion-heading><p class="subtext section-description">{{field.description}}</p><div class="form-group" ng-repeat="fld in model" survey-form-field="fld"></div></uib-accordion-group></uib-accordion>';else{k='<label id="{{field.cid}}" class="'+(f.field.required?"required":"")+'">{{field.qid}}. {{field.label}}</label><p class="subtext field-description">{{field.description}}</p>',f.field.flags.blindReview||f.field.flags.provideResponses||(k='<a class="fa fa-users version-button" ng-click="showVersion(field)" title="{{\'SURVEYS.VERSION\' | translate}}"></a> '+k),f.field.flagResolve&&(k+='<div ng-hide="isDisabled" class="question-flag-resolving"><i class="fa fa-flag text-danger"></i> {{field.flagResolve.entry}}<input class="form-control" ng-model="field.flagResolve.draft.entry" placeholder="{{\'SURVEYS.RESOLVE_COMMENT\' | translate}}"/></div>'),f.field.flags.readonly=!f.field.flags.allowEdit&&!f.field.flags.writeToAnswers;var l=' name="{{field.cid}}" class="form-control" ng-model="field.answer" ng-required="{{field.required}}" ng-readonly="field.flags.readonly || isDisabled" ',m=h(f.field),n='<span ng-if ="field.ngModel.$error.required" translate="FORMS.FIELD_REQUIRED"></span>',o="",p="",q=f.field.flags,r="";switch(q.allowTranslate&&(r=" translation"),f.field.type){case"paragraph":case"text":j="text"===f.field.type?'<input type="text" ':"<textarea ",j+=l+r+' gs-length="field">',"paragraph"===f.field.type&&(j+="</textarea>"),n=b.translate("SURVEYS.CURRENT_COUNT")+": {{field.length}} {{field.lengthMeasure}}";break;case"section_break":k="",m="",n="",j='<div id="{{field.cid}}}" class="section-break"><label>{{field.label}}</label></div>';break;case"scale":case"number":j='<div class="input-group input-group-number"><input type="number" '+l+' min="{{field.minLength}}" max="{{field.maxLength}}" gs-int="field"><span class="input-group-addon" ng-show="field.units">{{field.units}}</span></div>',n+='<span ng-if="field.ngModel.$error.integer" translate="FORMS.MUST_BE_INT"></span><span ng-if="field.ngModel.$error.number" translate="FORMS.MUST_BE_NUMBER"></span>';break;case"real_scale":j='<div class="input-group"><input type="range" '+l+(f.field.intOnly?"":' step="0.0001"')+' min="{{field.minLength}}" max="{{field.maxLength}}" gs-valid="field"><span class="input-group-addon" ng-show="field.units">{{field.units}}</span></div>',n+='<span ng-show="field.answer">'+b.translate("COMMON.CURRENT_VALUE")+": {{field.answer}}</span>";break;case"email":j='<input type="email" '+l+">";break;case"checkboxes":f.selectedOpts=function(a){var b,c=a.withOther&&a.otherOption&&a.otherOption.checked,d=a.options.length;for(b=0;b<d&&!c;b++)c=c||a.options[b].checked;return c},j='<div class="checkbox-list option-list" ng-class="field.listType">',f.field.options&&f.field.options.length>0&&(j+='<div ng-repeat="opt in field.options"><div class="checkbox"><label><input type="checkbox" ng-model="opt.checked" ng-disabled="field.flags.readonly || isDisabled" ng-required="field.required && !selectedOpts(field)" gs-valid="field"><div class="chk-box"></div><span class="survey-option">{{opt.label}}</span></label></div></div>'),f.field.withOther&&(j+='<div class="input-group"><span class="input-group-addon"><div class="checkbox"><label class="input-group-addon__input-label>Other<input type="checkbox" ng-model="field.otherOption.checked" ng-disabled="field.flags.readonly || isDisabled" ng-required="field.required && !selectedOpts(field)" gs-valid="field"><div class="chk-box"></div></label></div></span><input type="text" class="form-control" ng-model="field.otherOption.value" ng-readonly="field.flags.readonly"'+r+"></div>"),j+="</div>";break;case"radio":j='<div class="checkbox-list option-list" ng-class="field.listType">',f.field.options&&f.field.options.length>0&&(j+='<div class="radio" ng-repeat="opt in field.options"><label><input type="radio" name="{{field.cid}}" ng-model="field.answer" ng-required="field.required" ng-disabled="(field.flags.readonly || isDisabled)" ng-value="opt" gs-valid="field"><i class="chk-box"></i><span class="survey-option">{{opt.label}}</span></label></div></div>'),f.field.withOther&&(j+='<div class="input-group"><span class="input-group-addon"><div class="radio"><label class="input-group-addon__input-label">Other<input type="radio" ng-model="field.answer" ng-disabled="field.flags.readonly || isDisabled" ng-required="field.required" name="{{field.cid}}" gs-valid="field" ng-value="field.otherOption"><div class="chk-box"></div></label></div></span><input type="text" class="form-control" ng-model="field.otherOption.value" ng-readonly="field.flags.readonly" '+r+"></div>"),j+="</div>";break;case"dropdown":f.field.options&&f.field.options.length>0&&(j="<select "+l+'ng-options="opt as opt.label for opt in field.options" gs-valid="field" ng-readonly="field.flags.readonly || isDisabled">',f.field.required&&(j+='<option disabled="disabled" class="hidden" selected value="" translate="SURVEYS.SELECT_ONE"></option>'),j+="</select>");break;case"date":f.field.options={readonly:f.field.flags.readonly,disabled:f.field.flags.readonly,required:f.field.required},j='<select-date data-id="'+f.field.cid+'" result="field.answer" validator="field"form-field-value="'+f.field.cid+'" options="field.options"></select-date>',n+='<span ng-if ="field.ngModel.$error.date" translate="FORMS.WRONG_DATE_FORMAT"></span>';break;case"bullet_points":f.field.options={readonly:f.field.flags.readonly,disabled:f.field.flags.readonly,required:f.field.required},j='<bullets bullet-field="field"></bullets-field>';break;default:d.debug("not rendered",f.field),j='<p class="subtext error">field type "{{field.type}}" rendering is not implemented yet</p>'}f.field.withLinks&&(o='<gs-links model="field.answerLinks" options="field.flags"></gs-links>'),f.field.canAttach&&(p='<attachments ng-if="!isDisabled" model="field.attachments" field="field" options="field.flags"></attachments>'),j='<div class="survey-form-field-input" survey-form-field-type="'+f.field.type+'">'+j+'</div><p class="subtext"><span class="pull-right" ng-class="{error:field.ngModel.$invalid }">'+n+'</span><span class="pull-left">'+m+"</span></p>"+o+p,(q.seeOthersResponses||q.allowEdit)&&(j+='<div class="field-responses" ng-class="{ \'hidden\': !field.responses || !field.responses.length  }"><div translate="SURVEYS.RESPONSES"></div><div ng-repeat="resp in field.responses"><div class="field-response" gs-version-edit'+(q.allowTranslate?' translation="comments" ':"")+"><span><i class=\"fa\"  ng-class=\"{ 'fa-check': resp.isAgree, 'fa-ban': resp.isAgree === false, 'fa-times': resp.isAgree === null}\"></i> {{resp.comments}}</span></div></div></div>"),(q.provideResponses||f.field.hasComments)&&(j='<div class="field-wrapped">'+(q.provideResponses?'<div class="wrapper"></div>':"")+j+"</div>",j+='<div class="field-comment">',f.field.hasComments&&(j+='<div class="required" translate="SURVEYS.ANSWER_COMMENT"></div><textarea class="form-control" required="required" placeholder="{{\'SURVEYS.ANSWER_COMMENT\' | translate}}" ng-model="field.comment" '+(q.allowTranslate?' translation="comments" ':"")+' ng-readonly="field.flags.readonly || isDisabled"></textarea>'),q.provideResponses&&(j+='<div translate="SURVEYS.REVIEVER_COMMENT"></div><textarea placeholder="Comment" ng-model="field.response"></textarea><div class="field-comment-radio"><div class="radio"><label><input type="radio" name="{{field.cid}}_agree" value="y" ng-model="field.isAgree" ng-required="true" /><i class="chk-box"></i><span class="survey-option" translate="SURVEYS.AGREE"></span></label></div><div class="radio"><label><input type="radio" name="{{field.cid}}_agree" value="n" ng-model="field.isAgree" ng-required="true" /><i class="chk-box"></i><span class="survey-option" translate="SURVEYS.DISAGREE"></span></label></div></div>'),j+="</div>")}g.append(k+j),a(g.contents())(f);var s,t=e.hash(),u=t.match(/^question(\d+)$/);u&&(s=parseInt(u[1]),s&&s===f.field.id&&i(g,s))}}}}]),angular.module("greyscaleApp").directive("surveyDiscussion",["greyscaleGlobals","i18n","greyscaleDiscussionApi","greyscaleProfileSrv","greyscaleUtilsSrv","greyscaleProductWorkflowApi","_","$q",function(a,b,c,d,e,f,g,h){function i(a,d){if(a&&a.survey&&a.task){var e=a.survey,i=a.task,p={surveyId:e.id,taskId:i.id},q=a.product.workflow.id,r={steps:f.workflow(q).stepsList(),users:c.getUsers(i.id),messages:c.list(p),entryscope:c.scopeList({taskId:i.id})};d.surveyParams={currentStepId:i.stepId,userFromId:d.surveyData.userId,taskId:i.id},h.all(r).then(function(c){var f,h,p,q,r,s,t=0,u=e.questions||[];s=g.remove(c.steps,{id:i.stepId}),o=s[0];var v=[];for(angular.forEach(c.entryscope.availList,function(a){var b=g.find(c.steps,{id:a.stepId});b&&v.push(b)}),d.model.assignTo=v,d.model.associate={},h=c.users.length,f=0;f<h;f++)d.model.associate[c.users[f].userId]=c.users[f];for(h=u.length,f=0;f<h;f++)p=u[f],l.indexOf(p.type)===-1&&(t++,p.qid||(p.qid=b.translate("SURVEYS.QUESTION")+t),r={id:p.id,title:p.qid,label:p.label,isOpen:!1,messages:[],items:[]},d.model.questions[p.id]=r,d.model.questions.list.push(r));for(m=[],n=null,h=c.messages.length,f=0;f<h;f++)q=c.messages[f],d.model.questions[q.questionId]&&!j(q)&&d.model.questions[q.questionId].items.push(q),q.activated||!q.isReturn||q.resolved||(m.push(q.questionId),n||(n=g.find(d.model.assignTo,{id:q.stepId})),d.surveyData.flags.draftFlag=!0);a.task.flagged&&k(d)})}}function j(a){return!a.activated&&a.isResolve&&!a.isReturn}function k(a){if(a.surveyData.task.flagged){var b=!1,c=a.model.questions.list;angular.forEach(c,function(a){angular.forEach(a.items,function(a){!a.activated&&a.isReturn&&(b=!0)})}),a.surveyData.resolveModeIsDisabled=b}}var l=a.formBuilder.excludedIndexes,m=[],n=null,o=null;return{restrict:"E",replace:!0,scope:{surveyData:"=?",onSend:"=msgOnSubmit"},templateUrl:"views/directives/survey-discussion.html",link:function(a){a.$watch("surveyData",function(b){i(b,a)})},controller:["$scope",function(a){function b(){a.model.msg={userId:null,questionId:null,isReturn:!1,entry:""}}a.model={questions:{list:[]},associate:{},assignTo:[],draftFlag:null,flagDisabled:!0},a.surveyParams={},a.sendMsg=function(){var d=angular.copy(a.model.msg);angular.extend(d,a.surveyParams),c.add(d).then(function(b){a.model.questions[d.questionId]&&(angular.extend(d,b),d.activated=!d.isReturn,a.model.questions[d.questionId].items.unshift(d),m.push(d.questionId)),"function"==typeof a.onSend&&a.onSend(d),d.isReturn&&a.surveyData.task.flagged&&k(a)})["catch"](e.errorMsg)["finally"](function(){b()})},a.updateMsg=function(a){return c.update(a.id,a)},a.flagChange=function(){a.model.msg.isReturn?n&&(a.model.msg.stepId=n.id):a.model.msg.stepId=null},a.assignmentChange=function(){var b=a.model.msg.stepId,c=g.find(a.model.assignTo,{id:b});a.model.flagDisabled=o.position<c.position,a.model.flagDisabled&&(a.model.msg.isReturn=!1)},a.filterSteps=function(b){return b.id!==a.surveyParams.currentStepId},a.filterQuests=function(b){return!a.model.msg.isReturn||m.indexOf(b.id)===-1},a.removeMsg=function(b){return c.remove(b.id).then(function(){var c,d,e=null,f=a.model.questions[b.questionId].items;if(f){for(d=f.length,c=0;c<d&&!e;c++)b.id===f[c].id&&(e=c);a.model.questions[b.questionId].items.splice(e,1),a.model.questions[b.questionId].items.length<1&&(a.model.questions[b.questionId].isOpen=!1)}k(a)})},b()}]}}]),angular.module("greyscaleApp").directive("gsMessage",["i18n","greyscaleUtilsSrv",function(a,b){function c(b){var c=e?e[b]:null;return c||(c={userId:b,firstName:a.translate("USERS.ANONYMOUS"),lastName:"",stepName:""}),c}function d(a){var b=c(a),d=[];return b.firstName&&d.push(b.firstName),b.lastName&&d.push(b.lastName),d.join(" ")}var e=[];return{restrict:"A",scope:{model:"=gsMessage",associate:"=",remove:"&",update:"&"},templateUrl:"views/directives/gs-message.html",controller:["$scope",function(a){function c(){a.isEdit=!a.isEdit}a.isEdit=!1,a.entry="",a.getUserName=function(){return d(a.model.userFromId)},a.model.created=a.model.created?a.model.created:new Date,a.edit=function(){a.entry=a.model.entry,c()},a.apply=function(){var d=a.model.entry;a.model.entry=a.entry,"function"==typeof a.update?a.update()["catch"](function(c){a.model.entry=d,b.errorMsg(c)})["finally"](c):c()},a.cancel=c,e=a.associate}]}}]),angular.module("greyscaleApp").directive("gsLength",["greyscaleUtilsSrv",function(a){return{restrict:"A",require:"ngModel",scope:{field:"=gsLength"},link:function(b,c,d,e){if(e){var f=function(){if(b.field){var c=e.$viewValue,d=b.field.maxLength,f=b.field.minLength;c?b.field.length=b.field.inWords?a.countWords(c):c.length:b.field.length=0,f&&e.$setValidity("minlength",f<=b.field.length),d&&e.$setValidity("maxlength",d>=b.field.length),b.field.ngModel=e}};b.$watch(d.ngModel,function(){f()})}}}}]),angular.module("greyscaleApp").directive("gsInt",function(){return{restrict:"A",require:"ngModel",scope:{field:"=gsInt"},link:function(a,b,c,d){if(d){var e=function(){if(a.field){if(a.field.intOnly){var b=d.$viewValue;b&&d.$setValidity("integer",1*b===parseInt(b,10))}a.field.ngModel=d}};a.$watch(c.ngModel,function(){e()})}}}}),angular.module("greyscaleApp").directive("gsValid",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){a.$watch(c.gsValid,function(a){a&&d&&(a.ngModel=d)})}}}),angular.module("greyscaleApp").directive("minigrid",["$timeout","$window",function(a,b){return{restrict:"A",link:function(c,d,e){function f(){g()}function g(){window.minigrid({skipWindowOnLoad:!0,container:d[0],item:e.minigridItem||".card",gutter:e.minigrigGutter||10})}var h=e.minigridCollection;h?c.$watchCollection(h,function(b){b&&b.length&&a(function(){g()})}):g(),angular.element(b).on("resize",f),c.$on("$destroy",function(){angular.element(b).off("resize",f)})}}}]),angular.module("greyscaleApp").service("Organization",["_","$rootScope","greyscaleOrganizationApi",function(a,b,c){var d={};return d.$watch=function(){var a,c,e;"string"==typeof arguments[0]?(a=arguments[0],c=arguments[1],e=arguments[2]):(a="realm",c=arguments[0],e=arguments[1]);var f=b.$watch(function(){return d[a]},function(a){a&&"function"==typeof e&&e()});c.$on("$destroy",function(){f()})},d.$setBy=function(b,e){var f={};f[b]=e,c.list().then(function(c){
var g=a.find(c,f);if(!g)throw"Can't find organization by "+b+"="+e;angular.extend(d,g)})},d}]).directive("organizationSelector",["_","$q","$timeout","$rootScope","greyscaleProfileSrv","greyscaleRealmSrv","greyscaleGlobals","greyscaleProjectApi","greyscaleOrganizationApi","$cookies","Organization","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){return{restrict:"A",replace:!0,templateUrl:"views/directives/organization-selector.html",scope:!0,controller:["$scope",function(h){function m(){return 0!==(o&g.userRoles.superAdmin.mask)}function n(){return i.list({},"public").then(function(b){h.model.list=!0,h.model.organizations=a.sortBy(b,"name")})}var o;h.model={organization:k},d.Organization=k,k.$list=h.model.list=!1,k.$selectorScope=h,e.getProfile().then(function(b){o=e.getAccessLevelMask(),m()?(h.$on(g.events.common.orgUpdate,n),n().then(function(){var b=j.get("current_realm"),c=a.find(h.model.organizations,{realm:b});c?h.model.organization=c:h.model.organizations.length&&(h.model.organization=h.model.organizations[0]),h.organizationChanged()})):(h.model.organization=b.organization||{},h.model.organization.projectId=b.projectId,h.organizationChanged())}),h.organizationChanged=function(){k=angular.extend(k,h.model.organization),f.current(k.realm||"public"),j.put("current_realm",k.realm),k.projectId||l.debug("Organization "+k.realm+":"+k.id+" has no valid project"),c(function(){h.$digest(),k.$promise=b.when(!0)})}}]}}]),angular.module("greyscaleApp").directive("hiddenSelect",function(){return{restrict:"A",link:function(a,b,c){var d=b.parent(),e=d.css("position"),f=["absolute","relative","fixed"];~f.indexOf(e)||d.css("position","relative"),b.addClass("hidden-select")}}}),angular.module("greyscaleApp").directive("attachedFile",function(){return{restrict:"E",replace:!0,template:'<div class="col-sm-12 col-xs-12 col-md-6 file-attach"><a class="action action-primary file-link" ng-href="{{url}}" ng-click="download($event)" target="_self" download="{{file.filename}}"><i class="fa {{iconClass}}"></i>{{file.filename}}</a><a class="action action-danger file-remove" ng-click="remove()"><i class="fa fa-trash"></i></a></div>',scope:{file:"=attachedItem",remove:"&removeFile"},controller:["$scope","greyscaleUploadApi","$timeout",function(a,b,c){a.iconClass="fa-file",a.download=function(d){a.url||(d.preventDefault(),d.stopPropagation(),b.getDownloadUrl(a.file.id).then(function(e){e.ticket?a.url=b.getLink(e.ticket):e.url&&(a.url=e.url),a.url&&c(function(){d.currentTarget.click()})}))}}]}}),angular.module("greyscaleApp").directive("attachments",function(){return{restrict:"AE",scope:{field:"=",options:"="},template:'<div class="panel attachments" ng-show="isVisible"><p translate="SURVEYS.ATTACHMENTS" class="panel-title"></p><div class="panel-body"><div class="row"><attached-file attached-item="item" ng-repeat="item in field.attachments track by $index" readonly="options.readonly" remove-file="remove($index)"></attached-file></div><form ng-show="!uploader.progress" class="row" name="{{formName}}"><input type="file" class="form-control input-file" name="file" nv-file-select uploader="uploader" ng-hide="options.readonly"></form><div class="progress" ng-if="uploader.progress"><div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div></div></div></div>',controller:["$scope","$element","greyscaleUtilsSrv","FileUploader","$timeout","greyscaleGlobals","greyscaleUploadApi",function(a,b,c,d,e,f,g){function h(b){var d=a.field.attachments[b],e=a.field.essenceId,f=a.field.answerId;g.remove(d.id,e,f).then(function(){return a.field.attachments.splice(b,1)}).then(i)["catch"](function(a){c.errorMsg(a,"Delete attachment")})}function i(){a.$emit(f.events.survey.answerDirty)}a.field=a.field||{},a.field.attachments=a.field.attachments||[],a.isVisible=a.field.attachments.length>0||!a.options||!a.options.readonly,a.formName="f_"+(new Date).getTime(),a.inProgress=[],a.remove=h;var j=a.uploader=new d({withCredentials:!1,disableMultipart:!0,method:"PUT",removeAfterUpload:!0,autoUpload:!1});j.onAfterAddingFile=function(b){a.formName&&a[a.formName].$$parentForm&&(a[a.formName].$$parentForm.$dirty=!1);var c={size:b.file.size,type:b.file.type,name:b.file.name};g.getUrl(c).then(function(a){b.url=a.url,b.key=a.key,b.headers={"Content-Disposition":"attachment; filename*=UTF-8''"+encodeURIComponent(b.file.name),"Content-Type":b.file.type},b.upload()})},j.onCompleteItem=function(c){if(!c.isError){var d={key:c.key};g.success(d).then(function(b){a.field.attachments.push({id:b.id,filename:c.file.name,mimeType:c.file.mimetype}),i()})}j.clearQueue(),b.find("form")[0].reset(),a.inProgress.splice(c.idx,1),e(function(){a.$digest()})},j.onErrorItem=function(a,b,d,e){c.errorMsg(b||"Server error","Upload file")}}]}}),angular.module("greyscaleApp").directive("fixedOnScroll",function(){return{restrict:"A",link:function(a,b,c){function d(a){var c=f.scrollTop();c===h?b.css("top",h):c>g-i&&b.css("top",h+(c-g+i))}var e=b.css("position");~["relative","absolute","fixed"].indexOf(e)||b.css("position","relative");var f=angular.element(window),g=b.offset().top,h=parseInt(b.css("top"))||0,i=parseInt(c.topPadding)||0;f.on("scroll",d),a.$on("$destroy",function(){f.off("scroll",d)})}}}),angular.module("greyscaleApp").service("userNotificationsSrv",function(){var a,b={setUpdate:function(b){a=b},update:function(){a&&a()}};return b}).directive("userNotifications",["_","greyscaleProfileSrv","greyscaleNotificationApi","Organization","greyscaleWebSocketSrv","userNotificationsSrv","greyscaleGlobals","greyscaleRealmSrv","$sce",function(a,b,c,d,e,f,g,h,i){return{restrict:"A",replace:!0,template:'<div class="user-notifications dropdown" translate-namespace="NOTIFICATIONS">   <a class="dropdown-toggle" data-toggle="dropdown">       <i class="fa fa-bell-o" ng-class="{disabled:!model.notifications.length}"></i>       <span ng-if="model.notifications.length" class="counter">{{model.notifications.length}}</span>   </a>   <ul class="dropdown-menu dropdown-menu-right">       <li>           <div class="scroll">               <div>                   <div class="notification" ng-repeat="notification in model.notifications track by $index">                       <div class="sender">{{notification.userFromName}}</div>                       <div class="send-time">{{notification.created|date:\'medium\'}}</div>                       <p><b>{{notification.subject}}</b><br><span ng-bind-html="sanitize(notification.note)"></span></p>                       <div class="control pull-right"><a ng-click="markAsRead(notification, $index); $event.stopPropagation()" translate=".MARK_AS_READ"></a></div>                       <div class="clearfix"></div>                   </div>               </div>               <div ng-if="!model.notifications.length" class="notification first">                   <p translate=".NO_UNREAD"></p>               </div>           </div>           <div class="go-history">               <a ng-if="model.notifications.length" class="control pull-right" ng-click="markAllAsRead(); $event.stopPropagation()" translate=".MARK_ALL_AS_READ"></a>               <a ui-sref="notifications" translate=".GO_HISTORY"></a>           </div>       </li>   </ul></div>',scope:!0,link:function(d){function g(){c.list({userTo:k.id,read:!1},j).then(function(b){d.model.notifications=a.sortBy(b,"created").reverse()})}d.model={notifications:[]},d.sanitize=i.trustAsHtml;var h,j,k=function(){};b.getProfile().then(function(a){k=a,h=b.getAccessLevelMask(),g(),e.on("something-new",g),f.setUpdate(g)}),d.markAsRead=function(a,b){c.setRead(a.id).then(function(){d.model.notifications.splice(b,1)})},d.markAllAsRead=function(){c.setAllRead().then(function(){d.model.notifications.splice(0)})}}}}]),angular.module("greyscaleApp").directive("bullets",["$compile",function(a){return{restrict:"E",template:"",link:function(b,c){var d='<bullet-item answer="item" ng-repeat="item in field.answer" remove-item="remove($index)" add-item="addEmpty($index)" validator="field" options="field.options" is-last="($index === field.answer.length-1)"';b.field.flags.allowTranslate&&(d+="translate"),d+="></bullet-item>",c.append(d),a(c.contents())(b)},controller:["$scope",function(a){function b(b){b===a.field.answer.length-1&&a.field.answer.push({data:"",ngModel:{}})}function c(b){a.field.answer.splice(b,1)}a.field.answer=a.field.answer||[],a.remove=c,a.addEmpty=b,a.field.answer&&!a.field.answer.length&&(a.field.answer=[],b(-1))}]}}]),angular.module("greyscaleApp").directive("bulletItem",function(){return{restrict:"E",scope:{answer:"=",isLast:"=",options:"=",add:"&addItem",remove:"&removeItem"},template:'<div ng-class="{\'input-group\': !options.readonly}"><input type="text" class="form-control" ng-model="answer.data"ng-required="!isLast && options.required" ng-readonly="options.readonly" ng-change="add()" gs-valid="answer"> <span class="input-group-btn" ng-hide="options.readonly"><button class="btn" ng-disabled="(options.readonly || isLast)" ng-click="remove()"><i class="fa fa-trash action-danger"></i></button>{{model.isLast}}</span></div><span></span><p class="subtext"><span class="pull-right" ng-class="{error:answer.ngModel.$invalid }"><span ng-if ="answer.ngModel.$error.required" translate="FORMS.FIELD_REQUIRED"></span></span><span class="pull-left">{{options.borders}}</span></p>'}}),angular.module("greyscaleApp").directive("printArea",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){function e(c){var e=d.printCssMode||"";c.find(g).each(function(a,b){b=$(b),b.attr("data-id",Math.round(1e12*Math.random()))});var h=$('<div><div class="'+e+'">'+c.html()+"</div></div>");f.html(h.html()),f.find("a[href]").attr("href","#"),e.match("clean-inputs")||e.match("hide-inputs")||c.find(g).each(function(a,b){b=$(b);var c=f.find('[data-id="'+b.attr("data-id")+'"]');b[0].checked&&c.prop("checked",!0),c.val(b.val())});var i=b.$eval(d.printPreprocess);"function"==typeof i&&i(f),a(function(){window.print(),a(function(){void 0!==d.printClose&&b.$eval(d.printClose),f.html("")})})}var f=$("#printable");f.length||(f=$('<div id="printable"></div>'),$("body").append(f)),c.on("click",function(){var a=d.printArea,b=$('[printing-area="'+a+'"]');b.length&&e(b.clone())});var g="input, textarea, select"}}}]),angular.module("greyscaleApp").directive("gsVersion",["$filter",function(a){return{restrict:"AEC",transclude:!0,scope:{field:"=gsVersion",index:"=gsVersionIndex"},template:'<span ng-show="model.text" gs-version-edit>{{model.text}}</span><ul ng-show="model.list.length>0" gs-version-edit><li ng-repeat="item in model.list">{{item}}</li></ul>',controller:["$scope",function(b){function c(){switch(d.type){case"date":b.model.text=a("date")(new Date(f.value),"yyyy/MM/dd");break;case"radio":case"checkbox":d.withOther&&f.value&&(b.model.text="Other: "+f.value);break;case"dropdown":(!f.optionId||f.optionId.length<1)&&(b.model.text="no option was selected");break;case"bullet_points":b.model.list=f.value;break;default:b.model.text=f.value}}var d=b.field,e=b.index,f=d.prevAnswers[e];b.model={text:"",list:null,editMode:!1},c(),b.$watch("field.prevAnswers[index].value",c)}]}}]),angular.module("greyscaleApp").directive("gsVersionEdit",["greyscaleSurveyAnswerApi","greyscaleUtilsSrv",function(a,b){return{restrict:"A",transclude:!0,replace:!0,template:'<div  class="form-group"><ng-transclude ng-hide="model.editMode" class="form-control-static"></ng-transclude><div ng-show="model.editMode" class="clearfix"><input type="text" class="form-control" ng-repeat="item in values" ng-model="item.val" ng-if="field.type!==\'paragraph\' && !resp"/><textarea class="form-control" ng-repeat="item in values" ng-model="item.val" ng-if="field.type===\'paragraph\' || resp"></textarea><a class="btn btn-xs action-primary pull-right" ng-show="model.editMode" ng-click="apply()"><i class="fa fa-check"></i></a><a class="btn btn-xs action pull-right" ng-show="model.editMode" ng-click="cancel()"><i class="fa fa-minus"></i></a></div><a class="btn btn-xs action-primary pull-right" ng-hide="model.editMode || !model.editable" ng-click="edit()"><i class="fa fa-pencil"></i></a></div>',controller:["$scope",function(c){function d(){c.model.editMode=!c.model.editMode}function e(a){var b,c,d,e=[];if(d=a&&a.isResponse?a.comments:a.value,angular.isArray(d))for(c=d.length,b=0;b<c;b++)e.push({val:d[b]});else e.push({val:d});return e}function f(a){var b,c=[],d=a.length;for(b=0;b<d;b++)c.push(a[b].val);return c}var g=c.field,h=c.resp,i=h?h:g.prevAnswers[c.index],j=["text","paragraph","bullet_points"];c.values=e(i),c.model=angular.extend({editable:g.flags.allowEdit&&(i.isResponse||j.indexOf(g.type)!==-1||g.withOther&&i.value)},c.model),c.edit=d,c.cancel=function(){d(),c.values=e(i)},c.apply=function(){var e,h=f(c.values);e="bullet_points"===g.type?angular.toJson(h):h[0],a.update(i.id,{isResponse:i.isResponse,value:e}).then(function(a){"updated"===a&&(i.isResponse?i.comments=h[0]:"bullet_points"===g.type?i.value=h:i.value=h[0])})["catch"](b.errorMsg)["finally"](d)}}]}}]),angular.module("greyscaleApp").directive("noCompile",function(){return{restrict:"A",terminal:!0}}),angular.module("greyscaleApp").directive("realmSelect",["greyscaleRealmSrv",function(a){return{restrict:"E",templateUrl:"views/directives/realm-select.html",controller:["$scope",function(b){var c={realm:"",realms:[]};b.model=angular.extend(b.model||{},c),b.update=function(){a.init(b.model.realm)}}]}}]),angular.module("greyscaleApp").directive("gsLinks",function(){return{restrict:"E",scope:{model:"=?",options:"="},templateUrl:"views/directives/gs-links.html",controller:["$scope","greyscaleGlobals","$element",function(a,b,c){function d(){a.adding=!1,a.newUrl=""}function e(){a.$emit(b.events.survey.answerDirty)}d(),a.formName="f_"+(new Date).getTime(),a.remove=function(b){a.model.splice(b,1),e()},a.urlChange=function(){a.formName&&a[a.formName].$$parentForm&&(a[a.formName].$$parentForm.$dirty=!1)},a.addToggle=function(){a.adding=!a.adding&&!a.options.readonly,a.newUrl=""},a.add=function(){a.model.indexOf(a.newUrl)===-1&&(a.model.push(a.newUrl),e(),d())}}]}}),angular.module("greyscaleApp").directive("gsModelValidate",["gsModelValidators",function(a){return{restrict:"A",require:"ngModel",scope:{validators:"=gsModelValidate"},link:function(b,c,d,e){var f=a.parse(b.validators);angular.forEach(f,function(c){a.apply(e,c,b.$parent.modalFormRec)})}}}]).service("gsModelValidators",["_",function(a){function b(a,b){f[a]=b}function c(a,b,c){a.$parsers.unshift(function(e){var f=d(e)||b.isValidFn(e,c);return a.$setValidity(b.key,f),f?e:void 0}),a.$formatters.unshift(function(e){var f=d(e)||b.isValidFn(e,c);return a.$setValidity(b.key,f),e})}function d(a){return void 0===a||""===a}function e(a){var b=[],c=angular.isArray(a);return angular.forEach(a||[],function(a,d){var g=angular.isObject(a),h=a===!0,i="string"==typeof a,j="function"==typeof a,k=!c&&"string"==typeof d;c&&i&&f[a]?b.push({key:a,isValidFn:f[a]}):c&&g?b=b.concat(e(a)):k&&f[d]&&h?b.push({key:d,isValidFn:f[d]}):k&&f[d]&&g?b.push({key:d,isValidFn:f[d](a)}):k&&j&&b.push({key:d,isValidFn:a})}),b}var f={email:function(a){return!!String(a).match(/(.+)@(.+)\.(.+)/)},unique:function(b){return void 0===b.caseSensitive&&(b.caseSensitive=!0),function(c,d){var e=b.transform?b.transform(c):c;b.caseSensitive||(e=String(e).toLowerCase());var f=b.idField||"id";return!a.find(b.storage[b.dict],function(a){var c=b.transform?b.transform(a[b.field]):a[b.field];return b.caseSensitive||(c=String(c).toLowerCase()),c===e&&(b.noExclude||a[f]!==d[f])})}}},g={addValidator:b,parse:e,apply:c};return g}]),angular.module("greyscaleApp").run(["$templateCache",function(a){a.put("views/abstract/dashboard.html",'<div id="page-wrapper" ng-class="{\'open\': model.toggle}" ng-cloak> <sidebar toggle="model.toggle" menu="model.menu"></sidebar> <div id="content-wrapper"> <div class="page-content"> <div class="row header"> <div class="user pull-right"> <div organization-selector></div> <div class="item dropdown user-menu"> <a class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i></a> <span class="username">{{model.user.firstName}} {{model.user.lastName}}&nbsp;&ndash;&nbsp;</span> <ul class="dropdown-menu dropdown-menu-right"> <li class="dropdown-header">{{model.user.firstName}} {{model.user.lastName}} ({{model.user.roleName}})</li> <li class="divider"></li> <li class="link"> <a ui-sref="profile"><span class="fa fa-user"></span> <span translate="NAV.PROFILE"></span></a> </li> <li class="divider"></li> <li class="link"> <a ng-click="logout()"><span class="fa fa-power-off"></span> <span translate="NAV.LOGOUT"></span></a> </li> </ul> </div> <div class="item" user-notifications></div> <div language-selector class="item"></div> </div> <headerbar></headerbar> </div> <div ui-view="body"></div> </div> </div> </div> '),a.put("views/abstract/main.html",'<div class="container-fluid"><div ui-view="body"></div></div> <div class="footer navbar-bottom"> <div> <a href="http://amida-tech.com">&copy; Amida Technology Solutions 2016</a> </div> </div> '),a.put("views/controllers/access.html",'<div class="row"> <div class="col-md-12"> <widget-table model="model.rights"></widget-table> </div> </div> <div class="row"> <div class="col-md-4"> <widget-table model="model.roles" row-selector="selectRole"></widget-table> </div> <div class="col-md-8" ng-show="model.roleRights.dataFilter.role"> <widget-table model="model.roleRights"></widget-table> </div> </div> '),a.put("views/controllers/activation.html",'<div class="container-fluid"> <div class="row"> <div class="col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4"> <div class="panel panel-body"> <div language-selector class="pull-right" style="margin-top: 16px"></div> <div class="logo"></div> <div activate-form="user"></div> </div> </div> </div> </div> '),a.put("views/controllers/comparative-visualization.html",'<div class="row"> <div class="col-md-12"> <rd-widget> <rd-widget-header icon="fa fa-globe" title="{{model.title}}"></rd-widget-header> <rd-widget-body classes="medium no-padding" ng-init="init()"> <comparative-viz></comparative-viz> </rd-widget-body> </rd-widget> </div> </div> <style> .widget {\n      height: 100%;\n    }\n    .widget .widget-body.medium {\n      height: 100%;\n    } </style> '),a.put("views/controllers/graph.html",'<div class="row"> <div class="col-md-12"> <rd-widget> <rd-widget-header icon="fa fa-bar-chart" title="Graph"></rd-widget-header> <rd-widget-body classes="no-padding viz-widget"> <graph-builder></graph-builder> </rd-widget-body> </rd-widget> </div> </div> '),a.put("views/controllers/home.html",' <div class="alert alert-info" ng-if="model.unreadMessages"> <span translate="DASHBOARD.UNREAD_MESSAGES_ALERT" translate-values="{count: model.unreadMessages}"></span> </div> <div ng-if="$root.checkAccessRole(\'user\')"> <h2><i class="fa fa-tasks"></i> <span translate="DASHBOARD.TASKS"></span></h2> <div ng-include="\'views/widgets/my-tasks.html\'"></div> </div> <div ng-if="$root.checkAccessRole(\'superAdmin\',\'admin\')"> <h2><i class="fa fa-paper-plane"></i> <span translate="DASHBOARD.PROJECTS"></span></h2> <div ng-include="\'views/widgets/pm-projects.html\'"></div> </div> '),a.put("views/controllers/index-visualization.html",'<div class="row"> <div class="col-md-12"> <rd-widget> <rd-widget-header icon="fa fa-globe" title="{{model.title}}"></rd-widget-header> <rd-widget-body classes="medium no-padding"> <index-viz></index-viz> </rd-widget-body> </rd-widget> </div> </div> <style> .widget {\n      height: 100%;\n    }\n    .widget .widget-body.medium {\n      height: 100%;\n    } </style> '),a.put("views/controllers/login.html",'<div class="row"> <div class="col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4"> <div class="panel panel-body"> <div language-selector class="pull-right" style="margin-top: 16px"></div> <div class="logo"></div> <div login-form ng-show="model.state ===\'login\'"></div> <div remind-form ng-show="model.state ===\'forgot\'"></div> <div reset-form="model.token" ng-show="model.state ===\'reset\'"></div> </div> </div> </div> '),a.put("views/controllers/my-tasks.html",'<div class="row"> <div class="col-md-12"> <widget-table model="model.activeTasks" row-selector=""></widget-table> </div> </div> <div class="row"> <div class="col-md-12"> <widget-table model="model.futureTasks" row-selector=""></widget-table> </div> </div> <div class="row"> <div class="col-md-12"> <widget-table model="model.finishedTasks" row-selector=""></widget-table> </div> </div> <script type="text/ng-template" id="my-tasks-cell-task.html"> {{row.step.title}} <i class="text-danger fa fa-flag" ng-if="row.flagged"></i><br>\n    <small>{{row.step.description}}</small> </script> <script type="text/ng-template" id="my-tasks-cell-survey.html"> <a ng-href="/#survey/{{row.survey.id}}/task/{{row.id}}">\n        {{row.survey.title}}\n    </a>\n    <br>\n    <small>{{row.survey.description}}</small> </script> <script type="text/ng-template" id="my-tasks-cell-terms.html"> {{row.startDate|date}}\n    -\n    {{row.endDate|date}} </script> <script type="text/ng-template" id="my-tasks-cell-product.html"> {{row.product.title}}\n    <br>\n    <small>{{row.product.description}}</small> </script> <script type="text/ng-template" id="my-tasks-cell-uoa.html"> <b>{{row.uoa.name}}</b>\n    <br>\n    <small>{{row.uoa.shortName}}</small> </script> '),a.put("views/controllers/notifications.html",'<div ng-if="model.notifications"> <widget-table model="model.notifications"></widget-table> </div> <rd-loading ng-if="!model.notifications" class="compact"></rd-loading> '),a.put("views/controllers/organizations.html",'<div class="row"> <div class="col-md-12"> <widget-table model="model.orgs"></widget-table> </div> </div> '),a.put("views/controllers/pm-dashboard-product-tasks-extended-row.html",'<div ng-if="!row.subjectCompleted && !row.allCompleted && !row.planningMode && !row.noActiveTask" translate-namespace="PRODUCT_TASKS" class="row" ng-cloak> <div class="col-md-2"> <b translate=".ROLE"></b>:<br> {{row.step.role}} </div> <div class="col-md-6"> <b translate=".USER"></b>:<br> {{row.user.firstName}} {{row.user.lastName}} <small>({{row.user.email}})</small> </div> <div class="col-md-4"> <a ng-click="ext.notifyUser(row)"><i class="fa fa-envelope-o"></i> <span translate=".NOTIFY_USER"></span></a> <br> <a ng-click="ext.moveNextStep(row)" ng-if="!row.subjectCompleted"> <span ng-show="!row.last"><i class="fa fa-fast-forward"></i> <span translate=".FORCE_NEXT_STEP"></span></span> <span ng-show="row.last"><i class="fa fa-check"></i> <span translate=".FORCE_COMPLETE"></span></span> </a> </div> </div> <div ng-if="row.planningMode"> <small translate="PRODUCT_TASKS.UOA_PLANNING"></small> </div> <div ng-if="row.noActiveTask"> <small class="text-danger" translate="PRODUCT_TASKS.UOA_NO_ACTIVE_TASK" data-translate-values="{step: row.activeStep, tasksLink: ext.$state.href(\'projects.setup.tasks\', {productId: row.productId})}"></small> </div> <div ng-if="row.subjectCompleted"> <small translate="PRODUCT_TASKS.UOA_COMPLETED"></small> </div> <div ng-if="!row.subjectCompleted && row.allCompleted && !row.noActiveTask"> <small translate="PRODUCT_TASKS.UOA_ASSIGNED_TASKS_COMPLETED"></small> </div> '),a.put("views/controllers/pm-dashboard-product-tasks-progress-popover.html",'<div ng-if="item.user"> <b>{{item.step.title}}</b><br> <span>{{item.user.firstName}} {{item.user.lastName}} <small>({{item.user.email}})</small></span> <br> <span translate=".DEADLINE"></span>: {{item.endDate|date}} </div> '),a.put("views/controllers/pm-dashboard-product.html",'<div translate-namespace="PM_PRODUCT_DASHBOARD"> <div class="row"> <div class="col-md-10"> <table class="indicators-table"> <tr class="indicator-header"> <td> <span translate=".COUNT_UOAS"></span><br> </td> <td> <span translate=".COUNT_ONTRACK"></span> / <span translate=".COUNT_LATE"></span> </td> <td> <span translate=".COUNT_FLAGGED">flagged</span> </td> <td> <span translate=".COUNT_COMPLETE">complete</span> </td> </tr> <tr class="indicator-values"> <td> &nbsp;<strong>{{model.count.uoas}}</strong>&nbsp; </td> <td> &nbsp;<strong>{{model.count.onTime}} / {{model.count.late}}</strong>&nbsp; </td> <td> &nbsp;<strong>{{model.count.flagged}}</strong>&nbsp; </td> <td> &nbsp;<strong>{{model.count.complete}}</strong>&nbsp; </td> </tr> </table> </div> <div class="col-md-2 text-right"> <a ng-href="{{model.downloadHref}}" ng-click="download($event)" target="_self" download="export.csv" class="btn btn-primary"><i class="fa fa-download"></i> <span translate=".DOWNLOAD_DATA"></span></a> </div> </div> <widget-table model="model.tasksTable"></widget-table> </div> '),a.put("views/controllers/product-indexes.html",'<div class="row" translate-namespace="PRODUCTS.INDEXES"> <div class="col-md-4"> <widget-table model="model.subindexesTable"></widget-table> <br> <widget-table model="model.indexesTable"></widget-table> <br> </div> </div> '),a.put("views/controllers/product-tasks-table-cell.html",'<div ng-if="cell.user"> <div class="pull-right"> <div class="unassign-user action"><i class="fa fa-trash"></i></div> <div class="edit-task action"><i class="fa fa-pencil"></i></div> </div> <a ng-if="ext.product.surveyId" ng-href="/#survey/{{ext.product.surveyId}}/task/{{cell.id}}"> <div><b>{{cell.user.firstName}} {{cell.user.lastName}}</b></div> <small>{{cell.user.email}}</small> </a> <div ng-if="!ext.product.surveyId"> <div><b>{{cell.user.firstName}} {{cell.user.lastName}}</b></div> <small>{{cell.user.email}}</small> </div> <br><small>{{cell.startDate|date:\'shortDate\'}} - {{cell.endDate|date:\'shortDate\'}}</small> </div> '),a.put("views/controllers/product-tasks.html",'<div class="row" translate-namespace="PRODUCTS.TASKS"> <div ng-if="model.workflowSteps.length && model.uoas.length" class="col-md-9"> <div ng-if="model.tasks"> <widget-table model="model.tasks" class="horizontal-scroll"></widget-table> <br> <div class="pull-right"> <a ui-sref="projects.setup.products({projectId:model.projectId})" class="btn btn-success" translate="COMMON.CONTINUE"></a> </div> <div class="clearfix"></div> </div> </div> <div ng-if="!model.$loading && model.tasks" class="col-md-3"> <div fixed-on-scroll top-padding="20"> <div class="form-group"> <label translate=".SELECT_USERGROUP_LABEL"></label> <select class="form-control" ng-model="model.selectedGroup" ng-change="searchUsers()" ng-options="group as group.title for group in model.groups"> <option value=""></option> </select> </div> <div class="form-group"> <label translate=".SEARCH_USER_LABEL"></label> <input type="text" class="form-control" ng-change="searchUsers()" ng-model="model.searchText"> </div> <div class="form-group" ng-if="model.usersSearchResult.length"> <label translate=".DRAG_USER"></label> <table class="table table-bordered table-hover"> <tbody> <tr ng-repeat="user in model.usersSearchResult track by user.id"> <td class="drag-user" ng-bind-html="user.firstName + \' \' + user.lastName + \' (\' + user.email + \')\' | highlight:model.searchText"></td> </tr> </tbody> </table> </div> <div class="alert alert-warning" ng-if="!model.usersSearchResult.length && (model.selectedGroup.id || model.searchText)"> <div ng-show="model.selectedGroup.id" translate=".USERS_NOT_FOUND_BY_GROUP" translate-values="{group:model.selectedGroup.title}"></div> <div ng-show="model.searchText" translate=".USERS_NOT_FOUND_BY_SEARCH" translate-values="{search:model.searchText}"></div> </div> </div> </div> <div class="col-md-12"> <div ng-if="!model.$loading && !model.workflowSteps.length"> <div class="alert alert-warning" translate=".NO_WORKFLOW_STEPS"></div> </div> <div ng-if="!model.$loading && model.workflowSteps.length && !model.uoas.length"> <div class="alert alert-warning" translate=".NO_UOAS"></div> </div> <div ng-if="model.$loading" class="col-md-12"> <rd-loading></rd-loading> </div> </div> </div> '),a.put("views/controllers/profile.html",'<div class="row" translate-namespace="PROFILE"> <div class="col-md-6"> <rd-widget> <rd-widget-header icon="fa fa-user" title="{{model.user.firstName}} {{model.user.lastName}}"></rd-widget-header> <rd-widget-body classes="medium no-padding"> <div class="col-sm-12"> <table class="table table-responsive"> <tr ng-repeat="item in view.user" ng-show="item.show"> <td>{{item.title|translate}}</td> <td><span>{{model.user[item.field]}}</span></td> </tr> <tr> <td colspan="2" class="text-right"> <span translate=".PROFILE"></span> <span ng-show="model.user.isActive" class="text-success"> <span translate=".ACTIVATED"></span> <i class="fa fa-check"></i></span> <span ng-hide="model.user.isActive" class="text-danger"> <span translate=".NOT_ACTIVATED"></span> <i class="fa fa-warning"></i></span> </td> </tr> </table> </div> </rd-widget-body> <rd-widget-footer class="text-right"> <div class="pull-left"> <a class="btn" ng-click="changePassword()" translate=".CHANGE_PASSWORD"></a> </div> <button class="btn btn-success" ng-click="editProfile()" translate="COMMON.EDIT"></button> </rd-widget-footer> </rd-widget> </div> <div class="col-md-6" ng-show="model.org.loaded"> <rd-widget> <rd-widget-header icon="fa fa-group" title="{{model.org.name}}"></rd-widget-header> <rd-widget-body classes="medium no-padding"> <div class="table-responsive col-sm-12"> <table class="table"> <tr> <td><span translate=".URL"></span></td> <td>{{model.org.url}}</td> </tr> <tr> <td><span translate=".ADDRESS"></span></td> <td>{{model.org.address}}</td> </tr> <tr> <td colspan="2" class="text-right"> <span translate=".ORGANIZATION"></span><span ng-show="model.org.isActive" class="text-success"> <span translate=".VERIFIED"></span> <i class="fa fa-check"></i></span> <span ng-hide="model.org.isActive" class="text-danger"> <span translate=".NOT_VERIFIED"></span> <i class="fa fa-warning"></i></span> </td> </tr> </table> </div> </rd-widget-body> <rd-widget-footer class="text-right"> <button class="btn btn-success" ng-click="editOrg()" ng-disabled="model.orgReadonly" translate="COMMON.EDIT"></button> </rd-widget-footer> </rd-widget> </div> </div> '),a.put("views/controllers/project-setup-products.html",'<span ng-if="model.products"> <widget-table model="model.products"></widget-table> </span> '),a.put("views/controllers/project-setup-surveys.html",'<widget-table model="model.surveys"></widget-table> '),a.put("views/controllers/project-setup.html",'<uib-tabset active="activeTab"> <uib-tab ng-click="go(tab.state)" ng-repeat="tab in tabs track by $index" index="$index"> <uib-tab-heading> <i class="fa {{::tab.icon}}"></i> {{::tab.title|translate}} </uib-tab-heading> </uib-tab> </uib-tabset> <div ui-view></div> '),a.put("views/controllers/register.html",'<div class="container-fluid"> <div class="row"> <div class="col-sm-4 col-sm-offset-4"> <div class="text-center"><img src="images/indaba-logo.gif"></div> <register-form></register-form> </div> </div> </div> '),a.put("views/controllers/superusers.html",'<div ng-if="model.superusers"> <widget-table model="model.superusers" row-selector="showUserInfo"></widget-table> </div> <rd-loading ng-if="!model.superusers" class="compact"></rd-loading> '),a.put("views/controllers/survey-edit.html",'<div class="row survey-edit"> <div name="dataForm" class="col-sm-12 form-horizontal" ng-form="dataForm"> <div class="form-group" ng-show="model.survey.id"> <label class="col-sm-4 control-label">ID:</label> <div class="col-sm-8"> <p class="form-control-static">{{model.survey.id}}</p> </div> </div> <div class="form-group"> <label for="title" class="col-sm-4 control-label" translate="SURVEYS.TITLE"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="title" id="title" ng-model="model.survey.title"> </div> </div> <div class="form-group"> <label for="draft" class="col-sm-4 control-label" translate="SURVEYS.IS_DRAFT"></label> <div class="col-sm-8"> <input type="checkbox" name="draft" id="draft" ng-model="model.survey.isDraft"> </div> </div> <div class="form-group"> <label for="description" class="col-sm-4 control-label" translate="SURVEYS.DESCRIPTION"></label> <div class="col-sm-8"> <textarea type="text" class="form-control" name="description" id="description" ng-model="model.survey.description"></textarea> </div> </div> <form-builder ng-model="model.survey"></form-builder> <div no-compile form-builder-control> <div class="form-builder-control"> <button class="btn btn-default" ng-click="cancel()" translate="COMMON.CANCEL"></button> <button class="btn btn-primary" ng-click="save()" ng-disabled="dataForm.$invalid || !dataForm.$dirty" translate="COMMON.SAVE"></button> </div> </div> </div> </div> '),
a.put("views/controllers/survey.html",'<div class="row"> <div ng-class="{\'col-sm-7\': model.showDiscuss, \'col-sm-12\': !model.showDiscuss}"> <rd-widget ng-show="model.title"> <rd-widget-header title="{{model.title}}"></rd-widget-header> <rd-widget-body> <survey-form survey-data="model.surveyData" ng-class="{\'flagged-survey\':model.surveyData.resolveData}"></survey-form> </rd-widget-body> </rd-widget> </div> <div class="col-sm-5" ng-if="model.showDiscuss"> <rd-widget ng-show="model.title"> <rd-widget-header title="{{\'SURVEYS.DISCUSSION\' | translate}}"></rd-widget-header> <rd-widget-body classes="group-discussion"> <survey-discussion survey-data="model.surveyData"></survey-discussion> </rd-widget-body> </rd-widget> </div> </div> '),a.put("views/controllers/table.html",'<div class="row"> <div class="col-md-12"> <rd-widget> <rd-widget-header icon="fa fa-table" title="Table Builder"></rd-widget-header> <rd-widget-body classes="medium no-padding viz-widget"> <div id="pivotTable" class="viz-padding"></div> </rd-widget-body> </rd-widget> </div> </div>'),a.put("views/controllers/uoas-import.html",'<div translate-namespace="IMPORT.UOAS"> <div class="pull-right"> <a href="fixtures/uoa_import.csv" translate=".DOWNLOAD_EXAMPLE"></a> </div> <h4 translate=".TITLE"></h4> <upload-form upload-endpoint="import_uoas_csv" upload-success="afterUpload"></upload-form> <div ng-if="model.results"> <widget-table model="model.importUoas" class="table-bordered"></widget-table> </div> </div> '),a.put("views/controllers/uoas-list.html",'<div class="row"> <div class="col-md-12"> <widget-table model="model.uoas" row-selector="selectUoa"></widget-table> </div> </div> <div class="row"> <div class="col-md-6"> <widget-table model="model.uoaTagLinks"></widget-table> </div> <div class="col-md-6"> <widget-table model="model.uoaTags"></widget-table> </div> </div> <div class="row"> <div class="col-md-6"> <widget-table model="model.uoaTypes"></widget-table> </div> <div class="col-md-6"> <widget-table model="model.uoaClassTypes"></widget-table> </div> </div> '),a.put("views/controllers/uoas.html",'<uib-tabset active="activeTab"> <uib-tab ng-click="go(tab.state)" ng-repeat="tab in tabs track by $index" index="$index"> <uib-tab-heading> <i class="fa {{::tab.icon}}"></i> {{::tab.title|translate}} </uib-tab-heading> </uib-tab> </uib-tabset> <div ui-view></div> '),a.put("views/controllers/users-groups.html",'<widget-table model="model.groups"></widget-table> '),a.put("views/controllers/users-import.html",'<div ng-if="model.organization"> <div class="section"> <div class="pull-right"> <a href="fixtures/users_import.csv" translate="IMPORT.USERS.DOWNLOAD_EXAMPLE"></a> </div> </div> <div class="clearfix"></div> <upload-form upload-endpoint="organizations/{{model.organization.id}}/users_csv" upload-disable="disableUpload" upload-success="afterUpload"> </upload-form> <div ng-if="model.importResults"> <widget-table model="model.importUsers" class="table-bordered"></widget-table> </div> </div> <rd-loading ng-if="!model.organization" class="compact"></rd-loading> '),a.put("views/controllers/users-list.html",'<div ng-if="model.users"> <widget-table model="model.users" row-selector="showUserInfo"></widget-table> </div> <rd-loading ng-if="!model.users" class="compact"></rd-loading> '),a.put("views/controllers/users-uoa.html",'<rd-widget> <rd-widget-body loading="model.loading"> <div class="row user-uoa" translate-namespace="USERS_UOA"> <div class="col-md-6"> <h5><span translate=".USERS"></span>:</h5> <select multiple="multiple" class="form-control" ng-change="onUserSelect()" ng-model="model.selectedUsers" ng-options="item.id as item.firstName + \' \' +item.lastName + \' (\'+item.email+\')\' for item in model.users"> </select> </div> <div class="col-md-6"> <h5><span translate="UOAS"></span>:</h5> <uib-tabset> <uib-tab heading="{{tns + \'PUBLIC\'|translate}}"> <div class="panel panel-default"> <checkbox-list list-items="model.pubUoa" on-item-change="checkItem"></checkbox-list> </div> </uib-tab> <uib-tab heading="{{tns + \'PRIVATE\'|translate}}"> <div class="panel panel-default"> <checkbox-list list-items="model.privUoa" on-item-change="checkItem"></checkbox-list> </div> </uib-tab> </uib-tabset> </div> </div> </rd-widget-body> <rd-widget-footer class="text-right"> <button class="btn btn-primary" ng-disabled="!model.hasChanges" ng-click="applyChanges()" translate="COMMON.APPLY"></button> </rd-widget-footer> </rd-widget> '),a.put("views/controllers/users.html",'<uib-tabset active="activeTab"> <uib-tab ng-click="go(tab.state)" ng-repeat="tab in tabs track by $index" index="$index"> <uib-tab-heading> <i class="fa {{::tab.icon}}"></i> {{::tab.title|translate}} </uib-tab-heading> </uib-tab> </uib-tabset> <div ui-view></div> '),a.put("views/controllers/visualization.html",'<div class="row"> <div class="col-md-12"> <rd-widget> <rd-widget-header icon="fa fa-globe" title="Map"></rd-widget-header> <rd-widget-body classes="medium no-padding"> <map-viz></map-viz> </rd-widget-body> </rd-widget> </div> </div> <style> .widget {\n      height: 100%;\n    }\n    .widget .widget-body.medium {\n      height: 100%;\n    } </style> '),a.put("views/controllers/visualizations.html",'<widget-table model="model.visualizationsTable"></widget-table> '),a.put("views/directives/activation-form.html",'<div class="panel panel-default" translate-namespace="ACTIVATION"> <div class="panel-body"> <div name="activationForm" class="form-horizontal" ng-form="activationForm"> <div class="form-group"> <label for="firstName" class="col-sm-4 control-label" translate=".FIRST_NAME"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="firstName" id="firstName" ng-model="model.firstName" ng-required="true" required ng-minlength="1"> <div class="text-center" ng-messages="activationForm.firstName.$error" role="alert" ng-if="activationForm.firstName.$dirty"> <span ng-message="requred, minlength" class="help-block"><span translate=".FIRST_NAME_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label for="last_name" class="col-sm-4 control-label" translate=".LAST_NAME"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="last_name" id="last_name" ng-model="model.lastName" ng-minlength="1"> <div class="text-center" ng-messages="activationForm.name.$error" role="alert" ng-if="activationForm.name.$dirty"> <span ng-message="requred, minlength" class="help-block"><span translate=".LAST_NAME_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label for="password" class="col-sm-4 control-label" translate=".PASSWORD"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password" id="password" ng-model="model.password" required ng-minlength="8"> <div class="text-center" ng-messages="activationForm.password.$error" role="alert" ng-if="activationForm.password.$dirty"> <span ng-message="required,minlength" class="help-block"><span translate=".PASSWORD_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label for="password_conf" class="col-sm-4 control-label" translate=".CONFIRMATION"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password_conf" id="password_conf" ng-model="model.password_conf" ng-required="true" ng-minlength="8" is-equal="{{model.password}}"> <div class="text-center" ng-messages="activationForm.password_conf.$error" role="alert" ng-if="activationForm.password_conf.$dirty"> <span ng-message="equal" class="help-block"><span translate=".CONFIRMATION_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <div class="col-sm-4 col-md-offset-8"> <button id="main-login-btn" type="submit" class="btn btn-primary pull-right" ng-click="activate()" ng-disabled="activationForm.$invalid"><span translate=".ACTIVATE"></span> </button> </div> </div> <div ng-if="model.err" class="text-center text-danger"><i class="fa fa-exclamation-circle"></i> {{model.err}} </div> </div> </div> </div> '),a.put("views/directives/comparative-visualization.html",'<div class="row"> <div class="col-sm-10 products-indexes"> <widget-table model="productsTable"></widget-table> <div class="row target-form"> <label for="targetDropdown" class="control-label col-sm-1">Targets</label> <div class="col-sm-11"> <div isteven-multi-select id="targetDropdown" input-model="targets" output-model="selectedTargets" max-labels="0" max-height="300px" item-label="name" tick-property="selected" class="topicSelectedState"></div> </div> </div> </div> <div class="col-sm-2 products-indexes-buttons"> <button type="submit" class="btn btn-default" ng-click="editProduct({})">Add</button> <button type="submit" class="btn btn-default" ng-show="savedVisualization" ng-click="importDataset({})">Import</button> <button type="submit" class="btn btn-default" ng-click="clearProducts()">Clear</button> <!--<button type="submit" class="btn btn-success" ng-show="savedVisualization" ng-click="saveVisualization()">Save</button>--> </div> </div> <div class="comparative-container"> <svg width="800" height="400" class="comparative"> <g id="grid"> <rect id="background"></rect> </g> <g id="targetLabels"></g> <g id="productLabels"></g> <g id="scale"> <rect></rect> <g id="axis"></g> </g> <defs></defs> </svg> </div> '),a.put("views/directives/form-builder.html",'<div id="formbuilder" class="formbuilder"></div> <div class="form-group"> <!--<input class="form-control" id="data" name="data" type="hidden" ng-required="true" ng-model="model.data" />--> </div> '),a.put("views/directives/graph-builder.html",'<form class="viz-padding"> <div class="form-group"> <label for="survey">Select survey (not functional)</label> <select id="survey" class="form-control"> <option ng-repeat="survey in surveys">{{ survey.id }}</option> </select> </div> <div class="form-group"> <label for="graphType">Select graph type</label> <select id="graphType" class="form-control" ng-model="graphType"> <option ng-repeat="type in graphTypes" value="{{type}}">{{ type }}</option> </select> </div> <div class="form-group"> <label for="graphType">Select X-axis variable</label> <select id="graphType" class="form-control" ng-model="graphX"> <option ng-repeat="(key, value) in data[0]" value="{{key}}">{{ key }}</option> </select> </div> <div class="form-group"> <label for="graphType">Select Y-axis variable</label> <select id="graphType" class="form-control" ng-model="graphY"> <option ng-repeat="(key, value) in data[0]" value="{{key}}">{{ key }}</option> <option value="Count">Count (histogram)</option> </select> </div> <div class="form-group"> <button class="btn btn-success pull-right" ng-disabled="!graphType || !graphX || !graphY" ng-click="drawGraph()">Graph</button> </div> <div id="viz"></div> </form> '),a.put("views/directives/gs-links.html",'<div class="gs-links"> <p> <span translate="SURVEYS.LINKS"></span> <a class="action action-primary" ng-click="addToggle()" title="{{\'COMMON.ADD\' | translate}}" ng-hide="options.readonly"> <i class="fa fa-plus"></i> </a> </p> <div class="row" ng-show="adding && !options.readonly"> <div class="col-xs-12"> <form name="{{formName}}"> <div class="input-group"> <input type="url" class="form-control" ng-model="newUrl" name="newUrl" placeholder="{{\'SURVEYS.LINK_PLACEHOLDER\' | translate}}" ng-change="urlChange()"> <span class="input-group-btn"> <button class="btn btn-primary" type="button" translate="COMMON.ADD" ng-click="add()" ng-disabled="(this[formName].newUrl.$invalid || !this[formName].newUrl.$dirty)"></button> </span> </div> <div class="text-center" ng-messages="this[formName].newUrl.$error" role="alert" ng-if="this[formName].newUrl.$dirty"> <span ng-message="url" class="help-block"><span class="error" translate="SURVEYS.URL_INCORRECT"></span></span> </div> </form> </div> </div> <div class="row"> <span class="gs-link-wrapper" ng-repeat="item in model"> <div><a href="{{item}}" target="_blank">{{item}}</a></div> <i class="fa fa-trash action-danger" ng-click="remove($index)" ng-hide="options.readonly"></i> </span> </div> </div> '),a.put("views/directives/gs-message.html",'<span class="gs-message-from"> {{getUserName()}} <i class="fa fa-flag pull-right" ng-show="model.isReturn" ng-class="{\'text-success\':model.isResolve, \'text-danger\':!model.isResolve}"></i> </span> <div class="gs-message-body" ng-class="{\'gs-message-body-edit\':isEdit}"><span>{{model.entry}}</span></div> <textarea ng-show="isEdit" ng-model="entry" class="form-control"></textarea> <div class="text-right" ng-hide="model.activated"> <a ng-click="remove()" ng-hide="isEdit"><i class="fa fa-trash action-danger"></i></a> <a ng-click="edit()" ng-hide="isEdit"><i class="fa fa-pencil"></i></a> <a ng-click="cancel()" ng-show="isEdit"><i class="fa fa-times action-secondary"></i></a> <a ng-click="apply()" ng-show="isEdit"><i class="fa fa-check"></i></a> </div> <p class="subtext">{{model.created | date : \'short\'}}</p> '),a.put("views/directives/index-visualization.html",'<ng-form id="filterForm" name="filterForm" class="form"> <div class="row"> <div class="col-sm-6"> <div class="form-group"> <label for="productDropdown" class="control-label col-sm-4"> Product </label> <div class="col-sm-8"> <select class="form-control" id="productDropdown" ng-model="filterForm.productSelected" ng-options="product as product.title for product in products track by product.id"> <option value="">Select Product</option> </select> </div> </div> </div> <div class="col-sm-6"> <div class="form-group"> <label for="topicDropdown" class="control-label col-sm-4"> Target </label> <div class="col-sm-8"> <div isteven-multi-select input-model="topics" output-model="filterForm.topicSelected" max-labels="0" max-height="300px" item-label="name" tick-property="selected" class="topicSelectedState"></div> <input type="text" ng-model="filterForm.topicSelected" style="display:none">  </div> </div> </div> </div> <div class="row"> <div class="col-sm-6"> <div class="form-group"> <label for="indexDropdown" class="control-label col-sm-4"> Index </label> <div class="col-sm-8"> <select class="form-control" ng-model="filterForm.indexSelected" ng-options="index as index.title for index in indexes" id="indexDropdown" placeholder="Index..."> <option value="">Select Index</option> </select> </div> </div> </div> <div class="col-sm-6"> <div class="form-group"> <label for="visualizationTypeRadio" class="control-label col-sm-4"> Visualization </label> <div class="col-sm-8"> <select class="form-control" id="visualizationTypeRadio" ng-model="filterForm.visualizationType"> <option value="map">Choropleth Map</option> <option value="graph">Ranked Bar Graph</option> <option value="comparative">Comparative Graph</option> </select> </div> </div> </div> </div> <div class="row"> <div class="col-sm-6 controls"> <button type="submit" class="btn btn-success" ng-click="drawVisualization()">Visualize</button> <button type="submit" class="btn btn-default" ng-click="resetFilters()">Clear</button> <button type="submit" class="btn btn-success" ng-show="savedVisualization" ng-click="saveVisualization()">Save</button> </div> <div class="col-sm-6"> <div class="form-group" ng-show="filterForm.visualizationType == \'comparative\'"> <label for="comparativeTopic" class="control-label col-sm-4"> Compare to </label> <div class="col-sm-8"> <select class="form-control" id="comparativeTopic" ng-model="filterForm.comparativeTopic" ng-options="topic.name for topic in filterForm.topicSelected track by topic.id"> </select> </div> </div> </div> </div> </ng-form> <div id="viz"></div> '),a.put("views/directives/language-selector.html",'<div class="language-selector dropdown"> <span class="dropdown-toggle" data-toggle="dropdown" title="{{selected.label}} ({{selected.tooltip}})"><span class="locale">{{selected.locale}}</span> <span class="fa fa-caret-down"></span></span> <ul class="dropdown-menu dropdown-menu-right"> <li class="link" ng-repeat="lang in languages"> <a href ng-click="changeLanguage(lang.locale)" title="{{lang.tooltip}}"><span class="locale">{{lang.locale}}</span>{{lang.label}}</a> </li> </ul> </div> '),a.put("views/directives/login-form.html",'<div class="panel panel-default"> <div class="panel-body"> <p id="full" class="text-right subtext" style="margin-top:-15px" data-translate="UI_TYPE.LIGHT" data-translate-values=\'{"href":"/login"}\'></p> <form name="loginForm" class="form-horizontal"> <div class="form-group"> <label for="login" class="col-sm-4 control-label" translate="LOGIN.EMAIL"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="login" id="login" ng-model="model.login" ng-required="true" ng-minlength="1" ng-change="loginChange()"> <div class="text-center" ng-messages="loginForm.login.$error" role="alert" ng-if="loginForm.login.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate="LOGIN.LOGIN_REQUIRED"></span></span> </div> </div> </div> <div class="form-group"> <label for="password" class="col-sm-4 control-label" translate="LOGIN.PASSWORD"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password" id="password" ng-model="model.password" ng-required="true" ng-minlength="1"> <div class="text-center" ng-messages="loginForm.password.$error" role="alert" ng-if="loginForm.password.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate="LOGIN.PASSWORD_REQUIRED"></span></span> </div> </div> </div> <realm-select></realm-select> <div class="form-group form-inline"> <div class="col-sm-3 col-sm-offset-2"> <button id="main-login-btn" type="submit" class="btn btn-primary" ng-click="submitLogin()" ng-disabled="loginForm.$invalid" translate="LOGIN.SIGN_IN"> </button> </div> <div class="col-sm-5"> <button id="restore-btn" class="btn btn-default" ui-sref="forgot"> {{\'LOGIN.FORGOT_PASSWORD\'|translate}} </button> </div> </div> <div ng-if="model.error" class="text-center text-danger"><i class="fa fa-exclamation-circle"></i> {{model.error|translate}} </div> </form> </div> </div> '),a.put("views/directives/organization-selector.html",'<span class="organization-selector"> <span ng-if="!model.list||model.organization.$lock" class="display">{{model.organization.shortName || model.organization.name}}</span> <span ng-if="model.list && !model.organization.$lock"> <span class="display">{{model.organization.shortName || model.organization.name}}</span> <a><i class="fa fa-caret-down"></i></a> <select hidden-select ng-model="model.organization" ng-options="org as org.name for org in model.organizations track by org.realm + \':\' + org.id" ng-change="organizationChanged()"> <option value="" style="display:none"></option> </select> </span> </span> '),a.put("views/directives/realm-select.html",'<div class="form-group" ng-show="model.realms.length > 0"> <label for="org" class="col-sm-4 control-label" translate="COMMON.ORGANIZATION"></label> <div class="col-sm-8"> <select id="org" ng-required="model.realms.length > 0" name="org" class="form-control" ng-options="org.realm as org.orgName for org in model.realms" ng-change="update()" ng-model="model.realm"></select> <div class="text-center" ng-messages="loginForm.org.$error" role="alert" ng-if="loginForm.org.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate="LOGIN.ORGANIZATION_REQUIRED"></span></span> </div> </div> </div> '),a.put("views/directives/remind-form.html",'<div class="panel panel-default"> <div class="panel-body"> <form name="loginForm" class="form-horizontal"> <div class="form-group"> <label for="login" class="col-sm-4 control-label">{{model.login.label|translate}}</label> <div class="col-sm-8"> <input type="text" class="form-control" name="login" id="login" ng-model="model.login.value" ng-required="true" ng-minlength="1"> <div class="text-center" ng-messages="loginForm.login.$error" role="alert" ng-if="loginForm.login.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate="LOGIN.LOGIN_REQUIRED"></span></span> </div> </div> </div> <realm-select></realm-select> <div class="form-group" ng-show="model.success"> <div class="col-sm-12"> <p class="form-control-static">{{model.success|translate}}</p> <p class="pull-right" translate="LOGIN.GO_LOGIN" translate-values="{href:\'/#/login\'}"></p> </div> </div> <div class="form-group form-inline" ng-hide="model.success"> <div class="col-sm-12 text-right"> <button id="main-login-btn" type="submit" class="btn btn-primary" ng-click="remind()" ng-disabled="loginForm.$invalid">{{\'COMMON.REMIND\'|translate}} </button> </div> </div> <div ng-if="model.error" class="text-center text-danger"><i class="fa fa-exclamation-circle"></i> {{model.error|translate}} </div> </form> </div> </div> '),a.put("views/directives/reset-form.html",'<div class="panel panel-default"> <div class="panel-body"> <div name="dataForm" class="form-horizontal" ng-form="dataForm"> <div class="form-group"> <label class="col-sm-4 control-label" translate="LOGIN.EMAIL"></label> <div class="col-sm-8"> <p class="form-control-static">{{model.email}}</p> </div> </div> <div class="form-group" ng-show="model.success"> <div class="col-sm-12 text-center"> <p class="form-control-static">{{model.success|translate}}</p> </div> </div> <div class="form-group" ng-hide="model.success"> <label for="password" class="col-sm-4 control-label" translate="LOGIN.PASSWORD"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password" id="password" ng-model="model.password" required ng-minlength="8" ng-disabled="model.success || model.err"> <div class="text-center" ng-messages="dataForm.password.$error" role="alert" ng-if="dataForm.password.$dirty"> <span ng-message="required,minlength" class="help-block">Password must be 8 characters or more.</span> </div> </div> </div> <div class="form-group" ng-hide="model.success"> <label for="password_conf" class="col-sm-4 control-label" translate="LOGIN.CONFIRMATION"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password_conf" id="password_conf" ng-model="model.password_conf" ng-required="true" ng-minlength="8" is-equal="{{model.password}}" ng-disabled="model.success || model.err"> <div class="text-center" ng-messages="dataForm.password_conf.$error" role="alert" ng-if="dataForm.password_conf.$dirty"> <span ng-message="equal" class="help-block">Passwords are not match.</span> </div> </div> </div> <div class="form-group"> <div class="col-sm-12"> <span translate="LOGIN.GO_LOGIN" translate-values="{loginState:\'login\'}"></span> <button id="main-login-btn" type="submit" class="btn btn-primary pull-right" ng-hide="model.success" ng-click="reset()" ng-disabled="dataForm.$invalid || !dataForm.$dirty || model.success || model.err" translate="COMMON.RESET"></button> </div> </div> <div ng-if="model.err" class="text-center text-danger"><i class="fa fa-exclamation-circle"></i> {{model.err | translate}} </div> </div> </div> </div> '),a.put("views/directives/sidebar.html",'<!-- Sidebar --> <div id="sidebar-wrapper" ng-show="menu.title"> <div class="sidebar-inner"> <div class="sidebar-header row"> <a ui-sref="home" class="logo"></a> <a class="sidebar-toggle" ng-click="toggleSidebar()"> <i class="menu-icon fa" ng-class="{\'fa-caret-left\':toggle, \'fa-caret-right\':!toggle}"></i> </a> <span class="divider"></span> </div> <ul class="sidebar"> <li class="sidebar-title" ng-repeat-start="group in menu.groups"> <span class="truncate text-capitalize" title="{{::group.title|translate}}">{{::group.title|translate}}</span> </li> <li class="sidebar-list" ng-repeat-end ng-repeat="item in group.items"> <a ui-sref="{{item.sref}}" class="truncate" title="{{::item.title|translate}}">{{::item.title|translate}} <span class="menu-icon fa {{item.icon}}"></span></a> </li> </ul> <div class="help-link"> <a href="https://indaba.zendesk.com" translate="NAV.SUPPORT" class="truncate"></a> </div> </div> </div> <!-- End Sidebar --> '),a.put("views/directives/survey-discussion.html",'<div> <uib-accordion> <uib-accordion-group is-open="discuss.isOpen" ng-repeat="discuss in model.questions.list" is-disabled="discuss.items.length<1"> <uib-accordion-heading> {{discuss.title}} <i class="fa pull-right" ng-class="{\'fa-caret-up\': discuss.isOpen, \'fa-caret-down\': !discuss.isOpen}"></i> </uib-accordion-heading> <div class="gs-message" gs-message="msg" associate="model.associate" ng-repeat="msg in discuss.items" remove="removeMsg(msg)" update="updateMsg(msg)"></div> </uib-accordion-group> </uib-accordion> <div class="form" ng-form="msgForm"> <div class="form-group"> <select class="form-control" ng-options="item.id as item.title for item in model.questions.list | filter : filterQuests" ng-model="model.msg.questionId" ng-required="true"> <option value="" selected="selected" disabled="disabled" style="display:none" translate="PLACEHOLDER.SELECT_QUESTION"></option> </select> </div> <div class="form-group"> <textarea class="form-control" ng-model="model.msg.entry" ng-reqired="true" placeholder="{{\'PLACEHOLDER.INPUT_MESSAGE\' | translate}}"></textarea> </div> <div class="form-group"> <select class="form-control" ng-options="item.id as (item.title + \' (\' + item.role + \')\') for item in model.assignTo | filter : filterSteps" ng-model="model.msg.stepId" ng-change="assignmentChange()" ng-required="true"> <option value="" selected="selected" disabled="disabled" style="display:none" translate="PLACEHOLDER.ASSIGN_TO"></option> </select> </div> <div class="form-group clearfix"> <div class="checkbox-inline" ng-hide="model.flagDisabled"><label class="text-danger"> <input type="checkbox" ng-model="model.msg.isReturn" ng-change="flagChange()"> <i class="chk-box"></i> <span translate="PLACEHOLDER.FLAG"></span></label> </div> <button class="btn btn-primary pull-right" translate="COMMON.SUBMIT" ng-click="sendMsg()" ng-disabled="msgForm.$invalid || !msgForm.$dirty"></button> </div> </div> </div> '),a.put("views/directives/survey-form.html",'<div translate-namespace="SURVEYS"> <div class="clearfix"> <!-- <select class="pull-left" ng-model="model.lang"\n                ng-options="lang.id as lang.nativeName for lang in languages"></select>\n\n        &nbsp;&nbsp; --> <span uib-dropdown> <a uib-dropdown-toggle><span translate=".PRINT_SURVEY"></span> <span class="caret"></span></a> <ul uib-dropdown-menu class="dropdown-menu"> <li><a print-area="survey-form" print-css-mode="open-collapsible hide-inputs"><span translate=".PRINT_QUESTIONS"></span></a></li> <li><a print-area="survey-form" print-css-mode="open-collapsible clean-inputs" print-preprocess="printRenderBlank"><span translate=".PRINT_BLANK"></span></a></li> <li><a print-area="survey-form" print-css-mode="open-collapsible" print-preprocess="printRenderAnswers" print-close="updateAnswers()"><span translate=".PRINT_ALL"></span></a></li> </ul> </span> <p class="subtext pull-right"><span translate=".LAST_SAVED"></span>: <span ng-if="model.savedAt">{{model.savedAt|date:\'short\'}}</span><span ng-if="!model.savedAt" translate="COMMON.NEVER"></span></p> </div> <uib-accordion> <uib-accordion-group is-open="model.contentOpen"> <uib-accordion-heading> {{\'SURVEYS.CONTENT\' | translate}} <i class="fa pull-right" ng-class="{\'fa-caret-up\': model.contentOpen, \'fa-caret-down\': !model.contentOpen}"></i> </uib-accordion-heading> <ul class="survey-content"> <survey-form-content-item content-item="item" ng-repeat="item in content" goto-field="goField"></survey-form-content-item> </ul> </uib-accordion-group> </uib-accordion> <div class="row"> <div class="col-sm-12"> <div name="surveyForm" role="form" ng-form="surveyForm" printing-area="survey-form" class="survey-form"> <div print-only> <h1>{{surveyData.survey.title}}</h1> <p>{{surveyData.survey.description}}</p> </div> <div class="form-group" ng-repeat="fld in fields" survey-form-field="fld" field-disabled="surveyData.disabledFields || surveyData.resolveModeIsDisabled"></div> </div> <div> <button class="btn btn-default pull-left" ng-click="back()" translate="COMMON.BACK"></button> <div class="pull-right"> <!--<div ng-if="surveyData.task.flagged" class="form-horizontal" style="margin:0 0 10px 5px;">--> <!--<textarea class="form-control"--> <!--placeholder="{{\'SURVEYS.RESOLVE_ENTRY\' | translate}}"--> <!--ng-model="resolveFlagData.entry"--> <!--ng-required="true"></textarea>--> <!--</div>--> <button class="btn pull-right" ng-click="saveDraft()" style="clear:right" title="{{\'SURVEYS.LAST_SAVED\' | translate}}: {{model.savedAt | date:\'medium\'}}" ng-disabled="(isLocked() || model.formReadonly || model.locked)" translate="SURVEYS.SAVE_DRAFT"></button> <button ng-if="!surveyData.task.flagged || surveyData.resolveModeIsDisabled" class="btn btn-primary pull-right" ng-hide="surveyData.flags.allowTranslate && !model.translated" ng-click="save()" ng-disabled="surveyData.resolveModeIsDisabled ? false : surveyForm.$invalid || isLocked() || model.locked" translate="SURVEYS.SUBMIT"> </button> <button class="btn btn-primary pull-right" ng-show="surveyData.flags.allowTranslate && !model.translated" disabled="disabled"> <span class="checkbox-inline"><label><input type="checkbox" ng-model="model.translated"> <i class="chk-box"></i>{{"SURVEYS.TRANSLATED" | translate}}</label></span> </button> <button ng-if="surveyData.task.flagged && !surveyData.resolveModeIsDisabled" class="btn btn-primary pull-right" ng-disabled="!allFlagsCommented() || model.locked" ng-click="save(true)" style="vertical-align: top"> <span translate="SURVEYS.SAVE_AND_RESOLVE"></span> <i class="fa fa-flag"></i></button> </div> </div> </div> </div> </div> '),a.put("views/directives/upload-form.html",'<form class="upload-form" ng-submit="uploader.uploadAll()"> <div class="form-group"> <h5 translate="FILE.SELECT_CSV"></h5> <input type="file" class="form-control input-file" name="file" nv-file-select uploader="uploader"> <div class="progress" ng-if="uploader.progress"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div> </div> <button type="submit" class="btn pull-right btn-primary upload-file-button" ng-disabled="disableUploadButton()" translate="FILE.CONTINUE"> </button> <p class="text-danger" ng-if="model.error">{{\'FILE.\' + model.error | translate}}</p> <div class="clearfix"></div> </div> <div ng-repeat="issue in model.issues" ng-show="model.issues.length>0" class="text-{{issue.severity}}"> <i class="fa fa-exclamation-circle"></i> {{issue.details}} </div> </form> '),a.put("views/directives/visualization.html",'<ng-form name="filterForm" class="form-inline" style="postion: fixed;padding: 10px; padding-bottom: 42px"> <div class="form-group"> <label for="userDropdown"> User </label> <select class="form-control" id="userDropdown" ng-model="filterForm.userSelected" ng-options="user for user in users"> <option value="">--All--</option> </select> </div> <div class="form-group" style="margin: 5px"> <label for="variableDropdown"> Variable </label> <select class="form-control" id="variableDropdown" ng-model="filterForm.variableSelected"> <option value="rank"> Rank </option> <option value="dtf"> Distance to Frontier </option> </select> </div> <div class="form-group" style="margin: 5px"> <label for="topicDropdown"> Topic </label> <div isteven-multi-select input-model="topics" output-model="filterForm.topicSelected" max-labels="0" max-height="300px" item-label="name" tick-property="selected" style="display: inline-block; z-index: 1002; position: relative" class="topicSelectedState"></div> <input type="text" ng-model="filterForm.topicSelected" style="display:none"> <!--select multiple size=\'1\' class="form-control" id="topicDropdown" ng-model="filterForm.topicSelected" ng-options="topic as topic.name for topic in topics track by isoa2"-->  </div> <div class="form-group" style="margin: 5px"> <label for="subtopicDropdown"> Subtopic </label> <select class="form-control" id="subtopicDropdown" ng-model="filterForm.subtopicSelected.subtopic" ng-options="st as st.name for st in filterOptions.subtopics track by st.id"> <option value="" selected="selected">--All--</option> </select> </div> <div ng-show="filterForm.subtopicSelected.subtopic.name == \'Continent\'" class="form-group ng-hide" style="margin: 5px"> <label for="continentDropdown" ng-if="filterForm.$valid"> Continent* </label> <label for="continentDropdown" ng-if="filterForm.$invalid" style="color:red"> Continent* </label> <select ng-required="filterForm.subtopicSelected.subtopic.name == \'Continent\'" class="form-control" id="continentDropdown" ng-model="filterForm.subtopicSelected.category" ng-options="ct as ct.name for ct in filterOptions.continents track by ct.isoa2"> <option value="" selected="selected">--Choose Continent--</option> </select> </div> <div ng-show="filterForm.subtopicSelected.subtopic.name == \'Income\'" class="form-group ng-hide" style="margin: 5px"> <label for="incomeDropdown" ng-if="filterForm.$valid"> Income Level* </label> <label for="incomeDropdown" ng-if="filterForm.$invalid" style="color:red"> Income Level* </label> <select ng-required="filterForm.subtopicSelected.subtopic.name == \'Income\'" class="form-control" id="incomeDropdown" ng-model="filterForm.subtopicSelected.category" ng-options="lvl as lvl.name for lvl in filterOptions.incomeLevels"> <option value="" selected="selected">--Choose Income Level--</option> </select> </div> <div class="form-group"> <label for="questionDropdown"> Question </label> <select class="form-control" ng-model="filterForm.questionSelected" ng-options="question as question.qid for question in surveys" id="questionDropdown" placeholder="Question..."> <option value="">Question ID</option> </select> </div> <label for="startDatePopup"> Start Date </label> <div class="input-group" id="startDatePopup"> <input type="text" class="form-control" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popup1.opened" min-date="minDate" max-date="maxDate" ng-model="startDate" close-text="Close"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> <label for="endDatePopup"> End Date </label> <div class="input-group" id="endDatePopup"> <input type="text" class="form-control" uib-datepicker-popup="dd-MMMM-yyyy" is-open="popup2.opened" min-date="minDate" max-date="maxDate" ng-model="endDate" close-text="Close"> <span class="input-group-btn"> <button type="button" class="btn btn-default" ng-click="open2()"><i class="glyphicon glyphicon-calendar"></i></button> </span> </div> <div class="form-group"> <label for="mapQueryInput"> Custom Query: </label> <input class="form-control" placeholder="question1:yes" ng-model="filterForm.mapQuery" id="mapQueryInput"> </div> <button type="submit" class="btn btn-success" ng-click="drawMap()">Submit</button> <button type="submit" class="btn btn-default" ng-click="resetFilters()">Clear all filters</button> </ng-form> <div id="mapViz"></div> '),
a.put("views/directives/widget-table.html",'<rd-widget> <rd-widget-header icon="{{model.icon}}" title="{{model.title}}"> <div class="text-right" ng-show="model.add"> <a class="action action-primary" ng-click="model.add.handler()" title="{{model.add.tooltip||\'COMMON.ADD\'|translate}}"> <i class="fa {{model.add.icon||\'fa-plus\'}}" ng-show="model.add"></i> {{model.add.title||\'COMMON.ADD\'|translate}} </a> </div> </rd-widget-header> <div class="widget-table ng-table {{::classes}}"> <table class="table table-responsive panel" ng-class="{\'table-hover\':model.selectable}" template-pagination="custom/pager" ng-attr-header-class="{{::getHeaderClass(model)}}" ng-table-dynamic="model.tableParams with model.cols"> <tbody ui-sortable="sortableOptions" ng-model="$data"> <tr ng-if="!model.$loading" ng-repeat="row in $data" ng-click="select(row, $event)" ng-class="{selected: isSelected(row), \'expandable-row\':model.expandedRowTemplate || model.expandedRowTemplateUrl}" widget-table-expanded-row-open="model.expandedRowShow" ng-disabled="isDisabled(row)" propagate-disabled class="{{$getRowClass(row)}} row-id-{{row.id}}"> <td data-header="col.header" ng-repeat="col in $columns" widget-table-cell="col" row-value="row" filter="{{col.filter}}" model-multiselect="model.multiselect"></td> </tr> <tr ng-if="!model.$loading && model.dataMap && !model.dataMap.length" class="empty-data text-center"> <td colspan="{{$columns.length}}">{{(model.noDataText||\'TABLES.NO_DATA\')|translate}}</td> </tr> <tr ng-if="model.$loading"> <td colspan="{{$columns.length}}"> <rd-loading></rd-loading> </td> </tr> </tbody> </table> </div> </rd-widget> <script type="text/ng-template" id="ng-table/headers/check-all.html"> <div class="checkbox">\n        <label>\n            <input type="checkbox"\n                   class="select-all"\n                   ng-model="model.multiselect.selectAllState"\n                   ng-if="model.dataMap.length"\n                   ng-change="model.multiselect.selectAll(); model.multiselect.fireChange()"\n                   title="{{(model.multiselect.selectAllTitle||\'TABLES.SELECT_ALL_TITLE\')|translate}}"\n                />\n\n            <i class="chk-box"></i>\n        </label>\n    </div> </script> <script type="text/ng-template" id="custom/pager"> <div class="ng-cloak ng-table-pager" ng-if="params.data.length">\n        <div ng-if="params.settings().counts.length || params.custom.showAllButton" class="ng-table-counts btn-group pull-right">\n            <button ng-repeat="count in params.settings().counts" type="button"\n                    ng-class="{\'active\':params.count()==count}" ng-click="params.count(count)"\n                    class="btn btn-default">\n                <span ng-bind="count"></span>\n            </button>\n            <button ng-if="params.custom.showAllButton" class="btn btn-default"\n                    translate="COMMON.SHOW_ALL"\n                    ng-init="showCount = 999999999; saveCount = params.count()"\n                    ng-class="{active: saveCount == 999999999}"\n                    ng-click="params.count(showCount); showCount = saveCount; saveCount = params.count()">\n\n            </button>\n        </div>\n\n        <div ng-if="pages.length" class="pagination pull-left">\n            <span class="pagination-info text-muted">\n                {{params.pager.itemsName()}}{{params.pager.from()}} - {{params.pager.to()}} <span translate="COMMON.OF"></span> {{params.total()}}\n            </span>\n            <div class="btn-group">\n                <div class="btn btn-default" ng-disabled="params.pager.first()" ng-click="params.pager.prev()"><i class="fa fa-angle-left"></i></div>\n                <div class="btn btn-default" ng-disabled="params.pager.last()" ng-click="params.pager.next()"><i class="fa fa-angle-right"></i></div>\n            </div>\n\n        </div>\n\n        <ul class="pagination ng-table-pagination pull-left" ng-if="spages.length">\n            <li ng-class="{\'disabled\': !page.active && !page.current, \'active\': page.current}"\n                ng-repeat="page in pages" ng-switch="page.type"><a ng-switch-when="prev"\n                                                                   ng-click="params.page(page.number)"\n                                                                   href="">&laquo;</a> <a ng-switch-when="first"\n                                                                                          ng-click="params.page(page.number)"\n                                                                                          href=""><span\n                ng-bind="page.number"></span></a> <a ng-switch-when="page" ng-click="params.page(page.number)"\n                                                     href=""><span ng-bind="page.number"></span></a> <a\n                ng-switch-when="more" ng-click="params.page(page.number)" href="">&#8230;</a> <a ng-switch-when="last"\n                                                                                                 ng-click="params.page(page.number)"\n                                                                                                 href=""><span\n                ng-bind="page.number"></span></a> <a ng-switch-when="next" ng-click="params.page(page.number)"\n                                                     href="">&raquo;</a></li>\n        </ul>\n        <div class="clearfix"></div>\n    </div> </script> '),a.put("views/modals/add-product.html",'<modal-form-header> <span ng-if="model.editing">Edit Product</span> <span ng-if="!model.editing">Add Product</span> </modal-form-header> <div class="modal-body"> <div class="row"> <div class="form-horizontal"> <div class="form-group"> <label for="product" class="col-sm-2 control-label">Product</label> <div class="col-sm-9"> <select name="product" class="form-control" ng-model="model.productIndex.product" ng-options="product as product.title for product in model.products track by product.id"></select> </div> </div> <div class="form-group"> <label for="index" class="col-sm-2 control-label">Index</label> <div class="col-sm-9"> <select name="index" class="form-control" ng-model="model.productIndex.index" ng-options="index as index.title for index in model.indexes track by index.id"></select> </div> </div> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="save()" ng-disabled="!model.productIndex.product || !model.productIndex.index" translate="COMMON.SAVE"></button> </div> '),a.put("views/modals/answer-version.html",'<modal-form-header> {{\'SURVEYS.VERSION\' | translate}} </modal-form-header> <div class="modal-body"> <uib-accordion close-others="true"> <uib-accordion-group ng-repeat="answer in field.prevAnswers" heading="#{{answer.version + \' - \' + (answer.created | date:format) + \' - \' + getUserName(answer.userId)}}"> <div ng-repeat="optionId in answer.optionId"> {{getOptionLabel(optionId)}} </div> <div gs-version="field" gs-version-index="$index"></div> </uib-accordion-group> </uib-accordion> </div> <div class="modal-footer"> <button class="btn btn-lg btn-{{params.okType||\'default\'}}" ng-click="close()" translate="COMMON.CLOSE"></button> </div> '),a.put("views/modals/change-password.html",'<modal-form-header> <span translate="USERS.SET_NEW_PASSWORD_TO" translate-values="{user: model.user}"></span> </modal-form-header> <div class="modal-body"> <div name="dataForm" class="form-horizontal" ng-form="dataForm" autocomplete="off"> <div class="form-group"> <label class="col-sm-4 control-label" translate="USERS.NEW_PASSWORD"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password" ng-model="model.form.password" required ng-minlength="8" autocomplete="off"> <div class="text-center" ng-messages="dataForm.password.$error" role="alert" ng-if="dataForm.password.$dirty"> <span ng-message="required,minlength" class="help-block"><span translate="ACTIVATION.PASSWORD_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label class="col-sm-4 control-label" translate="ACTIVATION.CONFIRMATION"></label> <div class="col-sm-8"> <input type="password" class="form-control" name="password_conf" ng-model="model.password_conf" ng-required="true" ng-minlength="8" is-equal="{{model.form.password}}" autocomplete="off"> <div class="text-center" ng-messages="dataForm.password_conf.$error" role="alert" ng-if="dataForm.password_conf.$dirty"> <span ng-message="equal" class="help-block"><span translate="ACTIVATION.CONFIRMATION_ERROR"></span></span> </div> </div> </div> </div> </div> <div class="modal-form-footer"></div> '),a.put("views/modals/confirm.html",'<div class="modal-system"> <modal-form-header> {{params.header||\'COMMON.CONFIRMATION\'|translate:params}} </modal-form-header> <div class="modal-body"> <p ng-bind-html="params.message"></p> </div> <div class="modal-footer"> <button class="btn btn-lg btn-{{params.cancelType||\'default\'}}" ng-click="close()">{{params.cancelText||\'COMMON.CANCEL\'|translate:params}}</button> <button class="btn btn-lg btn-{{params.okType||\'default\'}}" ng-click="confirm()">{{params.okText||\'COMMON.OK\'|translate:params}}</button> </div> </div> '),a.put("views/modals/country-form.html",'<modal-form-header> <span ng-show="model">Edit</span> <span ng-hide="model">Add new</span> country </modal-form-header> <div class="modal-body"> <div name="dataForm" class="form-horizontal" ng-form="dataForm"> <div class="form-group"> <label for="name" class="col-sm-4 control-label">Country name</label> <div class="col-sm-8"> <input type="text" class="form-control" name="name" id="name" ng-model="model.name" ng-required="true" ng-minlength="1" focus="true"> <div class="text-center" ng-messages="dataForm.name.$error" role="alert" ng-if="dataForm.name.$dirty"> <span ng-message="required, minlength" class="help-block">Country name is required.</span> </div> </div> </div> <div class="form-group"> <label for="alpha2" class="col-sm-4 control-label">Alpha2</label> <div class="col-sm-8"> <input type="text" class="form-control" name="alpha2" id="alpha2" ng-model="model.alpha2" ng-required="true" ng-minlength="1" focus="true"> <div class="text-center" ng-messages="dataForm.alpha2.$error" role="alert" ng-if="dataForm.alpha2.$dirty"> <span ng-message="required, minlength" class="help-block">Alpha2 country code is required.</span> </div> </div> </div> <div class="form-group"> <label for="alpha3" class="col-sm-4 control-label">Alpha3</label> <div class="col-sm-8"> <input type="text" class="form-control" name="alpha3" id="alpha3" ng-model="model.alpha3" ng-required="true" ng-minlength="1" focus="true"> <div class="text-center" ng-messages="dataForm.alpha3.$error" role="alert" ng-if="dataForm.alpha3.$dirty"> <span ng-message="required, minlength" class="help-block">Alpha3 country code is required.</span> </div> </div> </div> <div class="form-group"> <label for="nbr" class="col-sm-4 control-label">Numeric code</label> <div class="col-sm-8"> <input type="text" class="form-control" name="nbr" id="nbr" ng-model="model.nbr" ng-required="true" ng-minlength="1" focus="true"> <div class="text-center" ng-messages="dataForm.nbr.$error" role="alert" ng-if="dataForm.nbr.$dirty"> <span ng-message="required, minlength" class="help-block">Numeric country code is required.</span> </div> </div> </div> </div> </div> <div class="modal-form-footer"></div> '),a.put("views/modals/edit-index.html",'<modal-form-header> <span translate="PRODUCTS.INDEXES.FORM.MODAL_TITLE" translate-values="{index:model.index}" ng-show="model.index.title"></span> <span translate="PRODUCTS.INDEXES.FORM.MODAL_TITLE_CREATE" ng-hide="model.index.title"></span> </modal-form-header> <div class="modal-body"> <div class="row"> <div class="form-horizontal"> <div class="form-group"> <label for="title" class="col-sm-2 control-label" translate="PRODUCTS.INDEXES.FORM.TITLE"></label> <div class="col-sm-9"> <input type="text" class="form-control" name="title" id="title" ng-model="model.index.title"> </div> </div> <div class="form-grop"> <label for="weights" class="col-sm-2 control-label" translate="PRODUCTS.INDEXES.FORM.WEIGHTS_LABEL"></label> <div class="col-sm-9"> <widget-table model="model.weightsTable" id="weights"></widget-table> </div> </div> <div class="form-group"> <label for="divisor" class="col-sm-2 control-label" translate="PRODUCTS.INDEXES.FORM.DIVISOR"></label> <div class="col-sm-9"> <input type="number" class="form-control" name="divisor" id="divisor" ng-model="model.index.divisor"> <div ng-show="model.weights.length"> <span translate="PRODUCTS.INDEXES.FORM.SUGGESTED_DIVISORS"></span>: <a ng-click="model.index.divisor = 1">1</a> (<span translate="PRODUCTS.INDEXES.FORM.SUM_DIVISORS"></span>), <a ng-click="model.index.divisor = model.weights.length">{{model.weights.length}}</a> (<span translate="PRODUCTS.INDEXES.FORM.AVG_DIVISORS"></span>) </div> </div> </div> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="save()" ng-disabled="!model.index.title || !model.index.divisor" translate="COMMON.SAVE"></button> </div> '),a.put("views/modals/edit-visualization.html",'<modal-form-header> <span translate="VISUALIZATIONS.MODAL_TITLE" translate-values="{visualization:model.visualization}" ng-show="model.visualization.title"></span> <span translate="VISUALIZATIONS.MODAL_TITLE_CREATE" ng-hide="model.visualization.title"></span> </modal-form-header> <div class="modal-body"> <div class="row"> <div class="form-horizontal"> <div class="form-group"> <label for="title" class="col-sm-2 control-label" translate="VISUALIZATIONS.TITLE"></label> <div class="col-sm-9"> <input type="text" class="form-control" name="title" id="title" ng-model="model.visualization.title"> </div> </div> <div class="form-group"> <label for="type" class="col-sm-2 control-label" translate="VISUALIZATIONS.TYPE"></label> <div class="col-sm-9" ng-if="!model.visualization.id"> <select name="type" ng-model="model.visualization.type" class="form-control"> <option value="single">Single Product</option> <option value="comparative">Comparative</option> </select> </div> <div class="col-sm-9 visualization-type" ng-if="model.visualization.id" ng-switch on="model.visualization.type"> <span ng-switch-when="single">Single Product</span> <span ng-switch-when="comparative">Comparative</span> </div> </div> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="save()" translate="COMMON.SAVE"></button> </div> '),a.put("views/modals/import-dataset.html",'<modal-form-header> <span ng-if="!model.editing">Import Dataset</span> <span ng-if="model.editing">Edit Dataset</span> </modal-form-header> <div class="modal-body"> <div class="row"> <div class="form-horizontal"> <div class="form-group"> <label for="title" class="col-sm-2 control-label">Title</label> <div class="col-sm-9"> <input class="form-control" ng-model="model.dataset.title" name="title"> </div> </div> <div class="form-group" ng-if="!model.dataset.cols"> <label for="upload" class="col-sm-2 control-label">File</label> <div class="col-sm-9"> <upload-form upload-endpoint="organizations/{{model.organizationId}}/comparative_visualizations/{{model.visualizationId}}/datasets/parse" upload-disable="disableUpload" upload-success="afterUpload"> </upload-form> </div> </div> <div class="form-group" ng-if="model.dataset.cols"> <label for="uoaCol" class="col-sm-2 control-label">Target Column</label> <div class="col-sm-9"> <select class="form-control" ng-model="model.dataset.uoaCol" ng-options="col.id as col.title for col in model.dataset.cols" name="uoaCol"> <option value="">Select Column</option> </select> </div> </div> <div class="form-group" ng-if="model.dataset.cols"> <label for="uoaType" class="col-sm-2 control-label">Target Type</label> <div class="col-sm-9"> <select class="form-control" ng-model="model.dataset.uoaType" name="uoaType"> <option value="">Select Target Type</option> <option value="ISO">ISO code</option> <option value="ISO2">ISO2 code</option> <option value="name">Full Name</option> </select> </div> </div> <div class="form-group" ng-if="model.dataset.cols"> <label for="yearCol" class="col-sm-2 control-label">Year Column</label> <div class="col-sm-9"> <select class="form-control" ng-model="model.dataset.yearCol" ng-options="col.id as col.title for col in model.dataset.cols" name="yearCol"> <option value="">No Year Column</option> </select> </div> </div> <div class="form-group" ng-if="model.dataset.cols"> <label for="dataCol" class="col-sm-2 control-label">Data Column</label> <div class="col-sm-9"> <select class="form-control" ng-model="model.dataset.dataCol" ng-options="col.id as col.title for col in model.dataset.cols" name="dataCol"> <option value="">Select Column</option> </select> </div> </div> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="save()" ng-disabled="!model.dataset.cols || model.dataset.uoaCol == null || model.dataset.uoaType == null || model.dataset.dataCol == null" translate="COMMON.SAVE"></button> </div> '),a.put("views/modals/modal-form.html",'<modal-form-header> <span ng-show="model.id">{{(view.formEditHeaderPrefix||\'COMMON.EDIT\') |translate}}</span> <span ng-hide="model.id">{{(view.formAddHeaderPrefix||\'COMMON.CREATE\')|translate}}</span> <span class="text-lowercase">{{view.formTitle|translate}}</span> </modal-form-header> <div class="modal-body"> <div class="modal-form"> <div class="form-horizontal" name="dataForm" ng-form="dataForm"> <div class="form-group" ng-if="showItem(item, model)" modal-form-rec="model" modal-form-field="item" modal-form-field-model="model[item.field]" ng-repeat="item in view.cols" ng-show="!item.dataReadOnly || item.dataReadOnly ===\'edit\' && !model.id || model.id"></div> </div> <div ng-if="view.warning = view.formWarning(model)" class="alert alert-warning"> {{view.warning|translate}} </div> <div ng-if="error" class="alert alert-danger"> {{error|translate}} </div> </div> </div> <div class="modal-form-footer"></div> '),a.put("views/modals/modal-rec-info.html",'<modal-form-header> <span translate="{{view.formTitle}}"></span> <small translate="COMMON.INFO"></small> </modal-form-header> <div class="modal-body"> <div class="modal-form"> <div class="form-horizontal form-condensed" name="dataForm" ng-form="dataForm"> <div class="form-group" ng-if="showItem(item, model)" modal-form-rec="model" modal-form-field="item" modal-form-field-model="model[item.field]" ng-repeat="item in view.cols"></div> </div> <div ng-if="view.warning = view.formWarning(model)" class="alert alert-warning"> {{view.warning}} </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CLOSE"></button> </div> '),a.put("views/modals/product-uoas.html",'<modal-form-header> <span translate="PRODUCTS.UOAS.MODAL_TITLE" translate-values="{product:product}"></span> </modal-form-header> <div class="modal-body"> <widget-table model="model.productUoas"></widget-table> </div> <div class="modal-footer"> <button class="btn btn-success" ng-click="close()" translate="COMMON.CONTINUE"></button> </div> '),a.put("views/modals/product-workflow-row-form.html",'<form style="padding: 0 15px" translate-namespace="PRODUCTS.WORKFLOW.STEPS"> <div class="row"> <div class="col-md-3 form-group"> <label translate="{{ext.formFields.title.title}}" class="required"></label> <span modal-form-rec="row" modal-form-field="ext.formFields.title" embedded="true" modal-form-field-model="row.title"> </span> </div> <div class="col-md-3"> <label translate="{{ext.formFields.role.title}}" class="required"></label> <span modal-form-rec="row" modal-form-field="ext.formFields.role" embedded="true" modal-form-field-model="row.role"> </span> </div> <div class="col-md-3"> <label translate="{{ext.formFields.startDate.title}}" class="required"></label> <span modal-form-rec="row" modal-form-field="ext.formFields.startDate" embedded="true" modal-form-field-model="row.startDate"> </span> </div> <div class="col-md-3"> <label translate="{{ext.formFields.endDate.title}}" class="required"></label> <span modal-form-rec="row" modal-form-field="ext.formFields.endDate" embedded="true" modal-form-field-model="row.endDate"> </span> </div> </div> <div class="row"> <div class="col-md-4"> <label translate=".GROUPS" class="required"></label> <div ng-if="!row.groups.length"> <i class="text-warning" translate=".NO_GROUPS"></i> </div> <div ng-repeat="group in row.groups track by $index"> {{group.title}} <a ng-click="ext.stepRemoveGroup(row.groups, $index)" class="text-danger">&times;</a> </div> <div ng-hide="ext.noFreeGroups(row.groups)"> <a><i class="fa fa-plus"></i> <span translate=".ADD_GROUP"></span></a> <select hidden-select ng-model="ext.selectedGroup" ng-options="group as group.title for group in ext.getFreeGroups(row.groups) track by group.id" ng-change="ext.stepAddGroup(row.groups, ext.selectedGroup)"> <option value="" hidden></option> </select> </div> </div> <div class="col-md-4"> <label translate="{{ext.formFields.writeToAnswers.title}}"></label> <div class="radio"><label><input type="radio" name="surveyAccess" ng-model="row.surveyAccess" ng-value="\'writeToAnswers\'"> <i class="chk-box"></i><span translate=".WRITE_ACCESS_WRITE"></span></label> </div> <div class="radio"><label><input type="radio" name="row.surveyAccess" ng-model="row.surveyAccess" ng-value="\'noWriteToAnswers\'"> <i class="chk-box"></i><span translate=".WRITE_ACCESS_READ"></span></label> </div> <div class="radio"><label><input type="radio" name="surveyAccess" ng-model="row.surveyAccess" ng-value="\'provideResponses\'"> <i class="chk-box"></i><span translate=".PROVIDE_RESPONSES"></span></label> </div> <div class="radio"><label><input type="radio" name="surveyAccess" ng-model="row.surveyAccess" ng-value="\'allowEdit\'"> <i class="chk-box"></i><span translate=".ALLOW_EDIT"></span></label> </div> <div class="radio"><label><input type="radio" name="surveyAccess" ng-model="row.surveyAccess" ng-value="\'allowTranslate\'"> <i class="chk-box"></i><span translate=".ALLOW_TRANSLATE"></span></label> </div> </div> <div class="col-md-4"> <label translate=".PERMISSIONS"></label> <span modal-form-rec="row" modal-form-field="ext.formFields.discussionParticipation" embedded="true" modal-form-field-model="row.discussionParticipation"> </span> <span modal-form-rec="row" modal-form-field="ext.formFields.seeOthersResponses" embedded="true" modal-form-field-model="row.seeOthersResponses"> </span> <span modal-form-rec="row" modal-form-field="ext.formFields.blindReview" embedded="true" modal-form-field-model="row.blindReview"> </span> </div> </div> </form> '),a.put("views/modals/product-workflow.html",'<modal-form-header> <span translate="PRODUCTS.WORKFLOW.STEPS_FOR" translate-values="{product:model.product.title}"></span> </modal-form-header> <div class="modal-body" translate-namespace="PRODUCTS.WORKFLOW"> <form name="model.dataForm" class="form"> <div class="form-group"> <label translate=".TITLE" class="required"></label> <div> <input type="text" class="form-control" name="name" id="name" ng-model="model.product.workflow.name" ng-required="true" ng-minlength="1"> <div class="text-center" ng-messages="model.dataForm.name.$error" role="alert" ng-if="model.dataForm.name.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".TITLE_REQUIRED"></span></span> </div> </div> </div> <div class="form-group"> <label translate=".DESCRIPTION" class="required"></label> <div> <textarea type="text" class="form-control" name="description" id="description" ng-model="model.product.workflow.description" ng-required="true" ng-minlength="1"></textarea> <div class="text-center" ng-messages="model.dataForm.description.$error" role="alert" ng-if="model.dataForm.description.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".DESCRIPTION_REQUIRED"></span></span> </div> </div> </div> </form> <widget-table model="model.productWorkflow"></widget-table> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-primary" ng-disabled="model.dataForm.$invalid || !validWorkflowSteps()" ng-click="save()" translate="COMMON.SAVE_AND_CONTINUE"></button> </div> '),a.put("views/modals/role-right-form.html",'<modal-form-header> <span translate="ROLE_RIGHTS.ADD_RIGHT_TO_ROLE" translate-values="{role: view.role.name}"></span> </modal-form-header> <div class="modal-body" translate-namespace="ROLE_RIGHTS"> <div name="dataForm" class="form-horizontal" ng-form="dataForm"> <div class="form-group"> <label for="right" class="col-sm-3 control-label"><span translate="RIGHTS.RIGHT"></span>:</label> <div class="col-sm-9"> <select class="form-control" id="right" name="right" ng-options="item.action for item in view.rights track by item.id" ng-model="model" ng-required="true"></select> <div class="text-center" ng-messages="dataForm.rights.$error" role="alert" ng-if="dataForm.rights.$dirty"> <span ng-message="requred" class="help-block"><span translate=".RIGHT_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label class="col-sm-3 control-label"><span translate="RIGHTS.ENTITY_TYPE"></span>:</label> <div class="col-sm-9"><p class="form-control-static">{{model.entityType}}</p></div> </div> <div class="form-group"> <label class="col-sm-3 control-label"><span translate="RIGHTS.DESCRIPTION"></span>:</label> <div class="col-sm-9"><p class="form-control-static">{{model.description}}</p></div> </div> </div> </div> <div class="modal-form-footer"></div> '),a.put("views/modals/send-notification.html",'<modal-form-header> <span translate="NOTIFICATIONS.SEND_NOTIFICATION"></span> </modal-form-header> <div class="modal-body" translate-namespace="NOTIFICATIONS"> <div class="form-group"> <b>{{model.user.firstName}} {{model.user.lastName}} <small>({{model.user.email}})</small></b> </div> <div class="form-group"> <textarea class="form-control" ng-model="model.notification.body"></textarea> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="send()" ng-disabled="!validForm()" translate="COMMON.SEND"></button> </div> '),a.put("views/modals/survey-form.html",'<modal-form-header> <span ng-show="model.id">Edit</span><span ng-hide="model.id">Add</span> Fields </modal-form-header> <div class="modal-body"> <div class="row"> <div name="dataForm" class="form-horizontal" ng-form="dataForm"> <div class="form-group" ng-show="model.id"> <label class="col-sm-4 control-label">ID:</label> <div class="col-sm-8"> <p class="form-control-static">{{model.id}}</p> </div> </div> <div class="form-group"> <label for="title" class="col-sm-4 control-label">Title</label> <div class="col-sm-8"> <input type="text" class="form-control" name="title" id="title" ng-model="model.title"> </div> </div> <div class="form-group"> <label for="description" class="col-sm-4 control-label">Description</label> <div class="col-sm-8"> <textarea type="text" class="form-control" name="description" id="description" ng-model="model.description"></textarea> </div> </div> <form-builder ng-model="model"></form-builder> </div> </div> </div> <div class="modal-form-footer"></div> '),a.put("views/modals/translation-form.html",'<div translate-namespace="TRANSLATION"> <modal-form-header> <span translate=".TITLE"></span> </modal-form-header> <div class="modal-body"> <div name="transForm" class="form-horizontal translation-form" ng-form="transForm"> <div class="form-group"> <div class="col-sm-10"> <p class="form-control">{{model.original.value}}</p> </div> <div class="col-sm-2"> <p class="form-control">{{model.original.langId}}</p> </div> </div> <div class="form-group" ng-repeat="item in model.translations"> <div class="col-sm-10"> <input type="text" class="form-control" name="trn_{{$index}}" translation-input="$index" ng-model="item.value" ng-required="true" ng-minlength="1" ng-if="model.original.type !== \'paragraph\'"> <textarea class="form-control" name="trn_{{$index}}" translation-input="$index" ng-model="item.value" ng-required="true" ng-minlength="1" ng-if="model.original.type === \'paragraph\'"></textarea> </div> <div class="col-sm-2"> <select class="form-control" name="lng_{{$index}}" ng-options="lng.id as lng.code for lng in model.languages | languages : model.translations : $index" ng-model="item.langId" ng-required="true"></select> </div> <div class="text-center" ng-messages="transForm[\'trn_\'+$index].$error" role="alert" ng-if="transForm[\'trn_\'+$index].$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".REQUIRED.VALUE"></span></span> </div> <div class="text-center" ng-messages="transForm[\'lng_\'+$index].$error" role="alert" ng-if="transForm[\'lng_\'+$index].$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".REQUIRED.LANG"></span></span> </div> </div> </div> <div class="row"> <div class="col-sm-2 col-sm-offset-10 text-right"> <button class="btn btn-default" ng-click="add()" translate="COMMON.ADD"></button> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-primary" ng-disabled="(transForm.$invalid || !transForm.$dirty) && model.translations.length === model.originalTrn.length" ng-click="save()" translate="COMMON.SAVE"></button> </div> </div> '),a.put("views/modals/uoas-filter.html",'<modal-form-header> <span translate="UOAS_FILTER.TABLE_TITLE"></span> </modal-form-header> <div class="modal-body"> <!--<div class="row">--> <!--<div class="col-md-4">--> <!--<widget-table model="model.uoaTypes"></widget-table>--> <!--</div>--> <!--<div class="col-md-4">--> <!--<widget-table model="model.uoaClassTypes"></widget-table>--> <!--</div>--> <!--<div class="col-md-4">--> <!--<widget-table model="model.uoaTags"></widget-table>--> <!--</div>--> <!--</div>--> <div class="row"> <div class="col-md-12"> <widget-table model="model.uoas"></widget-table> </div> </div> </div> <div class="modal-footer"> <button class="btn btn-default" ng-if="listMode" ng-click="close()"><span translate="COMMON.CANCEL"></span></button> <button class="btn btn-primary" ng-click="addSelectedUoas()" ng-disabled="!filterResult.length" translate="UOAS_FILTER.APPLY_SELECTED"></button> </div> '),a.put("views/modals/user-groups.html",'<modal-form-header> <span translate="USERS.GROUPS_MODAL.TITLE" translate-values="{user:model.user}"></span> </modal-form-header> <div class="modal-body"> <widget-table model="model.userGroups"></widget-table> </div> <div class="modal-footer"> <button class="btn btn-default" ng-click="close()" translate="COMMON.CANCEL"></button> <button class="btn btn-success" ng-click="save()" translate="COMMON.SAVE"></button> </div> '),a.put("views/modals/user-organization-form.html",'<modal-form-header> <span ng-show="model" translate="COMMON.EDIT"></span><span ng-hide="model" translate="COMMON.ADD"></span> <span translate="PROFILE.ORGANIZATION"></span> </modal-form-header> <div class="modal-body"> <div name="dataForm" class="form-horizontal" ng-form="dataForm"> <div translate-namespace="PROFILE"> <div class="form-group"> <label for="name" class="col-sm-4 control-label" translate=".COMPANY_NAME"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="name" id="name" ng-model="model.name" ng-required="true" ng-minlength="1"> <div class="text-center" ng-messages="dataForm.name.$error" role="alert" ng-if="dataForm.name.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".COMPANY_NAME_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label for="address" class="col-sm-4 control-label" translate=".ADDRESS"></label> <div class="col-sm-8"> <textarea type="text" class="form-control" name="address" id="address" ng-model="model.address" ng-required="true" ng-minlength="1"></textarea> <div class="text-center" ng-messages="dataForm.address.$error" role="alert" ng-if="dataForm.address.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".ADDRESS_ERROR"></span></span> </div> </div> </div> <div class="form-group"> <label for="url" class="col-sm-4 control-label" translate=".URL"></label> <div class="col-sm-8"> <input type="text" class="form-control" name="url" id="url" ng-model="model.url" ng-required="true" ng-minlength="1"> <div class="text-center" ng-messages="dataForm.url.$error" role="alert" ng-if="dataForm.url.$dirty"> <span ng-message="required, minlength" class="help-block"><span translate=".URL_ERROR"></span></span> </div> </div> </div> </div> </div> </div> <div class="modal-form-footer"></div> '),
a.put("views/widgets/my-tasks.html",'<div ng-controller="MyTasksWidget"> <div class="cards" minigrid minigrid-collection="model.tasks"> <div class="card" ng-repeat="task in model.tasks"> <p><i class="fa fa-flag text-danger pull-right" ng-if="task.flagged"></i> {{task.step.title}}</p> <p> <a ng-href="#/survey/{{task.survey.id}}/task/{{task.id}}"> {{task.survey.title}} </a> </p> <p> {{(task.startDate||task.step.startDate)|parseDate|date:\'shortDate\'}} - {{(task.endDate||task.step.endDate)|parseDate|date:\'shortDate\'}} </p> </div> </div> <rd-loading ng-if="!model.tasks"></rd-loading> <div ng-if="model.tasks && !model.tasks.length" class="alert alert-warning"> {{\'MY_TASKS.NO_TASKS\'|translate}} </div> </div> '),a.put("views/widgets/pm-projects.html",'<div ng-controller="PmProjectsWidgetCtrl" translate-namespace="PM_PROJECTS"> <div class="list-group"> <a ui-sref="pmProductDashboard({productId:product.id})" class="list-group-item" ng-repeat="product in model.products"> {{product.title}} </a> <div ng-if="model.products && !model.products.length" class="alert alert-warning" translate=".NO_PRODUCTS"></div> </div> <rd-loading ng-if="!model.products"></rd-loading> </div> ')}]);